$(function(){!function(){window.WGST.exports.createAssemblyPanel=function(e,s){var a="assembly__"+e,o="assembly",t={panelId:a,panelType:o,assemblyId:e};return"undefined"!=typeof s&&$.extend(t,s),window.WGST.exports.createPanel(o,t),a},window.WGST.exports.calculateAssemblyTopScore=function(e){var s,a=[];for(s in e)e.hasOwnProperty(s)&&a.push({referenceId:e[s].referenceId,score:e[s].score});return a=a.sort(function(e,s){return s.score-e.score}),a[0]};var e=function(e){var s="";return s=0===e.length?"Not found":e},s=function(e,s){var a,o,t,n,r,l,i=[];for(t in e)if(e.hasOwnProperty(t)){n=e[t],a=[];for(r in n)n.hasOwnProperty(r)&&(o="","undefined"!=typeof s[t]?"undefined"!=typeof s[t][r]?(l=s[t][r],o="RESISTANT"===l?"RESISTANT":"SENSITIVE"===l?"SENSITIVE":"UNKNOWN"):o="UNKNOWN":o="UNKNOWN",a.push({antibioticName:r,antibioticResistanceData:o}));i.push({antibioticClassName:t,antibioticClassResistanceData:a})}return i},a=function(e){var s,a,o,t=[];for(o in e)e.hasOwnProperty(o)&&(s=e[o],a={},a=null===s?{locusId:"None",alleleId:o}:{locusId:e[o].locusId,alleleId:e[o].alleleId},t.push(a));return t},o=function(e){var s=window.WGST.exports.calculateAssemblyTopScore(e),a=s.referenceId;return a},t=function(e,s){for(var a=[],o=Object.keys(s).sort(function(e,a){return s[e]-s[a]}),t=o.length;0!==t;){t-=1;var n=o[t],r=s[n],l=r.score.toFixed(2)+" = "+Math.round(r.score*parseInt(e,10))+"/"+e;a.push({referenceId:r.referenceId,text:l})}return a};window.WGST.exports.getAssemblyData=function(e,s){console.log("[WGST] Getting assembly "+e+" data"),$.ajax({type:"POST",url:"/api/assembly",datatype:"json",data:{assemblyId:e}}).done(function(a){console.log("[WGST] Received data for assembly "+e),s({assembly:a.assembly,antibiotics:a.antibiotics},null)}).fail(function(e,a){s(null,a)})},window.WGST.exports.prepareAssemblyDataForRendering=function(n,r){console.debug("[WGST] Received assembly object:"),console.dir(n),console.log("[WGST] Parsing assembly "+n.assemblyId+" data");var l={metadata:{}},i=n.ASSEMBLY_METADATA.userAssemblyId;l.assemblyUserId=i;var c=n.PAARSNP_RESULT.resistanceProfile,d=s(r,c);l.resistanceProfile=d;var u=n.MLST_RESULT.stType,b=e(u);l.sequenceType=b,console.debug("assemblySequenceTypeData:"),console.log(b);var y=n.MLST_RESULT.alleles,p=a(y);l.mlst=p,console.debug("assemblyMlstData:"),console.dir(p);var S=n.FP_COMP.scores,T=o(S);l.nearestRepresentative=T,console.debug("assemblyNearestRepresentativeData:"),console.dir(T);var m=n.FP_COMP.fingerprintSize,f=t(m,S);l.scores=f,console.debug("assemblyScoresData:"),console.dir(f);var g=window.WGST.exports.calculateAssemblyTopScore(S);return l.topScore=g,l.topScorePercentage=Math.round(100*g.score.toFixed(2)),l.metadata.latitude=n.ASSEMBLY_METADATA.geography.position.latitude,l.metadata.longitude=n.ASSEMBLY_METADATA.geography.position.longitude,l},window.WGST.exports.getAssembly=function(e){window.WGST.exports.getAssemblyData(e,function(s,a){if(a)return console.error("[WGST][Error] Failed to get assembly data: "+a),void 0;console.debug("[WGST] Got assembly "+e+" data:"),console.dir(s);var o=window.WGST.exports.prepareAssemblyDataForRendering(s.assembly,s.antibiotics),t={assemblyUserId:o.assemblyUserId,antibioticResistanceData:o.resistanceProfile,sequenceTypeData:o.sequenceType,mlstData:o.mlst,nearestRepresentativeData:o.nearestRepresentative,scoresData:o.scores},n=window.WGST.exports.createAssemblyPanel(e,t);window.WGST.exports.bringPanelToFront(n),window.WGST.exports.showPanel(n)})},window.WGST.exports.__old_remove__getAssembly=function(n){console.log("[WGST] Getting assembly "+n),$.ajax({type:"POST",url:"/api/assembly",datatype:"json",data:{assemblyId:n}}).done(function(r){console.log("[WGST] Received data for assembly "+n);var l=r.assembly,i=l.ASSEMBLY_METADATA.userAssemblyId,c=r.antibiotics,d=l.PAARSNP_RESULT.paarResult.resistanceProfile,u=s(c,d),b=l.MLST_RESULT.stType,y=e(b);console.debug("assemblySequenceTypeData:"),console.log(y);var p=l.MLST_RESULT.alleles,S=a(p);console.debug("assemblyMlstData:"),console.dir(S);var T=l.FP_COMP.scores,m=o(T);console.debug("assemblyNearestRepresentativeData:"),console.dir(m);var f=l.FP_COMP.fingerprintSize,g=t(f,T);console.debug("assemblyScoresData:"),console.dir(g);var w={assemblyUserId:i,antibioticResistanceData:u,sequenceTypeData:y,mlstData:S,nearestRepresentativeData:m,scoresData:g},A=window.WGST.exports.createAssemblyPanel(n,w);window.WGST.exports.bringPanelToFront(A),window.WGST.exports.showPanel(A)}).fail(function(e,s,a){console.error("[WGST][Error] Failed to get assembly data"),console.error(s),console.error(a),console.error(e)})}}()});
$(function(){$("body").on("click","[data-wgst-download-assembly-metadata-json]",function(){console.debug("[WGST] Downloading assembly metadata in JSON format")}),$("body").on("click","[data-wgst-download-assembly-metadata-csv]",function(){console.debug("[WGST] Downloading assembly metadata in CSV format")})});
$(function(){!function(){window.WGST.exports.showAssemblyUploadAnalytics=function(s){$(".wgst-panel__assembly-upload-analytics .wgst-upload-assembly__analytics").addClass("wgst--hide-this"),$('.wgst-panel__assembly-upload-analytics .wgst-upload-assembly__analytics[data-assembly-file-id="'+s+'"]').removeClass("wgst--hide-this"),$(".wgst-panel__assembly-upload-analytics header").find("small").text(s)}}()});
$(function(){!function(){window.WGST.exports.showAssemblyUploadMetadata=function(a){$(".wgst-panel__assembly-upload-metadata .wgst-upload-assembly__metadata").addClass("wgst--hide-this"),$('.wgst-panel__assembly-upload-metadata .wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').removeClass("wgst--hide-this"),$(".wgst-panel__assembly-upload-metadata header").find("small").text(a)},$("body").on("change",".wgst-assembly-upload__metadata .assembly-timestamp-input",function(){var e=$(this),t=e.attr("data-assembly-file-id"),s=$('.assembly-timestamp-input-year[data-assembly-file-id="'+t+'"]').val(),o=$('.assembly-timestamp-input-month[data-assembly-file-id="'+t+'"]').val(),l=$('.assembly-timestamp-input-day[data-assembly-file-id="'+t+'"]'),d=l.val(),n=e.attr("data-timestamp-input");("year"===n||"month"===n)&&"-1"!==s&&"-1"!==o&&(window.WGST.exports.populateDaySelect(l,s,o),"-1"!==d&&l.find('option:contains("'+d+'")').prop("selected",!0)),"year"===n?$('.assembly-metadata-timestamp-month[data-assembly-file-id="'+t+'"]').removeClass("wgst--hide-this"):"month"===n&&$('.assembly-metadata-timestamp-day[data-assembly-file-id="'+t+'"]').removeClass("wgst--hide-this");var i;"-1"!==s&&(i="-1"!==o?"-1"!==d?new Date(s,o,d):new Date(s,o):new Date(s),window.WGST.exports.setAssemblyUploadMetadataModel(t,"datetime",i)),"-1"!==s&&a(e),window.WGST.exports.updateMetadataProgressBar()}),window.WGST.exports.updateMetadataProgressBar=function(){var a=+$(".assembly-timestamp-input-year").length+$(".assembly-sample-location-input").length+$(".assembly-sample-source-input").length,e=+$(".assembly-timestamp-input-year").filter(function(){return"-1"!==this.value}).length+$(".assembly-sample-location-input").filter(function(){return 0!==this.value.length}).length+$(".assembly-sample-source-input").filter(function(){return"0"!==this.value}).length,t=Math.floor(100*e/a);if($(".adding-metadata-progress-container .progress-bar").width(t+"%"),$(".adding-metadata-progress-container .progress-bar").attr("aria-valuenow",t),$(".adding-metadata-progress-container .progress-percentage").text(t+"%"),100===t&&($(".adding-metadata-progress-container .progress-container").hide(),$(".adding-metadata-progress-container .upload-controls-container").show(),WGST.speak)){var s=new SpeechSynthesisUtterance("Ready to upload");window.speechSynthesis.speak(s)}},window.WGST.exports.initAssemblyMetadataLocation=function(a){var e=$('.wgst-assembly-upload__metadata li[data-assembly-file-id="'+a+'"] .assembly-sample-location-input')[0];window.WGST.geo.placeSearchBox[a]=new google.maps.places.SearchBox(e,{bounds:window.WGST.geo.map.searchBoxBounds}),google.maps.event.addListener(window.WGST.geo.placeSearchBox[a],"places_changed",function(){window.WGST.exports.handlePlacesChanged(a)})},window.WGST.exports.handlePlacesChanged=function(e){console.debug("Debug: "+$('.assembly-sample-location-input[data-assembly-file-id="'+e+'"]').length);var t=WGST.geo.placeSearchBox[e].getPlaces(),s=t[0];if("undefined"==typeof s||"undefined"==typeof s.geometry)return console.error("[WGST] No place or geometry"),console.dir(WGST.geo.placeSearchBox[e]),void 0;var o=s.geometry.location.lat(),l=s.geometry.location.lng(),d=s.formatted_address;console.log("[WGST] Google Places API first SearchBox place: "+d);var n=$('.assembly-sample-location-input[data-assembly-file-id="'+e+'"]');n.val().length>0&&a(n),n.blur().val(d),WGST.geo.map.canvas.setCenter(s.geometry.location),WGST.geo.map.markers.metadata.setMap(WGST.geo.map.canvas),WGST.geo.map.markers.metadata.setPosition(s.geometry.location),WGST.geo.map.markers.metadata.setVisible(!0),window.WGST.exports.setAssemblyUploadMetadataModel(e,"geography",{address:d,position:{latitude:o,longitude:l},type:s.types[0]}),window.WGST.exports.updateMetadataProgressBar()},$("body").on("change",".assembly-sample-source-input",function(){var e=$(this).attr("data-assembly-file-id"),t=$(this);window.WGST.exports.setAssemblyUploadMetadataModel(e,"source",$(this).val()),window.WGST.exports.updateMetadataProgressBar(),a(t)}),$("body").on("click","[data-wgst-copy-metadata-to-all-empty-assemblies]",function(){var a=$(this).closest(".wgst-upload-assembly__metadata"),e=(a.find(".assembly-sample-location-input"),a.find(".assembly-sample-source-input"),a.attr("data-assembly-file-id"));window.WGST.exports.copyAssemblyMetadataToAssembliesWithNoMetadata(e),$(".wgst-assembly-metadata-block").show(),window.WGST.exports.updateMetadataProgressBar()});var a=function(a){a.closest(".wgst-assembly-metadata-block").next(".wgst-assembly-metadata-block").removeClass("wgst--hide-this"),a.closest(".wgst-upload-assembly__metadata .assembly-metadata").animate({scrollTop:a.closest(".wgst-assembly-metadata-block").next(".wgst-assembly-metadata-block").offset().top},"fast")};window.WGST.exports.setAssemblyUploadMetadataModel=function(a,e,t){window.WGST.upload.fastaAndMetadata[a].metadata=window.WGST.upload.fastaAndMetadata[a].metadata||{},window.WGST.upload.fastaAndMetadata[a].metadata[e]=t},window.WGST.exports.getAssemblyUploadMetadataModel=function(a,e){return window.WGST.upload.fastaAndMetadata[a].metadata[e]}}()});
$(function(){!function(){$("body").on("change",".wgst-dropped-assembly-list",function(){var o=$(this).val();window.WGST.exports.showAssemblyUpload(o)}),$("body").on("click",'[data-wgst-dropped-assembly-list-navigation-button="previous"]',function(){window.WGST.exports.showPreviousAssemblyUpload()}),$("body").on("click",'[data-wgst-dropped-assembly-list-navigation-button="next"]',function(){window.WGST.exports.showNextAssemblyUpload()}),window.WGST.exports.showPreviousAssemblyUpload=function(){var o=$(".wgst-dropped-assembly-list option:selected").prev();o.length>0&&o.prop("selected","selected").change()},window.WGST.exports.showNextAssemblyUpload=function(){var o=$(".wgst-dropped-assembly-list option:selected").next();o.length>0&&o.prop("selected","selected").change()},window.WGST.exports.showAssemblyUpload=function(o){return"undefined"==typeof o?!1:(console.log("*** assemblyFileId: "+o),window.WGST.exports.showAssemblyUploadAnalytics(o),window.WGST.exports.showAssemblyUploadMetadata(o),void 0)}}()});
$(function(){!function(){var e=2e3;$("body").on("click",".assemblies-upload-ready-button",function(){console.log("[WGST] Getting ready to upload assemblies and metadata"),window.WGST.geo.map.markers.metadata.setMap(null),window.WGST.exports.removePanel("assembly-upload-navigation"),window.WGST.exports.removePanel("assembly-upload-metadata"),window.WGST.exports.removePanel("assembly-upload-analytics"),window.WGST.exports.removeFullscreen("collection-map"),window.WGST.exports.removeHidable("collection-map"),WGST.dragAndDrop.files=[];window.WGST.exports.showBackground("uploading");var o="";setTimeout(function(){$.ajax({type:"POST",url:"/collection/add/",datatype:"json",data:{collectionId:o,userAssemblyIds:Object.keys(window.WGST.upload.fastaAndMetadata)}}).done(function(e){var o=e.collectionId,s=e.userAssemblyIdToAssemblyIdMap;console.debug("mapAssemblyIdToUserAssemblyId:"),console.dir(s),WGST.upload.collection[o]={},WGST.upload.collection[o].notifications={assembly:{},all:{},tree:!1};var a=[];$.each(s,function(e){var l=s[e];"undefined"!=typeof window.WGST.upload.fastaAndMetadata[l]&&a.push([o,e,window.WGST.upload.fastaAndMetadata[l]]),console.log("=============================================="),console.dir(a),console.log(e)}),a.forEach(function(e){var o=e[0],s=e[1],a=e[2],t={},n=a.name;console.debug("userAssemblyId: "+n),console.dir(WGST.upload),console.debug("assemblyData: "),console.dir(a),t.collectionId=o,t.assemblyId=s,t.userAssemblyId=a.fasta.name,t.sequences=a.fasta.assembly,t.metadata={datetime:a.metadata.datetime,geography:{position:{latitude:a.metadata.geography.position.latitude,longitude:a.metadata.geography.position.longitude},address:a.metadata.geography.address},source:a.metadata.source},l(t)})}).fail(function(e,o,s){console.error("[WGST][Error] Failed to get collection id"),console.error(o),console.error(s),console.error(e)})},e)});var o=0,s=5,a=2e3,l=function(e){s>o?(console.log("[WGST] Uploading "+e.assemblyId+" assembly"),o+=1,e.socketRoomId=WGST.socket.roomId,console.log("About to upload assembly:"),console.dir(e),$.ajax({type:"POST",url:"/assembly/add/",datatype:"json",data:e}).done(function(){}).fail(function(e,o,s){console.log("[WGST][Error] Failed to send FASTA file object to server or received error message"),console.error(o),console.error(s),console.error(e),showNotification(o)})):setTimeout(l,a,e)};window.WGST.socket.connection.on("assemblyUploadNotification",function(e){if(!window.WGST.exports.isContainerExists("assembly-upload-progress")){var o=Object.keys(window.WGST.upload.fastaAndMetadata).length;window.WGST.exports.createFullscreen("assembly-upload-progress",{fullscreenId:"assembly-upload-progress",fullscreenType:"assembly-upload-progress",assemblyFileIds:Object.keys(window.WGST.upload.fastaAndMetadata),totalNumberOfAssembliesUploading:o}),window.WGST.exports.showFullscreen("assembly-upload-progress"),window.WGST.exports.hideBackground("uploading")}var s=e.collectionId,a=e.assemblyId,l=e.userAssemblyId,i=e.result,r=s+"__"+a+"__"+i,c=Object.keys(window.WGST.upload.fastaAndMetadata),p=Object.keys(window.WGST.assembly.analysis).length,u=p*c.length,m=Object.keys(window.WGST.collection.analysis).length,y=u+m;console.log("[WGST][Socket.io] Received assembly upload notification:"),console.log("[WGST][Socket.io] Assembly id: "+a),console.log("[WGST][Socket.io] Result: "+i),-1===Object.keys(window.WGST.upload.collection[s].notifications.all).indexOf(r)&&(window.WGST.upload.collection[s].notifications.all[r]="OK",console.debug("[WGST] » Received "+Object.keys(window.WGST.upload.collection[s].notifications.all).length+" out of "+y+" assembly results"),-1!==Object.keys(window.WGST.assembly.analysis).indexOf(i)&&t(a,l,p,i),n(s,l,a,y,i),y===Object.keys(window.WGST.upload.collection[s].notifications.all).length&&(console.log("[WGST] ✔ Finished uploading and processing new collection "+s),setTimeout(function(){window.WGST.exports.removeContainer("assembly-upload-progress"),d(),window.WGST.exports.getCollection(s)},1e3)))});var t=function(e,s,a,l){var t=$('.assembly-list-upload-progress tr[data-assembly-file-id="'+s+'"] '),n=t.find(".progress-bar"),d='<span class="glyphicon glyphicon-ok"></span>',i=parseFloat(t.find(".progress-bar").attr("aria-valuenow")),r=100/a,c=i+r;if(l===window.WGST.assembly.analysis.UPLOAD_OK?t.find(".assembly-upload-uploaded").html(d):l===WGST.assembly.analysis.MLST_RESULT?t.find(".assembly-upload-result-mlst").html(d):l===WGST.assembly.analysis.PAARSNP_RESULT?t.find(".assembly-upload-result-paarsnp").html(d):l===WGST.assembly.analysis.FP_COMP?t.find(".assembly-upload-result-fp-comp").html(d):l===WGST.assembly.analysis.CORE&&t.find(".assembly-upload-result-core").html(d),n.css("width",c+"%").attr("aria-valuenow",c),c>0&&n.text(Math.round(c)+"%"),c>=100){o-=1,t.find(".progress").removeClass("active").removeClass("progress-striped"),n.removeClass("progress-bar-info").addClass("progress-bar-success");var p=t.find(".assembly-upload-name").text();t.find(".assembly-upload-name").html('<a href="#" class="open-assembly-button" data-assembly-id="'+e+'">'+p+"</a>");var u=$(".assemblies-upload-processed");u.text(parseInt(u.text(),10)+1)}},n=function(e,o,s,a){var l=$(".assemblies-upload-progress").find(".progress-bar"),t=parseFloat(l.attr("aria-valuenow")),n=100/a,d=t+n;if(l.css("width",d+"%").attr("aria-valuenow",d),d>0&&l.text(Math.round(d)+"%"),d>=100&&l.addClass("progress-bar-success"),WGST.speak===!0&&d%30===0){var i=new SpeechSynthesisUtterance("Uploaded over "+d+" percent");window.speechSynthesis.speak(i)}},d=function(){window.WGST.upload.fastaAndMetadata={}}}()});
$(function(){!function(){window.WGST.exports.showBackground=function(d){$('[data-wgst-background-id="'+d+'"]').removeClass("wgst--hide-this")},window.WGST.exports.hideBackground=function(d){$('[data-wgst-background-id="'+d+'"]').addClass("wgst--hide-this")}}()});
$(function(){window.WGST.exports.mapCollectionIdToCollectionName={"5324c298-4cd0-4329-848b-30d7fe28a560":"EMRSA15","c0ca8c57-11b9-4e27-93a5-6ffe841e7768":"ST239","b8d3aab1-625f-49aa-9857-a5e97f5d6be5":"Reference"},window.WGST.exports.initCollectionDataStructure=function(e,t){WGST.collection[e]={assemblies:{},tree:{}},$.isArray(t)&&t.forEach(function(t){window.WGST.collection[e].tree[t]={}})},window.WGST.exports.setCollectionData=function(e,t,o){window.WGST.exports.initCollectionDataStructure(e),window.WGST.collection[e].assemblies=t,$.each(o,function(t,o){window.WGST.collection[e].tree[t]={type:t,data:o.data,name:o.name}})};var e=function(e){var t=window.WGST.collection[e].assemblies,o=[],a=[],s="CORE_TREE_RESULT",i=window.WGST.collection[e].tree[s];$.each(i.leavesOrder,function(e,s){o.push(t[s.id]),a.push(s.id)}),window.WGST.collection[e].sortedAssemblyIds=a};window.WGST.exports.getCollection=function(o){if(console.log("[WGST] Getting collection "+o),window.WGST.speak){var a=new SpeechSynthesisUtterance("Loading collection");window.speechSynthesis.speak(a)}window.WGST.exports.showBackground("get-collection"),$.ajax({type:"POST",url:"/collection/",datatype:"json",data:{collectionId:o}}).done(function(a){if(console.log("[WGST] Got collection "+o+" data"),Object.keys(a).length>0){console.log("[WGST] Collection "+o+" has "+Object.keys(a.collection.assemblies).length+" assemblies"),window.WGST.antibiotics=a.antibiotics,window.WGST.exports.setCollectionData(o,a.collection.assemblies,a.collection.tree);{var s=window.WGST.exports.createCollectionDataPanel(o);$('.wgst-panel[data-panel-id="'+s+'"]')}window.WGST.exports.createFullscreen("collection-map",{fullscreenId:"collection-map",fullscreenType:"collection-map"}),window.WGST.exports.showFullscreen("collection-map"),window.WGST.geo.map.init(),window.WGST.exports.bringPanelToFront(s),window.WGST.exports.renderCollectionTrees(o),window.WGST.exports.renderCollectionTreeButtons(o,s),window.WGST.exports.addResistanceProfileDataToCollection(o),e(o),window.WGST.exports.renderAssemblyAnalysisList(o,s,WGST.antibiotics),window.WGST.exports.showPanel(s),"undefined"!=typeof window.WGST.exports.mapCollectionIdToCollectionName[o]?$(".wgst-header-collection-name").text(window.WGST.exports.mapCollectionIdToCollectionName[o]):$(".wgst-header-collection-name").text(o),Object.keys(window.WGST.collection[o].assemblies).length>100&&(console.log("[WGST] Collection "+o+" will be displayed fullscreen"),t(o)),window.history.replaceState("Object","WGST Collection","/collection/"+o),window.WGST.exports.hideBackground("get-collection")}}).fail(function(e,t,o){console.log("[WGST][ERROR] Failed to get collection id"),console.error(t),console.error(o),console.error(e),showNotification(t)})};window.WGST.exports.addResistanceProfileDataToCollection=function(e){var t,o,a,s,i,n,l={};for(t in WGST.collection[e].assemblies){o=WGST.collection[e].assemblies[t],l=o.PAARSNP_RESULT.resistanceProfile,i={};for(a in l){s=l[a];for(n in s)i[n]=s[n]}WGST.collection[e].assemblies[t].PAARSNP_RESULT.paarResult.ungroupedResistanceProfile=i}},window.WGST.exports.renderAssemblyAnalysisList=function(e,t){console.log("[WGST] Rendering assembly analysis list");var o,a,s=window.WGST.collection[e].assemblies,i=window.WGST.collection[e].sortedAssemblyIds,n=i.map(function(t){return o=s[t],a=window.WGST.exports.prepareAssemblyDataForRendering(o,window.WGST.antibiotics),window.WGST.collection[e].assemblies[t].FP_COMP.topScore=a.topScore,{assemblyId:t,assemblyUserId:a.assemblyUserId,antibioticResistanceData:a.resistanceProfile,sequenceTypeData:a.sequenceType,mlstData:a.mlst,nearestRepresentativeData:a.nearestRepresentative,scoresData:a.scores,topScore:a.topScore,topScorePercentage:a.topScorePercentage,metadata:{latitude:a.metadata.latitude,longitude:a.metadata.longitude}}}),l={collectionId:e,assemblies:n};console.log(">>> !!! templateContext:"),console.dir(l);var c=$('.wgst-template[data-template-id="panel-body__collection-data__assemblies"]').html(),d=Handlebars.compile(c),r=$('.wgst-template[data-template-id="panel-body__collection-data__assemblies__assembly"]').html();Handlebars.registerPartial("assembly",r);var p=d(l),m=$('.wgst-panel[data-panel-id="'+t+'"]'),w=m.find(".wgst-panel-body-container");w.prepend(p),$(".wgst-assembly-show-on-map").prop("checked",!0).change()},window.WGST.exports.__old_remove__renderAssemblyAnalysisList=function(e,t,o){console.log("[WGST] Rendering assembly analysis list");for(var a,s,i,n,l,c,d,r=WGST.collection[e].assemblies,p=WGST.collection[e].sortedAssemblyIds,m=0,w=$('.wgst-panel[data-panel-id="'+t+'"]'),b=w.find(".collection-assembly-list"),S=w.find(".collection-assembly-list-full"),T=document.createDocumentFragment();m<p.length;)a=p[m],s=r[a].PAARSNP_RESULT.paarResult.resistanceProfile,i=window.WGST.exports.createAssemblyResistanceProfilePreviewHtml(s,o),n=window.WGST.exports.calculateAssemblyTopScore(r[a].FP_COMP.scores),WGST.collection[e].assemblies[a].FP_COMP.topScore=n,l=r[a].ASSEMBLY_METADATA.geography.position.latitude,c=r[a].ASSEMBLY_METADATA.geography.position.longitude,d=$((m%2===0?'<div class="row-stripe assembly-list-item" data-assembly-id="'+r[a].FP_COMP.assemblyId+'">':'<div class="assembly-list-item" data-assembly-id="'+r[a].FP_COMP.assemblyId+'">')+'<div class="show-on-map-checkbox assembly-list-header-map"><input type="checkbox" data-reference-id="'+n.referenceId+'" data-assembly-id="'+r[a].FP_COMP.assemblyId+'" data-latitude="'+l+'" data-longitude="'+c+'"></div><div class="assembly-list-header-id"><a href="#" class="open-assembly-button" data-assembly-id="'+r[a].FP_COMP.assemblyId+'" title="'+r[a].ASSEMBLY_METADATA.userAssemblyId+'" data-mixpanel-open-assembly-panel="'+r[a].ASSEMBLY_METADATA.userAssemblyId+'">'+r[a].ASSEMBLY_METADATA.userAssemblyId+'</a></div><div class="assembly-list-header-nearest-representative">'+n.referenceId+" ("+Math.round(100*n.score.toFixed(2))+'%)</div><div class="assembly-list-header-st">'+(0===r[a].MLST_RESULT.stType.length?"Not found":r[a].MLST_RESULT.stType)+'</div><div class="assembly-list-header-resistance-profile"><div class="assembly-resistance-profile-container">'+i+"</div></div></div>"),T.appendChild(d[0]),m+=1;b[0].appendChild(T.cloneNode(!0)),S[0].appendChild(T.cloneNode(!0)),$('.show-on-map-checkbox input[type="checkbox"]').prop("checked",!0).change()},window.WGST.exports.__old_remove__createAssemblyResistanceProfilePreviewHtml=function(e,t){var o,a,s,i,n,l,c,d="";for(a in t)if(t.hasOwnProperty(a)){o=t[a],s='<div class="antibiotic-group" data-antibiotic-group-name="'+a+'">{{antibioticsHtml}}</div>',l="";for(i in o)o.hasOwnProperty(i)&&(n="","undefined"!=typeof e[a]?"undefined"!=typeof e[a][i]?(c=e[a][i].resistanceState,n="RESISTANT"===c?n+'<span class="antibiotic resistance-fail" data-antibiotic-name="'+i+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+i+'"></span>':"SENSITIVE"===c?n+'<span class="antibiotic resistance-success" data-antibiotic-name="'+i+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+i+'"></span>':n+'<span class="antibiotic resistance-unknown" data-antibiotic-name="'+i+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+i+'"></span>'):(n=n+'<span class="antibiotic resistance-unknown" data-antibiotic-name="'+i+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+i+'"></span>',console.warn("[!] Assembly resistatance profile has no antibiotic: "+i)):(n=n+'<span class="antibiotic no-resistance-data" data-antibiotic-name="'+i+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+i+'"></span>',console.warn("[!] Assembly resistatance profile has no antibiotic group: "+a)),l+=n);s=s.replace(/{{antibioticsHtml}}/g,l),d+=s}return d};var t=function(e){console.log("[WGST] Maximizing collection "+e),window.WGST.exports.maximizePanel("collection-data__"+e)}});
$(function(){!function(){window.WGST.exports.createCollectionDataPanel=function(e){var t="collection-data__"+e,o="collection-data",a={collectionId:e,panelId:t,panelType:o};return window.WGST.exports.createPanel(o,a),t};$("body").on("change",".wgst-assembly-show-on-map",function(){var e,t=($(this).attr("data-assembly-id"),$(this).closest("[data-wgst-collection-data]").attr("data-collection-id")),o=$(this).closest(".wgst-collection-data-assemblies").find(".wgst-assembly-show-on-map:checked"),a=[];o.each(function(){e=$(this).attr("data-assembly-id"),a.push(e)}),console.debug(">>> }}} A"),console.dir(a),window.WGST.exports.triggerMapMarkers(t,a),"map"!==$(".wgst-fullscreen--active").attr("data-fullscreen-name")&&($(".wgst-panel__map").hasClass("wgst-panel--active")||window.WGST.exports.showPanel("map")),0===$(this).closest(".wgst-collection-data-assemblies").find('input[type="checkbox"]:not(:checked)').length?$(".wgst-assembly-show-all-on-map").prop("checked",!0):$(".wgst-assembly-show-all-on-map").prop("checked",!1)}),$("body").on("click",".open-assembly-button",function(e){var t=$(this).attr("data-assembly-id");window.WGST.exports.getAssembly(t),e.preventDefault()}),$("body").on("click",".wgst-collection-control__show-tree",function(){var e=$(this).attr("data-collection-id"),t=$(this).attr("data-tree-type"),o="collection-tree__"+e+"__"+t;window.WGST.exports.showPanel(o),window.WGST.exports.bringPanelToFront(o)}),$(".wgst-panel__collection").on("click",".wgst-collection-control__show-data-table",function(){var e=$(this).attr("data-collection-id"),t=WGST.collection[e].assemblies,o=Object.keys(t);$.ajax({type:"POST",url:"/api/assembly/table-data",datatype:"json",data:{assemblyIds:o}}).done(function(e){console.log("[WGST] Got assembly table data"),console.dir(e)})}),window.WGST.exports.renderCollectionTreeButtons=function(t,o){var a=WGST.collection[t].tree;$.each(a,function(a){"COLLECTION_TREE"===a&&e(t,o,a)})};var e=function(e,t,o){var a=WGST.collection[e].tree[o],l=(a.name,{collectionTreeType:o,collectionId:e,collectionTreeName:"Tree"}),n=$('.wgst-template[data-template-id="panel-body__collection-data__tree-button"]').html(),s=Handlebars.compile(n),c=s(l);$('.wgst-panel[data-panel-id="'+t+'"]').find(".wgst-collection-controls__show-tree .btn-group").prepend(c)};window.WGST.exports.renderCollectionTrees=function(e,o){var a=window.WGST.collection[e].tree;console.dir(window.WGST.collection[e]),$.each(a,function(a){t(e,a,o)})};var t=function(e,t,a){console.log("[WGST] Rendering "+e+" collection "+t+" tree");var l="collection-tree__"+e+"__"+t,n=window.WGST.collection[e].tree[t].name.capitalize(),s="phylocanvas__"+e+"__"+t,c="collection-tree",i={panelId:l,panelType:c,collectionId:e,collectionTreeType:t,collectionTreeTitle:n,phylocanvasId:s,invisibleThis:!0,dataAttributes:[{name:"data-collection-tree-type",value:t}]};"undefined"!=typeof a&&$.extend(i,a),e===window.WGST.config.referenceCollectionId&&(i.mergeWithButton=!0),window.WGST.exports.createPanel(c,i);var r,d=window.WGST.collection[e].tree[t],p=window.WGST.collection[e].assemblies;d.canvas=new PhyloCanvas.Tree($('[data-phylocanvas-id="'+s+'"]')[0],{history_collapsed:!0}),d.canvas.parseNwk(d.data),d.canvas.treeType="rectangular";var w=d.canvas;w.on("selected",function(t){var a=t.nodeIds;"string"==typeof a&&(a=[a]),0!==a.length&&o(e,a)});for(r in p)p.hasOwnProperty(r)&&w.branches[r].leaf&&(w.branches[r].label=p[r].ASSEMBLY_METADATA.userAssemblyId);w.resizeToContainer(),w.drawn=!1,w.draw();var m=w.leaves;m.sort(function(e,t){return e.centery-t.centery}),d.leavesOrder=m;var y=d.data;for(r in p)p.hasOwnProperty(r)&&(y=y.replace(r,p[r].ASSEMBLY_METADATA.userAssemblyId));console.debug("» [WGST][DEV] Parsed Newick String:"),console.log("» Uncomment to see."),window.WGST.collection[e].tree[t].newickStringWithLabels=y,$collectionTreePanel=$('.wgst-panel[data-panel-id="'+l+'"]'),window.WGST.exports.populateListOfAntibiotics($collectionTreePanel.find(".wgst-tree-control__change-node-colour")),w.resizeToContainer(),w.drawn=!1,w.draw()},o=function(e,t){var o=WGST.collection[e].assemblies;$('.collection-assembly-list .assembly-list-item [type="radio"]').prop("checked",!1),$.each(o,function(e){-1!==$.inArray(e,t)?($('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"]').addClass("row-selected"),$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"] [type="checkbox"]').prop("checked",!0)):($('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"]').removeClass("row-selected"),$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"] [type="checkbox"]').prop("checked",!1))}),window.WGST.exports.triggerMapMarkers(e,t),1===t.length&&$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+t+'"] [type="radio"]').prop("checked",!0)};$("body").on("change",".wgst-assembly-show-all-on-map",function(){var e=$(this).closest("[data-wgst-collection-data]").find(".wgst-collection-data-assemblies .wgst-assembly-show-on-map");$(this).prop("checked")?e.prop("checked",!0).trigger("change"):e.prop("checked",!1).trigger("change")}),$("body").on("click","[data-wgst-download-metadata]",function(){var e=$(this).attr("data-wgst-assembly-id");console.debug("Downloading assembly metadata "+e),$.ajax({type:"GET",url:"/api/download/assembly/"+e+"/metadata",datatype:"json"}).done(function(e){console.log("[WGST] Got assembly metadata"),console.dir(e)})})}()});
$(function(){!function(){$(".tree-controls-show-labels").on("click",function(){var e=$(this).closest("[data-collection-tree-content]").attr("data-collection-id");WGST.collection[e].tree.CORE_TREE_RESULT.canvas.displayLabels()}),$(".tree-controls-hide-labels").on("click",function(){var e=$(this).closest("[data-collection-tree-content]").attr("data-collection-id");WGST.collection[e].tree.CORE_TREE_RESULT.canvas.hideLabels()}),$("body").on("change",".wgst-tree-control__change-node-label",function(){var t,o=$(this),n=o.closest("[data-collection-tree-content]").attr("data-collection-id"),c=o.closest("[data-collection-tree-content]").attr("data-collection-tree-type"),l=WGST.collection[n].tree[c].canvas,a=WGST.collection[n].assemblies;if("1"===o.val())for(t in a)a.hasOwnProperty(t)&&l.branches[t]&&l.branches[t].leaf&&(l.branches[t].label=a[t].ASSEMBLY_METADATA.userAssemblyId);else if("2"===o.val())for(t in a)a.hasOwnProperty(t)&&l.branches[t]&&l.branches[t].leaf&&(l.branches[t].label=window.WGST.collection[n].assemblies[t].FP_COMP.topScore.referenceId);else if("3"===o.val())for(t in a)a.hasOwnProperty(t)&&l.branches[t]&&l.branches[t].leaf&&(l.branches[t].label=0===a[t].MLST_RESULT.stType.length?"Not found":a[t].MLST_RESULT.stType);else if("4"===o.val()){var s,i;for(t in a)a.hasOwnProperty(t)&&(s=a[t].PAARSNP_RESULT.resistanceProfile,i=e(s,WGST.antibiotics),l.branches[t]&&l.branches[t].leaf&&(l.branches[t].label=i))}else if("5"===o.val())for(t in a)a.hasOwnProperty(t)&&l.branches[t]&&l.branches[t].leaf&&(l.branches[t].label=a[t].ASSEMBLY_METADATA.geography.address);l.draw()}),$("body").on("change",".wgst-tree-control__change-node-colour",function(){var e,t=$(this).find("option:selected"),o=t.closest("[data-collection-tree-content]").attr("data-collection-id"),n=t.closest("[data-collection-tree-content]").attr("data-collection-tree-type"),c=WGST.collection[o].tree[n].canvas,l=WGST.collection[o].assemblies;if("0"===t.val())for(e in l)l.hasOwnProperty(e)&&c.setNodeColourAndShape(e,"#ffffff");else{var a,s;for(e in l)l.hasOwnProperty(e)&&(a=l[e].PAARSNP_RESULT.paarResult.ungroupedResistanceProfile,s=a[t.text()],"undefined"!=typeof s?c.branches[e]&&c.branches[e].leaf&&("RESISTANT"===s?c.setNodeColourAndShape(e,"#ff0000"):"SENSITIVE"===s?c.setNodeColourAndShape(e,"#4dbd33"):"UNKNOWN"===s&&c.setNodeColourAndShape(e,"#ffffff")):c.branches[e]&&c.branches[e].leaf&&c.setNodeColourAndShape(e,"#ffffff"))}}),$("body").on("change",".wgst-tree-control__change-tree-type",function(){var e,t=$(this).find("option:selected"),o=t.closest("[data-collection-tree-content]").attr("data-collection-id"),n=t.closest("[data-collection-tree-content]").attr("data-collection-tree-type");e=window.WGST.collection[o].tree[n].canvas,e.setTreeType(t.val())}),$("body").on("click",".wgst-tree-control__show-newick",function(){var e,t,o=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),n=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");e=WGST.collection[o].tree[n].newickStringWithLabels,t=window.open(),t.document.write(e)}),$("body").on("click",".wgst-tree-control__decrease-label-font-size",function(){var e,t,o=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),n=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");t=WGST.collection[o].tree[n].canvas,e=t.textSize,t.setTextSize(e-3)}),$("body").on("click",".wgst-tree-control__increase-label-font-size",function(){var e,t,o=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),n=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");t=WGST.collection[o].tree[n].canvas,e=t.textSize,t.setTextSize(e+3)}),$("body").on("click",".wgst-tree-control__decrease-node-size",function(){var e,t,o=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),n=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");e=WGST.collection[o].tree[n].canvas,t=e.baseNodeSize,t>3?(e.setNodeSize(t-3),t=e.baseNodeSize,3>t&&$(this).attr("disabled",!0)):$(this).attr("disabled",!0)}),$("body").on("click",".wgst-tree-control__increase-node-size",function(){var e,t,o=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),n=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");e=WGST.collection[o].tree[n].canvas,t=e.baseNodeSize,e.setNodeSize(t+3),e.baseNodeSize>3&&$(this).closest(".wgst-tree-control").find(".wgst-tree-control__decrease-node-size").attr("disabled",!1)}),$("body").on("change",".wgst-tree-control__show-node-labels",function(){var e,t=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),o=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");e=WGST.collection[t].tree[o].canvas,e.toggleLabels()}),window.WGST.socket.connection.on("collectionTreeMergeNotification",function(e){if(console.log("[WGST] Received merged tree notification"),WGST.speak){var t=new SpeechSynthesisUtterance("Merged collections");window.speechSynthesis.speak(t)}var o=e.mergedCollectionTreeId,n=e.tree,c=e.assemblies,l=[];l=c.map(function(e){return e.assemblyId}),console.log("[WGST] Getting merged collection assemblies"),console.dir(l),$.ajax({type:"POST",url:"/api/assemblies/",datatype:"json",data:{assemblyIds:l}}).done(function(e){console.log("[WGST] Got merged collection assemblies"),console.dir(e),window.WGST.exports.setCollectionData(o,e,n),window.WGST.exports.renderCollectionTrees(o,{matchAssemblyListButton:!0,mergeWithButton:!0,panelLabel:"Merge Tree"});var t,c,l;for(t in window.WGST.collection[o].assemblies)WGST.collection[o].assemblies.hasOwnProperty(t)&&(c=window.WGST.collection[o].assemblies[t],l=c.FP_COMP.scores,window.WGST.collection[o].assemblies[t].FP_COMP.topScore=window.WGST.exports.calculateAssemblyTopScore(l));window.WGST.exports.addResistanceProfileDataToCollection(o),window.WGST.exports.populateListOfAntibiotics($("#select-tree-node-antibiotic-merged")),function(){var e=$(".wgst-tree-control__merge-collection-trees");e.find(".wgst-spinner").addClass("wgst--hide-this"),e.find(".wgst-spinner-label").removeClass("wgst--hide-this"),e.attr("disabled",!1)}();var a="MERGED",s="collection-tree__"+o+"__"+a;window.WGST.exports.showPanel(s),window.WGST.exports.bringPanelToFront(s)}).fail(function(e,t,o){console.error("[WGST][Error] ✗ Failed to get assemblies"),console.error(t),console.error(o),console.error(e)})}),$("body").on("click",".wgst-tree-control__merge-collection-trees",function(){var e=$(this);e.attr("disabled",!0),e.find(".wgst-spinner-label").addClass("wgst--hide-this"),e.find(".wgst-spinner").removeClass("wgst--hide-this");var t={collectionId:e.closest("[data-collection-tree-content]").attr("data-collection-id"),mergeWithCollectionId:window.WGST.settings.referenceCollectionId,collectionTreeType:e.attr("data-collection-tree-type"),socketRoomId:WGST.socket.roomId};console.log("[WGST] Requesting to merge collection trees: "+t.collectionId+", "+t.mergeWithCollectionId),$.ajax({type:"POST",url:"/api/collection/tree/merge",datatype:"json",data:t}).done(function(){console.log("[WGST] Requested to merge collection trees: "+t.collectionId+", "+t.mergeWithCollectionId)})});var e=function(e,t){var o,n,c,l,a,s,i,r="";for(n in t)if(t.hasOwnProperty(n)){o=t[n],c="  ",s="";for(l in o)o.hasOwnProperty(l)&&(a="","undefined"!=typeof e[n]?"undefined"!=typeof e[n][l]?(i=e[n][l],a+="RESISTANT"===i?"⦿":"SENSITIVE"===i?"○":"○"):a+="○":a+="○",s+=a);c+=s,r+=c}return r}}()});
$(function(){!function(){window.WGST.exports.isContainerExists=function(e){return window.WGST.exports.isPanelExists(e)?!0:window.WGST.exports.isFullscreenExists(e)?!0:!1},window.WGST.exports.getContainerType=function(e){return window.WGST.exports.isPanelExists(e)?"panel":window.WGST.exports.isFullscreenExists(e)?"fullscreen":"unknown"},window.WGST.exports.bringContainerToFront=function(e,n){var o,t=0;$(".wgst-panel, .wgst-fullscreen").each(function(){var e=$(this);o=parseInt(e.css("z-index"),10),o>=t&&(t=o)}),"panel"===e?$('[data-panel-id="'+n+'"]').css("z-index",t+1):"fullscreen"===e&&$('[data-fullscreen-id="'+n+'"]').css("z-index",t+1)},window.WGST.exports.removeContainer=function(e){"panel"===window.WGST.exports.getContainerType(e)?window.WGST.exports.removePanel(e):"fullscreen"===window.WGST.exports.getContainerType(e)&&window.WGST.exports.removeFullscreen(e)},window.WGST.exports.extendContainerOptions=function(e,n){return $.extend(e,{additional:n}),e},window.WGST.exports.getContainerLabel=function(e){console.log("getContainerLabel():"),console.dir(e);var n="Anonymous";return"collection-data"===e.containerType?n="Data":"collection-map"===e.containerType?n="Map":"collection-tree"===e.containerType?n="Tree":"assembly"===e.containerType?n=e.additional.assemblyUserId:"assembly-upload-progress"===e.containerType?n="Upload Progress":"assembly-upload-metadata"===e.containerType?n="Assembly Metadata":"assembly-upload-analytics"===e.containerType?n="Assembly Analytics":"assembly-upload-navigation"===e.containerType&&(n="Collection Navigation"),n}}()});
$(function(){!function(){window.WGST.exports.extractContigsFromFastaFileString=function(t){var n=[];return n=t.trim().split(">").filter(function(t){return t.length>0})},window.WGST.exports.splitContigIntoParts=function(t){var n=[];return n=t.split(/\n/).filter(function(t){return t.length>0}),n.map(function(t){return t.trim()}),n},window.WGST.exports.extractDnaStringIdFromContig=function(t){var n=window.WGST.exports.splitContigIntoParts(t),r=n[0].trim().replace(">","");return r},window.WGST.regex=WGST.regex||{},window.WGST.regex.DNA_SEQUENCE=/^[CTAGNUX]+$/i,window.WGST.exports.extractDnaStringFromContig=function(t){var n=window.WGST.exports.splitContigIntoParts(t),r=n.splice(1,n.length);WGST.regex.DNA_SEQUENCE.test(r[0].trim())||(r=r.splice(1,r.length));var e=r.join("").replace(/\s/g,"");return e},window.WGST.exports.extractDnaStringsFromContigs=function(t){var n,r=[];return t.forEach(function(t){n=window.WGST.exports.extractDnaStringFromContig(t),r.push(n)}),r},window.WGST.exports.isValidDnaString=function(t){return WGST.regex.DNA_SEQUENCE.test(t)},window.WGST.exports.isValidContig=function(t){var n=window.WGST.exports.splitContigIntoParts(t),r=window.WGST.exports.extractDnaStringFromContig(t);return n.length>1&&window.WGST.exports.isValidDnaString(r)},window.WGST.exports.calculateN50=function(t){for(var n=t.sort(function(t,n){return n.length-t.length}),r=[],e=0;e<n.length;e++)r.length>0?r.push(n[e].length+r[r.length-1]):r.push(n[e].length);for(var a=Math.floor(r[r.length-1]/2),i=0,o={},e=0;e<n.length;e++)if(i+=n[e].length,i>=a){o.sequenceNumber=e+1,o.sum=i,o.sequenceLength=n[e].length;break}return o},window.WGST.exports.calculateTotalNumberOfNucleotidesInDnaStrings=function(t){var n=0;return t.forEach(function(t){n+=t.length}),n},window.WGST.exports.calculateAverageNumberOfNucleotidesInDnaStrings=function(t){var n=window.WGST.exports.calculateTotalNumberOfNucleotidesInDnaStrings(t),r=t.length,e=Math.floor(n/r);return e},window.WGST.exports.calculateSmallestNumberOfNucleotidesInDnaStrings=function(t){var n=t.map(function(t){return t.length}),r=n.reduce(function(t,n){return Math.min(t,n)});return r},window.WGST.exports.calculateBiggestNumberOfNucleotidesInDnaStrings=function(t){var n=t.map(function(t){return t.length}),r=n.reduce(function(t,n){return Math.max(t,n)});return r},window.WGST.exports.calculateSumsOfNucleotidesInDnaStrings=function(t){var n=t.sort(function(t,n){return n.length-t.length}),r=[];return n.forEach(function(t){0===r.length?r.push(t.length):r.push(t.length+r[r.length-1])}),r},window.WGST.exports.validateContigs=function(t){var n={valid:[],invalid:[]};return t.forEach(function(t){var r=(window.WGST.exports.splitContigIntoParts(t),window.WGST.exports.extractDnaStringFromContig(t)),e=window.WGST.exports.extractDnaStringIdFromContig(t);window.WGST.exports.isValidContig(t)?n.valid.push({id:e,dnaString:r}):n.invalid.push({id:e,dnaString:r})}),n},window.WGST.exports.drawN50Chart=function(t,n,r){var e=460,a=312,i=(d3.extent(t,function(t){return t.sequenceLength}),d3.scale.linear().domain([0,t.length]).range([40,e-50])),o=d3.scale.linear().domain([t[t.length-1],0]).range([30,a-52]),s=d3.svg.axis().scale(i).orient("bottom").ticks(10),u=d3.svg.axis().scale(o).orient("left").ticks(10),c=d3.select(r).append("svg").attr("width",e).attr("height",a);c.append("g").attr("class","x axis").attr("transform","translate(20, 260)").call(s),c.append("g").attr("class","y axis").attr("transform","translate(60, 0)").call(u),c.select(".x.axis").append("text").text("Ordered contigs").attr("class","axis-label").attr("text-anchor","end").attr("x",e/2+49).attr("y",45),c.select(".y.axis").append("text").text("Nucleotides sum").attr("class","axis-label").attr("transform","rotate(-90)").attr("x",-(a/2)-44).attr("y",398),c.selectAll("circle").data(t).enter().append("circle").attr("cx",function(t,n){return i(n+1)+20}).attr("cy",function(t){return o(t)}).attr("r",5);var l=d3.svg.line().x(function(t,n){return i(n+1)+20}).y(function(t){return o(t)});c.append("path").attr("d",l(t));{var g=[{x:i(0)+20,y:o(0)},{x:i(1)+20,y:o(t[0])}],d=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear"),p=(c.append("path").attr("d",d(g)),c.selectAll(".n50-circle").data([n]).enter().append("g").attr("class","n50-group"));p.append("circle").attr("cx",function(t){return i(t.sequenceNumber)+20}).attr("cy",function(t){return o(t.sum)}).attr("r",6)}p.append("text").attr("dx",function(t){return i(t.sequenceNumber)+20+9}).attr("dy",function(t){return o(t.sum)+5}).attr("text-anchor","right").text("N50");var x=[{x:54,y:o(n.sum)},{x:i(n.sequenceNumber)+20,y:o(n.sum)},{x:i(n.sequenceNumber)+20,y:a-46}],f=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear");p.append("path").attr("d",f(x))}}()});
$(function(){!function(){$("body").on("submit",'[data-form="feedback"]',function(e){console.log("[WGST] Submitting feedback form..."),e.preventDefault();var a=$(this).find('[type="submit"]');a.prop("disabled",!0),a.find("span").addClass("wgst--hide-this"),a.find(".wgst-spinner").removeClass("wgst--hide-this");var n=$('[data-form="feedback"]'),s=n.find('[data-input="name"]').val(),d=n.find('[data-input="email"]').val(),o=n.find('[data-input="feedback"]').val(),t={name:s,email:d,feedback:o};console.dir(t),window.WGST.exports.mixpanel.submitFeedback(),$.ajax({type:"POST",url:"/feedback/",datatype:"json",data:t}).done(function(){console.log("[WGST] Sent feedback"),a.addClass("wgst--hide-this"),$(".wgst-send-feedback-success-message").removeClass("wgst--hide-this")}).fail(function(e,a,n){console.log("[WGST][Error] Failed to send feedback"),console.error(a),console.error(n),console.error(e)})})}()});
$(function(){!function(){window.WGST.exports.mapFullscreenTypeToTemplateId={"collection-map":"collection-map-fullscreen","collection-data":"collection-data-fullscreen","collection-tree":"collection-tree-fullscreen","assembly-upload-progress":"assembly-upload-progress-fullscreen",assembly:"assembly-fullscreen"},window.WGST.exports.mapFullscreenIdToPanelType={"collection-map":"collection-map","collection-data":"collection-data","collection-tree":"collection-tree"},window.WGST.exports.createFullscreen=function(e,l){if(console.log("createFullscreen():"),console.log(e),console.dir(l),!($('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').length>0)){if("undefined"==typeof l)return console.error("[WGST][Error] No template context were provided."),void 0;var n={containerName:"fullscreen",containerType:l.fullscreenType,containerId:e};if("assembly"===n.containerType){var t={assemblyUserId:"AAA"};n=window.WGST.exports.extendContainerOptions(n,t)}l.fullscreenLabel=window.WGST.exports.getContainerLabel(n),console.debug("templateContext.fullscreenType: "+l.fullscreenType);var o=window.WGST.exports.mapFullscreenTypeToTemplateId[l.fullscreenType];console.debug("fullscreenTemplateId: "+o),console.log($('.wgst-template[data-template-id="'+o+'"]').html());var s=$('.wgst-template[data-template-id="'+o+'"]').html(),a=Handlebars.compile(s),i=a(l);$(".wgst-workspace").prepend(i),window.WGST.exports.happenedCreateFullscreen({fullscreenId:e,fullscreenLabel:l.fullscreenLabel})}},window.WGST.exports.removeFullscreen=function(e){$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').remove(),window.WGST.exports.happenedRemoveFullscreen(e),"collection-map"===e&&window.WGST.geo.map.remove()},window.WGST.exports.showFullscreen=function(e){$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').removeClass("wgst--hide-this wgst--invisible-this"),window.WGST.exports.happenedShowFullscreen(e)},window.WGST.exports.hideFullscreen=function(e){$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').addClass("wgst--hide-this wgst--invisible-this"),window.WGST.exports.happenedHideFullscreen(e)},window.WGST.exports.isFullscreenExists=function(e){return $('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').length>0?!0:!1},window.WGST.exports.toggleFullscreen=function(e){var l=$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]');l.is(".wgst--hide-this, .wgst--invisible-this")?window.WGST.exports.showFullscreen(e):window.WGST.exports.hideFullscreen(e)},window.WGST.exports.bringFullscreenToFront=function(e){window.WGST.exports.bringContainerToFront("fullscreen",e)},window.WGST.exports.bringFullscreenToBack=function(e){$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').css("z-index","auto")},window.WGST.exports.bringFullscreenToPanel=function(e,l){if(0!==$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').length){var n=e.split("__")[0],t=e,o=e.split("__")[1],s=n,o=$("[data-collection-tree-content]").attr("data-collection-id"),a=$("[data-collection-tree-content]").attr("data-collection-tree-type");if(window.WGST.exports.createPanel(n,{panelId:t,panelType:n,collectionId:o}),"undefined"!=typeof l&&l(),"collection-data"===s){var i=$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').find(".wgst-panel-body"),r=$('.wgst-panel[data-panel-id="'+t+'"]');r.find(".wgst-panel-body").replaceWith(i.clone(!0)),r.find(".wgst-collection-controls").removeClass("wgst--hide-this")}else if("collection-map"===s)$('.wgst-panel[data-panel-id="'+t+'"]').find(".wgst-panel-body-container").append(window.WGST.geo.map.canvas.getDiv());else if("collection-tree"===s){var c=$('[data-fullscreen-type="collection-tree"]').find("[data-collection-tree-content]");$('.wgst-panel[data-panel-id="'+e+'"]').find(".wgst-panel-body-container").html("").append(c)}else if("assembly"===s){var i=$('[data-fullscreen-type="assembly"]');$('.wgst-panel[data-panel-id="'+e+'"]').find(".wgst-panel-body-container").html("").append(i.html())}else if("assembly-upload-progress"===s){var i=$('[data-fullscreen-type="assembly-upload-progress"]');$('.wgst-panel[data-panel-id="'+e+'"]').find(".wgst-panel-body-container").html("").append(i.html())}window.WGST.exports.removeFullscreen(e),window.WGST.exports.showPanel(t),"collection-map"===s?google.maps.event.trigger(window.WGST.geo.map.canvas,"resize"):"collection-tree"===n&&(window.WGST.collection[o].tree[a].canvas.resizeToContainer(),window.WGST.collection[o].tree[a].canvas.draw()),window.WGST.exports.bringPanelToFront(t),window.WGST.exports.happenedFullscreenToPanel(e)}},window.WGST.exports.bringPanelToFullscreen=function(e){var l=e.split("__")[0],n=e;if(!window.WGST.exports.isFullscreenExists(n)){window.WGST.exports.createFullscreen(n,{fullscreenType:l,fullscreenId:n});var t=$('.wgst-panel[data-panel-id="'+e+'"]').attr("data-panel-type"),o=$('.wgst-fullscreen[data-fullscreen-id="'+n+'"]');if("collection-data"===t){var s=$('.wgst-panel[data-panel-id="'+e+'"]').find(".wgst-panel-body");s.clone(!0).appendTo(o),o.find(".wgst-collection-controls").addClass("wgst--hide-this")}else if("collection-map"===t)$('.wgst-fullscreen[data-fullscreen-id="'+n+'"]').find(".wgst-map").replaceWith(window.WGST.geo.map.canvas.getDiv());else if("collection-tree"===t){var a=$('[data-panel-type="collection-tree"]').find("[data-collection-tree-content]");$('.wgst-fullscreen[data-fullscreen-id="'+n+'"]').html("").append(a)}else if("assembly"===t){var i=$('[data-panel-type="assembly"]').find(".wgst-panel-body-container");$('.wgst-fullscreen[data-fullscreen-id="'+n+'"]').html("").append(i.html())}else if("assembly-upload-progress"===t){var r=$('[data-panel-type="assembly-upload-progress"]').find(".wgst-panel-body-container");$('.wgst-fullscreen[data-fullscreen-id="'+n+'"]').html("").append(r.html())}if(window.WGST.exports.showFullscreen(n),"collection-map"===t)google.maps.event.trigger(window.WGST.geo.map.canvas,"resize");else if("collection-tree"===t){var c=$('[data-fullscreen-type="collection-tree"]'),d={width:c.outerWidth(),height:c.outerHeight()};console.log("fullscreenDimensions:"),console.dir(d);var p=c.find(".wgst-tree-controls"),w={width:p.outerWidth(),height:p.outerHeight()};console.log("treeControlsDimensions:"),console.dir(w);var u={width:d.width,height:d.height-w.height};console.log("canvasDimensions:"),console.dir(u),$('[data-fullscreen-type="collection-tree"]').find(".wgst-tree-content").width(u.width),$('[data-fullscreen-type="collection-tree"]').find(".wgst-tree-content").height(u.height);var f=$("[data-collection-tree-content]").attr("data-collection-id"),g=$("[data-collection-tree-content]").attr("data-collection-tree-type");window.WGST.collection[f].tree[g].canvas.resizeToContainer(),window.WGST.collection[f].tree[g].canvas.draw()}window.WGST.exports.removePanel(e),window.WGST.exports.happenedPanelToFullscreen(e)}}}()});
$(function(){!function(){window.WGST.exports.createHidable=function(e,t,a){if(!($('.wgst-hidable[data-hidable-id="'+e+'"]').length>0)){var d={hidableId:e,hidableLabel:t};"undefined"!=typeof a&&$.extend(d,a),window.WGST.exports.isHidableTree(e)||("undefined"!=typeof e.split("__")[0]&&"assembly"===e.split("__")[0]?d.close=!0:("assembly-upload-navigation"===e||"assembly-upload-analytics"===e||"assembly-upload-metadata"===e)&&(d.noFullscreen=!0,d.close=!1)),"panel"===window.WGST.exports.getContainerType(e)?d.isPanel=!0:"fullscreen"===window.WGST.exports.getContainerType(e)&&(d.isFullscreen=!0);var i="hidable",s=$('.wgst-template[data-template-id="'+i+'"]').html(),n=Handlebars.compile(s),l=n(d);$(".wgst-hidables").prepend(l),window.WGST.exports.isHidableTree(e)&&window.WGST.exports.happenedHidePanel(e),window.WGST.exports.showSidebar()}},window.WGST.exports.isHidableTree=function(e){return"undefined"!=typeof e.split("__")[2]?!0:!1},window.WGST.exports.removeHidable=function(e){window.WGST.exports.isContainerExists(e)||($('.wgst-hidable[data-hidable-id="'+e+'"]').remove(),0===$(".wgst-hidable").length&&window.WGST.exports.hideSidebar())},$("body").on("mouseenter",".wgst-hidable",function(){var e=$(this).find(".wgst-hidable-controls");e.toggleClass("wgst--hide-this")}),$("body").on("mouseleave",".wgst-hidable",function(){$(this).find(".wgst-hidable-controls").addClass("wgst--hide-this")}),$("body").on("click",'[data-wgst-hidable-button="fullscreen"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id");console.log("A1"),$('.wgst-panel[data-panel-id="'+t+'"]').length>0&&(console.log("A2"),window.WGST.exports.maximizePanel(t),$(this).closest("[data-wgst-hidable-controls]").find('[data-wgst-hidable="fullscreen"]').addClass("wgst--hide-this"),$(this).closest("[data-wgst-hidable-controls]").find('[data-wgst-hidable="panel"]').removeClass("wgst--hide-this")),e.preventDefault()}),$("body").on("click",'[data-wgst-hidable-button="panel"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id");$('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').length>0&&(window.WGST.exports.bringFullscreenToPanel(t),window.WGST.exports.showPanel(t),$(this).closest("[data-wgst-hidable-controls]").find('[data-wgst-hidable="fullscreen"]').removeClass("wgst--hide-this"),$(this).closest("[data-wgst-hidable-controls]").find('[data-wgst-hidable="panel"]').addClass("wgst--hide-this")),e.preventDefault()}),$("body").on("click",'[data-wgst-hidable-button="show"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id");$('.wgst-panel[data-panel-id="'+t+'"]').length>0?(window.WGST.exports.showPanel(t),window.WGST.exports.bringPanelToFront(t)):$('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').length>0&&window.WGST.exports.showFullscreen(t),e.preventDefault()}),$("body").on("click",'[data-wgst-hidable-button="hide"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id");$('.wgst-panel[data-panel-id="'+t+'"]').length>0?window.WGST.exports.hidePanel(t):$('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').length>0&&window.WGST.exports.hideFullscreen(t),e.preventDefault()}),$("body").on("click",'[data-wgst-hidable-button="close"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id");window.WGST.exports.isContainerExists(t)&&window.WGST.exports.removeContainer(t),window.WGST.exports.removeHidable(t),e.preventDefault()}),$("body").on("click",'[data-wgst-hidable-button="focus"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id"),a=$('.wgst-panel[data-panel-id="'+t+'"]');if(a.length>0){var d;$(".wgst-panel").each(function(){d=$(this).attr("data-panel-id"),d!==t&&window.WGST.exports.hidePanel(d)}),(a.hasClass("wgst--hide-this")||a.hasClass("wgst--invisible-this"))&&window.WGST.exports.showPanel(t)}else $('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').length>0&&($(".wgst-panel").each(function(){d=$(this).attr("data-panel-id"),window.WGST.exports.hidePanel(d)}),window.WGST.exports.showFullscreen(t));e.preventDefault()}),window.WGST.exports.happenedPanelToFullscreen=function(e){$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="panel"]').removeClass("wgst--hide-this"),$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="fullscreen"]').addClass("wgst--hide-this")},window.WGST.exports.happenedFullscreenToPanel=function(e){$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="panel"]').addClass("wgst--hide-this"),$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="fullscreen"]').removeClass("wgst--hide-this")},window.WGST.exports.happenedCreatePanel=function(e){window.WGST.exports.createHidable(e.panelId,e.panelLabel)},window.WGST.exports.happenedHidePanel=function(e){$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="show"]').removeClass("wgst--hide-this"),$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="hide"]').addClass("wgst--hide-this")},window.WGST.exports.happenedShowPanel=function(e){$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="hide"]').removeClass("wgst--hide-this"),$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="show"]').addClass("wgst--hide-this")},window.WGST.exports.happenedRemovePanel=function(e){window.WGST.exports.removeHidable(e)},window.WGST.exports.happenedCreateFullscreen=function(e){window.WGST.exports.createHidable(e.fullscreenId,e.fullscreenLabel)},window.WGST.exports.happenedHideFullscreen=function(e){window.WGST.exports.happenedHidePanel(e)},window.WGST.exports.happenedShowFullscreen=function(e){window.WGST.exports.happenedShowPanel(e)},window.WGST.exports.happenedRemoveFullscreen=function(e){window.WGST.exports.removeHidable(e)}}()});
window.WGST=window.WGST||{},$(function(){window.chrome||$(".wgst-chrome-only").removeClass("wgst--hide-this")});
$(function(){!function(){var o,e=[],n=function(o,e){for(var n,a,t,i,r={},s=window.WGST.collection[o].assemblies,g=0;g<e.length;g++)n=e[g],a=s[n].ASSEMBLY_METADATA.geography.position.latitude,t=s[n].ASSEMBLY_METADATA.geography.position.longitude,i=new google.maps.LatLng(a,t),"undefined"==typeof r[i.toString()]&&(r[i.toString()]=[]),r[i.toString()].push(n);return console.log("[WGST] Assembly ids grouped by position:"),console.dir(r),r},a=function(o,n){var a={groupAssemblies:n,location:n[0].ASSEMBLY_METADATA.geography.address},t=$('.wgst-template[data-template-id="info-window"]').html(),i=Handlebars.compile(t),r=i(a),s=new google.maps.InfoWindow({content:'<div class="test">'+r+"</div>"}),g=n.map(function(o){return o.ASSEMBLY_METADATA.assemblyId});return google.maps.event.addListener(s,"closeclick",function(){0!==typeof e.length&&window.WGST.collection[o].tree.COLLECTION_TREE.canvas.setNodeColourAndShape(g,null,"o",null,null)}),s},t=function(e,n){var t=n.map(function(o){return o.ASSEMBLY_METADATA.assemblyId}),i=n[0].ASSEMBLY_METADATA.geography.position.latitude,r=n[0].ASSEMBLY_METADATA.geography.position.longitude,s=n.length,g="//chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+s+"|00FFFF|000000",l=new google.maps.LatLng(i,r),p=l.toString();window.WGST.geo.map.markers.group[p]={assemblyIds:t,marker:{}},window.WGST.geo.map.markers.group[p].marker=new google.maps.Marker({position:l,map:window.WGST.geo.map.canvas,icon:g,optimized:!0});var d=a(e,n);google.maps.event.addListener(window.WGST.geo.map.markers.group[p].marker,"click",function(){"undefined"!=typeof o&&(o.close(),google.maps.event.trigger(o,"closeclick")),d.open(window.WGST.geo.map.canvas,window.WGST.geo.map.markers.group[p].marker),o=d,window.WGST.collection[e].tree.COLLECTION_TREE.canvas.setNodeColourAndShape(t,null,"t",null,null)})},i=function(){var o,e,n=WGST.geo.map.markers.group;for(o in n)e=n[o].marker,e.setMap(null),delete WGST.geo.map.markers.group[o];$(".show-all-assemblies-on-map").prop("checked",!1)};window.WGST.exports.triggerMapMarkers=function(o,e){var a=new google.maps.LatLngBounds;if(i(),e.length>0){var r,s,g,l=n(o,e),p=window.WGST.collection[o].assemblies;for(r in l)if(l.hasOwnProperty(r)){var d,m=l[r],c=[];m.map(function(o){d=p[o],c.push(d)}),t(o,c),s=d.ASSEMBLY_METADATA.geography.position.latitude,g=d.ASSEMBLY_METADATA.geography.position.longitude,a.extend(new google.maps.LatLng(s,g))}}a.isEmpty()?(window.WGST.geo.map.canvas.setCenter(new google.maps.LatLng(48.6908333333,9.14055555556)),window.WGST.geo.map.canvas.setZoom(5)):(window.WGST.geo.map.canvas.panToBounds(a),window.WGST.geo.map.canvas.fitBounds(a))}}()});
$(function(){$('[data-navigation-id="feedback"]').on("click",function(e){window.WGST.exports.createOverlay("feedback"),e.preventDefault()})});
$(function(){!function(){window.WGST.exports.mapOverlayTypeToTemplateId={feedback:"feedback-overlay"},window.WGST.exports.createOverlay=function(e,a){if(!($('.wgst-overlay[data-overlay-id="'+e+'"]').length>0)){"undefined"==typeof a&&(a={});var t=window.WGST.exports.mapOverlayTypeToTemplateId[e],o=$('.wgst-template[data-template-id="'+t+'"]').html(),r=Handlebars.compile(o),l=r(a);$(".wgst-page__app").prepend(l)}},window.WGST.exports.removeOverlay=function(e){$('.wgst-overlay[data-overlay-id="'+e+'"]').remove()},$("body").on("click",".wgst-close-overlay",function(e){var a=$(this).closest(".wgst-overlay").attr("data-overlay-id");window.WGST.exports.removeOverlay(a),e.preventDefault()})}()});
$(function(){!function(){window.WGST.exports.mapPanelTypeToPanelHeaderTemplateId={assembly:"panel-header__assembly","collection-data":"panel-header__collection-data","collection-tree":"panel-header__collection-tree","collection-map":"panel-header__collection-map","assembly-upload-metadata":"panel-header__assembly-upload-metadata","assembly-upload-navigation":"panel-header__assembly-upload-navigation","assembly-upload-analytics":"panel-header__assembly-upload-analytics","assembly-upload-progress":"panel-header__assembly-upload-progress"},window.WGST.exports.mapPanelTypeToPanelBodyTemplateId={assembly:"panel-body__assembly","collection-data":"panel-body__collection-data","collection-tree":"panel-body__collection-tree","collection-map":"panel-body__collection-map","assembly-upload-metadata":"panel-body__assembly-upload-metadata","assembly-upload-navigation":"panel-body__assembly-upload-navigation","assembly-upload-analytics":"panel-body__assembly-upload-analytics","assembly-upload-progress":"panel-body__assembly-upload-progress"},window.WGST.exports.mapPanelTypeToPanelButtonRules={assembly:{},"collection-data":{noCloseButton:!0},"collection-tree":{noCloseButton:!0},"collection-map":{noCloseButton:!0},"assembly-upload-metadata":{noFullscreenButton:!0,noCloseButton:!0},"assembly-upload-navigation":{noFullscreenButton:!0,noCloseButton:!0},"assembly-upload-analytics":{noFullscreenButton:!0,noCloseButton:!0},"assembly-upload-progress":{noCloseButton:!0}},window.WGST.exports.createPanel=function(e,a){if(console.log("createPanel()"),console.log("panelType:"+e),console.dir(a),$('.wgst-panel[data-panel-id="'+a.panelId+'"]').length>0)return window.WGST.exports.showPanel(a.panelId),void 0;$.extend(a,window.WGST.exports.mapPanelTypeToPanelButtonRules[e]),"undefined"==typeof a.panelLabel&&(a.panelLabel=window.WGST.exports.getContainerLabel({containerName:"panel",containerType:e,containerId:a.panelId,additional:a}));var n=$('.wgst-template[data-template-id="panel"]').html(),l=Handlebars.compile(n),o=window.WGST.exports.mapPanelTypeToPanelHeaderTemplateId[e];Handlebars.registerPartial("header",$('.wgst-template[data-template-id="'+o+'"]').html());var t=window.WGST.exports.mapPanelTypeToPanelBodyTemplateId[e];Handlebars.registerPartial("body",$('.wgst-template[data-template-id="'+t+'"]').html());var s=l(a);$(".wgst-workspace").prepend(s);var d=$('.wgst-panel[data-panel-id="'+a.panelId+'"]');d.draggable({handle:d.find(".wgst-draggable-handle"),appendTo:".wgst-page__app",scroll:!1}),window.WGST.exports.happenedCreatePanel({panelId:a.panelId,panelLabel:a.panelLabel})},window.WGST.exports.removePanel=function(e){$('.wgst-panel[data-panel-id="'+e+'"]').remove(),window.WGST.exports.happenedRemovePanel(e),"collection-map"===e&&window.WGST.geo.map.remove()},window.WGST.exports.showPanel=function(e){$('.wgst-panel[data-panel-id="'+e+'"]').removeClass("wgst--hide-this wgst--invisible-this"),window.WGST.exports.happenedShowPanel(e)},window.WGST.exports.hidePanel=function(e){$('.wgst-panel[data-panel-id="'+e+'"]').addClass("wgst--invisible-this"),window.WGST.exports.happenedHidePanel(e)},window.WGST.exports.isPanelExists=function(e){return $('.wgst-panel[data-panel-id="'+e+'"]').length>0?!0:!1},window.WGST.exports.togglePanel=function(e){var a=$('.wgst-panel[data-panel-id="'+e+'"]');a.is(".wgst--hide-this, .wgst--invisible-this")?window.WGST.exports.showPanel(e):window.WGST.exports.hidePanel(e)},window.WGST.exports.bringPanelToFront=function(e){window.WGST.exports.bringContainerToFront("panel",e)},window.WGST.exports.maximizePanel=function(e){var a=$(".wgst-fullscreen").attr("data-fullscreen-id");console.log("Test"),window.WGST.exports.bringFullscreenToPanel(a),window.WGST.exports.hidePanel(a),window.WGST.exports.bringPanelToFullscreen(e),google.maps.event.trigger(window.WGST.geo.map.canvas,"resize")},$("body").on("click",'[data-panel-header-control-button="fullscreen"]',function(){var e=$(this).closest(".wgst-panel"),a=e.attr("data-panel-id");console.log("X"),console.log("panelId: "+a),$('[data-hidable-id="'+a+'"]').find('[data-wgst-hidable-button="fullscreen"]').trigger("click")}),$("body").on("click",'[data-panel-header-control-button="close"]',function(){var e=$(this).closest(".wgst-panel"),a=e.attr("data-panel-id");$('[data-hidable-id="'+a+'"]').find('[data-wgst-hidable-button="close"]').trigger("click")}),$("body").on("click",'[data-panel-header-control-button="hide"]',function(){var e=$(this).closest(".wgst-panel"),a=e.attr("data-panel-id");$('[data-hidable-id="'+a+'"]').find('[data-wgst-hidable-button="hide"]').trigger("click")}),$("body").on("mousedown",".wgst-panel",function(){window.WGST.exports.bringPanelToFront($(this).attr("data-panel-id"))})}()});
$(function(){!function(){window.WGST.exports.showSidebar=function(){$("[data-wgst-sidebar]").removeClass("wgst--hide-this")},window.WGST.exports.hideSidebar=function(){$("[data-wgst-sidebar]").addClass("wgst--hide-this")}}()});
$(function(){!function(){$("body").on("submit",'[data-form="subscribe"]',function(s){console.log("[WGST] Submitting subscribe form..."),s.preventDefault();var e=$('[data-form="subscribe"]'),o=e.find('[data-input="email"]').val();if("undefined"==typeof o||""===o)return console.error("[WGST][Validation][Error] ✗ No email"),void 0;var i=$(this).find('[type="submit"]');i.prop("disabled",!0),i.find("span").addClass("wgst--hide-this"),i.find(".wgst-spinner").removeClass("wgst--hide-this");var r={email:o};console.dir(r),$.ajax({type:"POST",url:"/subscribe/",datatype:"json",data:r}).done(function(){console.log("[WGST] Subscribed"),i.addClass("wgst--hide-this"),$(".wgst-subscribe-success-message").removeClass("wgst--hide-this")}).fail(function(s,e,o){console.log("[WGST][Error] Failed to subscribe"),console.error(e),console.error(o),console.error(s)})})}()});
$(function(){!function(){window.WGST.exports.populateListOfAntibiotics=function(i){var o,t,n=[],e={};for(o in WGST.antibiotics)for(t in WGST.antibiotics[o])n.push(t),e[t]='<option value="'+t.replace(WGST.antibioticNameRegex,"_").toLowerCase()+'">'+t+"</option>";n.sort();var a=n.length;for(a=0;a<n.length;)t=n[a],i.append($(e[t])),a+=1}}()});
String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},window.WGST.regex=window.WGST.regex||{},window.WGST.regex.EMAIL=/^(([^<>()[]\.,;:s@"]+(.[^<>()[]\.,;:s@"]+)*)|(".+"))@(([[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}])|(([a-zA-Z-0-9]+.)+[a-zA-Z]{2,}))$/;
$(function(){window.WGST=window.WGST||{},window.WGST.exports=window.WGST.exports||{},window.WGST.exports.mixpanel=window.WGST.exports.mixpanel||{},$('[data-mixpanel-open-collection="Reference"]').on("click",function(){mixpanel.track("Landing > Open reference collection")}),$('[data-mixpanel-open-collection="ST239"]').on("click",function(){mixpanel.track("Landing > Open ST239 collection")}),$('[data-mixpanel-open-collection="EMRSA15"]').on("click",function(){mixpanel.track("Landing > Open EMRSA15 collection")}),$('[data-mixpanel-button="subscribe"]').on("click",function(){mixpanel.track("Landing > Open EMRSA15 collection")}),$("body").on("click",'[data-mixpanel-navigation="feedback"]',function(){mixpanel.track("App > Open feedback")}),$("body").on("click",'[data-mixpanel-navigation="landing"]',function(){mixpanel.track("App > Go to landing page")}),$("body").on("click",'[data-mixpanel-show-tree-button="CORE_TREE_RESULT"]',function(){mixpanel.track("App | Collection Data Panel > Open CORE_TREE_RESULT tree")}),$("body").on("click","[data-mixpanel-open-assembly-panel]",function(){if($(this).is("[title]")){var n=$(this).attr("title");mixpanel.track("App | Collection Data Panel > Open assembly"),mixpanel.track("App | Collection Data Panel > Open assembly "+n)}}),window.WGST.exports.mixpanel.submitFeedback=function(){mixpanel.track("App > Submit feedback")},$('[data-mixpanel-not-found-navigation="homepage"]').on("click",function(){mixpanel.track("404 > Go to landing page")})});
$(function(){!function(){window.WGST.upload={collection:{},assembly:{},fastaAndMetadata:{},stats:{totalNumberOfContigs:0}},window.WGST.dragAndDrop={files:[],droppedFiles:[],droppedValidFiles:[],loadedFiles:[],fastaFileNameRegex:/^.+(.fa|.fas|.fna|.ffn|.faa|.frn|.fasta|.contig)$/i,csvFileTypeRegex:/^.+(.csv)$/i},window.WGST.exports.initFastaAndMetadata=function(a){"undefined"==typeof window.WGST.upload.fastaAndMetadata[a]&&(window.WGST.upload.fastaAndMetadata[a]={fasta:{name:a,assembly:""},metadata:{}})};var a=function(){var a=$('[data-wgst-background-id="drag-and-drop"]');a.find(".wgst-drag-and-drop-content").addClass("wgst-drag-over"),a.find(".wgst-drag-and-drop-content").find(".fa").addClass("animated bounce")},e=function(a){return a.preventDefault&&a.preventDefault(),a.dataTransfer.dropEffect="copy",!1},n=function(){var a=$('[data-wgst-background-id="drag-and-drop"]');a.find(".wgst-drag-and-drop-content").removeClass("wgst-drag-over"),a.find(".wgst-drag-and-drop-content").find(".fa").removeClass("animated bounce")},t=function(a){var e=a.content,n=Papa.parse(e,{header:!0,dynamicTyping:!0});return n.data},o=function(a,e){var n=moment(e,"DD-MM-YYYY");if(!n.isValid())return console.error("[WGST] Invalid assembly metadata date: "+e),void 0;var t=n.year();$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').find('[data-timestamp-input="year"]').val(t).change();var o=n.month();$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').find('[data-timestamp-input="month"]').val(o).change();var d=n.date();$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').find('[data-timestamp-input="day"]').val(d).change()},d=new google.maps.Geocoder,s=function(a,e){d.geocode({address:a},function(a,n){n==google.maps.GeocoderStatus.OK?e(null,a[0]):e(n,null)})},i={READY:1,BUSY:0},l=1e3,r=i.READY,u=0,c=function(a,e){setTimeout(function(){var n=e;return r===i.BUSY?(u+=l,c(a,e),void 0):(r=i.BUSY,s(n,function(e,t){if(e)return console.error("[WGST] Could not geocode "+n+": "+e),void 0;console.log("[WGST] Geocodeded "+n);var o=t.formatted_address,d=t.geometry.location.lat(),s=t.geometry.location.lng();$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').find(".assembly-sample-location-input").val(o).change(),window.WGST.exports.setAssemblyUploadMetadataModel(a,"geography",{address:o,position:{latitude:d,longitude:s},type:"Unknown"}),window.WGST.exports.updateMetadataProgressBar(),r=i.READY}),void 0)},u)},p=function(a,e){var n=e;$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').find(".assembly-sample-source-input").val(n).change()},g=function(a){0===$(".wgst-dropped-assembly-list").find('option[value="'+a+'"]').length&&$(".wgst-dropped-assembly-list").append('<option value="'+a+'">'+a+"</option>")},f=function(){$(".wgst-assembly-metadata-block").removeClass("wgst--hide-this")},m=function(a){console.log("[WGST] Parsing CSV file: "+a.name),console.dir(a);var e=t(a);console.log("CSV data result:"),console.dir(e),e.forEach(function(e){if("undefined"==typeof e.filename)return console.error("[WGST] Invalid assembly filename in metadata file "+a.name),void 0;var n=e.filename;window.WGST.exports.initFastaAndMetadata(n),window.WGST.exports.renderAssemblyMetadataForm(n),window.WGST.exports.initAssemblyMetadataLocation(n),"undefined"!=typeof e.date&&o(n,e.date),"undefined"!=typeof e.location&&c(n,e.location),"undefined"!=typeof e.source&&p(n,e.source),f(),g(n)})},w=function(a){return a.sort(function(a,e){return a.name>e.name?1:a.name<e.name?-1:0}),a},S=function(a){console.log("[WGST] Parsing FASTA file: "+a.name),console.dir(a);var e=a.name,n=a.content;window.WGST.exports.initFastaAndMetadata(e),window.WGST.upload.fastaAndMetadata[e].fasta.assembly=n;var t=D(e,n);window.WGST.exports.renderAssemblyAnalytics(e,t),window.WGST.exports.drawN50Chart(t.sumsOfNucleotidesInDnaStrings,t.assemblyN50Data,'.sequence-length-distribution-chart[data-assembly-file-id="'+e+'"]'),window.WGST.exports.renderAssemblyMetadataForm(e),window.WGST.exports.initAssemblyMetadataLocation(e),g(e)},v=function(a){return a.name.match(window.WGST.dragAndDrop.fastaFileNameRegex)},y=function(a){return a.name.match(window.WGST.dragAndDrop.csvFileTypeRegex)},b=function(a){return v(a)||y(a)?!0:!1},T=function(a){for(var e,n={validFiles:[],invalidFiles:[]},t=a.length;0!==t;)t-=1,e=a[t],b(e)?n.validFiles.push(e):n.invalidFiles.push(e);return n},G=function(a,e){console.log("[WGST] Loading dropped file: "+a.name);var n=new FileReader;n.onload=function(n){console.log("[WGST] Loaded dropped file: "+a.name),e(null,n.target.result)},n.readAsText(a)},W=function(a,e){var n=[];a.map(function(t){G(t,function(o,d){return o?(console.error("[WGST] Failed to load dropped file: "+o),void 0):(n.push({name:t.name,content:d}),n.length===a.length&&e(null,n),void 0)})})},h=function(a){var e=a[0],n="Unknown";if(y(e)){var o=t(e);n=o[0].filename}else v(e)&&(n=a[0].name);return n},N=function(a){var e=w(a);console.log("sortedLoadedDroppedFiles:"),console.dir(e),window.WGST.exports.showSidebar(),window.WGST.exports.createPanel("assembly-upload-navigation",{panelType:"assembly-upload-navigation",panelId:"assembly-upload-navigation"}),window.WGST.exports.showPanel("assembly-upload-navigation"),window.WGST.exports.createPanel("assembly-upload-metadata",{panelType:"assembly-upload-metadata",panelId:"assembly-upload-metadata"}),window.WGST.exports.showPanel("assembly-upload-metadata"),window.WGST.exports.createPanel("assembly-upload-analytics",{panelType:"assembly-upload-analytics",panelId:"assembly-upload-analytics"}),window.WGST.exports.showPanel("assembly-upload-analytics");var n="collection-map",t=n;window.WGST.exports.createFullscreen(t,{fullscreenType:n,fullscreenId:t}),window.WGST.exports.showFullscreen(t),window.WGST.geo.map.init(),e.map(function(a){y(a)?m(a):v(a)?S(a):console.error("[WGST] Unsupported file type.")}),window.WGST.exports.showAssemblyUpload(h(e)),$('[data-wgst-background-id="drag-and-drop"]').addClass("wgst--hide-this")},x=function(a){if(window.WGST.config.allowUpload){var e=$('[data-wgst-background-id="drag-and-drop"]');if(e.find(".wgst-drag-and-drop-content").find(".fa").removeClass("animated bounce"),e.find(".wgst-drag-and-drop-content").find(".fa").addClass("animated pulse"),$("[data-wgst-drag-and-drop-ready]").addClass("wgst--hide-this"),$("[data-wgst-drag-and-drop-analysing-data]").removeClass("wgst--hide-this"),a.dataTransfer.files.length>0){a.stopPropagation(),a.preventDefault();var n=a.dataTransfer.files,t=T(n);return W(t.validFiles,function(a,e){console.log("loadedDroppedFiles:"),console.dir(e),N(e)}),void 0}}},D=function(a,e){var n=window.WGST.exports.extractContigsFromFastaFileString(e),t=n.length,o=window.WGST.exports.extractDnaStringsFromContigs(n),d=window.WGST.exports.calculateN50(o),s=d.sequenceLength,i=window.WGST.exports.calculateSumsOfNucleotidesInDnaStrings(o),l=window.WGST.exports.calculateTotalNumberOfNucleotidesInDnaStrings(o),r=window.WGST.exports.calculateAverageNumberOfNucleotidesInDnaStrings(o),u=window.WGST.exports.calculateSmallestNumberOfNucleotidesInDnaStrings(o),c=window.WGST.exports.calculateBiggestNumberOfNucleotidesInDnaStrings(o);return window.WGST.exports.validateContigs(n),console.log("[WGST] * dev * dnaStrings:"),console.dir(o),console.log("[WGST] * dev * totalNumberOfNucleotidesInDnaStrings: "+l),console.log("[WGST] * dev * averageNumberOfNucleotidesInDnaStrings: "+r),console.log("[WGST] * dev * smallestNumberOfNucleotidesInDnaStrings: "+u),console.log("[WGST] * dev * biggestNumberOfNucleotidesInDnaStrings: "+c),window.WGST.upload.stats.totalNumberOfContigs=window.WGST.upload.stats.totalNumberOfContigs+n.length,{totalNumberOfContigs:t,dnaStrings:o,assemblyN50Data:d,contigN50:s,sumsOfNucleotidesInDnaStrings:i,totalNumberOfNucleotidesInDnaStrings:l,averageNumberOfNucleotidesInDnaStrings:r,smallestNumberOfNucleotidesInDnaStrings:u,biggestNumberOfNucleotidesInDnaStrings:c}},F=$("[data-wgst-drag-and-drop-zone]")[0];F.addEventListener("dragenter",a,!1),F.addEventListener("dragover",e,!1),F.addEventListener("dragleave",n,!1),F.addEventListener("drop",x,!1)}()});
$(function(){!function(){window.WGST.exports.isAssemblyAnalyticsExists=function(e){return 0===$('.wgst-upload-assembly__analytics[data-assembly-file-id="'+e+'"]').length?!1:!0},window.WGST.exports.renderAssemblyAnalytics=function(e,t){if(!window.WGST.exports.isAssemblyAnalyticsExists(e)){var s=t.totalNumberOfNucleotidesInDnaStrings,n=t.totalNumberOfContigs,i=t.smallestNumberOfNucleotidesInDnaStrings,a=t.averageNumberOfNucleotidesInDnaStrings,l=t.biggestNumberOfNucleotidesInDnaStrings,r=t.contigN50,o={assemblyFileId:e,totalNumberOfNucleotidesInDnaStrings:s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),totalNumberOfContigs:n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),smallestNumberOfNucleotidesInDnaStrings:i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),averageNumberOfNucleotidesInDnaStrings:a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),biggestNumberOfNucleotidesInDnaStrings:l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),contigN50:r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},d=$('.wgst-template[data-template-id="droppedAssemblyAnalytics"]').html(),g=Handlebars.compile(d),c=g(o);$(".wgst-assembly-upload__analytics ul").append($(c))}}}()});
$(function(){!function(){window.WGST.exports.setAssemblyMetadataValue=function(a){var t=a.assemblyFileId,e=a.assemblyMetadataKey,d=a.assemblyMetadataValue;"datetime"===e?window.WGST.upload.fastaAndMetadata[t].metadata.datetime=d:"geography"===e?(window.WGST.upload.fastaAndMetadata[t].metadata.geography={address:"",position:{latitude:"",longitude:""},type:""},window.WGST.upload.fastaAndMetadata[t].metadata.geography.address=d.address,window.WGST.upload.fastaAndMetadata[t].metadata.geography.position.latitude=d.position.latitude,window.WGST.upload.fastaAndMetadata[t].metadata.geography.position.longitude=d.position.longitude,window.WGST.upload.fastaAndMetadata[t].metadata.geography.type=d.type):"source"===e&&(window.WGST.upload.fastaAndMetadata[t].metadata.source=d),window.WGST.exports.happenedSetAssemblyMetadata(a)},window.WGST.exports.copyAssemblyMetadata=function(a,t){var e=window.WGST.upload.fastaAndMetadata[a].metadata;Object.keys(e).map(function(a){window.WGST.exports.setAssemblyMetadataValue({assemblyFileId:t,assemblyMetadataKey:a,assemblyMetadataValue:e[a]})})},window.WGST.exports.copyAssemblyMetadataToAssembliesWithNoMetadata=function(a){var t=window.WGST.upload.fastaAndMetadata;Object.keys(t).map(function(e){var d=t[e].metadata;0===Object.keys(d).length&&(window.WGST.exports.copyAssemblyMetadata(a,e),window.WGST.exports.copyAssemblyMetadataView(a,e))})},window.WGST.exports.happenedSetAssemblyMetadata=function(a){return}}()});
$(function(){!function(){window.WGST.exports.isAssemblyMetadataFormExists=function(a){return 0===$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').length?!1:!0},window.WGST.exports.renderAssemblyMetadataForm=function(a){if(!window.WGST.exports.isAssemblyMetadataFormExists(a)){var e={assemblyFileId:a,listOfYears:window.WGST.exports.generateYears(1940,2014),listOfMonths:window.WGST.exports.generateMonths(),listOfDays:window.WGST.exports.generateDays()},s=$('.wgst-template[data-template-id="droppedAssemblyMetadataForm"]').html(),t=Handlebars.compile(s),l=t(e);$(".wgst-assembly-upload__metadata ul").append($(l))}},window.WGST.exports.renderAssemblyMetadataDateForm=function(a){if(!window.WGST.exports.isAssemblyMetadataFormExists(a)){var e={assemblyFileId:a,listOfYears:window.WGST.exports.generateYears(1940,2014),listOfMonths:window.WGST.exports.generateMonths(),listOfDays:window.WGST.exports.generateDays()},s=$('.wgst-template[data-template-id="droppedAssemblyMetadataForm"]').html(),t=Handlebars.compile(s),l=t(e);$(".wgst-assembly-upload__metadata ul").append($(l))}},window.WGST.exports.copyAssemblyMetadataView=function(a,e){var s=$(".wgst-panel__assembly-upload-metadata"),t=s.find('.wgst-upload-assembly__metadata[data-assembly-file-id="'+e+'"]');window.WGST.exports.copyAssemblyMetadataTimestamp(a,e);var l=s.find('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]');$sourceAssemblyMetadataLocation=l.find(".assembly-sample-location-input"),$sourceAssemblyMetadataSource=l.find(".assembly-sample-source-input"),t.find(".assembly-sample-location-input").val($sourceAssemblyMetadataLocation.val()),t.find(".assembly-sample-source-input").val($sourceAssemblyMetadataSource.val()),$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+e+'"] .wgst-assembly-metadata-block').removeClass("wgst--hide-this")}}()});
$(function(){!function(){var e=function(e,t){return 32-new Date(e,t,32).getDate()};window.WGST.exports.populateDaySelect=function(e,a,i){e.html("").append($('<option value="-1">Choose day</option>')).append(t(a,i))};window.WGST.exports.generateYears=function(e,t){for(var a=[],i=t;i!==e-1;)a.push(i),i-=1;return a};window.WGST.exports.generateMonths=function(){var e=["January","February","March","April","May","June","July","August","September","October","November","December"];return e=e.map(function(e,t){return{name:e,number:t}})};var t=function(t,a){if("undefined"==typeof t||"undefined"==typeof a)return"";for(var i,n=e(t,a),o=0,s='<option value="{{day}}">{{day}}</option>',r="";n>o;)o+=1,i=s.replace(/{{day}}/g,o),r+=i;return r};window.WGST.exports.generateDays=function(t,a){if("undefined"==typeof t||"undefined"==typeof a)return"";for(var i=[],n=e(t,a),o=0;n>o;)o+=1,i.push(o);return i},window.WGST.exports.isValidDateString=function(e){return moment(e).isValid()},window.WGST.exports.setAssemblyMetadataDateView=function(e,t){if(!window.WGST.exports.isValidDateString(t))return console.log("[WGST][Error] Date string is invalid."),void 0;var a=moment(dateString).year(),i=moment(dateString).month(),t=moment(dateString).date();console.log("year: "+a),console.log("month: "+i),console.log("date: "+t)},window.WGST.exports.copyAssemblyMetadataTimestamp=function(e,t){if(e!==t){var a=$('.assembly-metadata-timestamp-year[data-assembly-file-id="'+e+'"]'),i=a.find("select option:selected").val(),n=$('.assembly-metadata-timestamp-month[data-assembly-file-id="'+e+'"]'),o=n.find("select option:selected").val(),s=$('.assembly-metadata-timestamp-day[data-assembly-file-id="'+e+'"]'),r=s.find("select option:selected").val(),d=$('.assembly-metadata-timestamp-year[data-assembly-file-id="'+t+'"]'),l=$('.assembly-metadata-timestamp-month[data-assembly-file-id="'+t+'"]'),m=$('.assembly-metadata-timestamp-day[data-assembly-file-id="'+t+'"]'),p=m.find("select");"-1"!==i&&d.find('option[value="'+i+'"]').prop("selected",!0),"-1"!==o&&l.find('option[value="'+o+'"]').prop("selected",!0),"-1"!==r&&(window.WGST.exports.populateDaySelect(p,i,o),p.find('option[value="'+r+'"]').prop("selected",!0)),a.is(":visible")&&d.removeClass("wgst--hide-this"),n.is(":visible")&&l.removeClass("wgst--hide-this"),s.is(":visible")&&m.removeClass("wgst--hide-this")}}}()});
window.WGST.version=window.WGST.config.version,window.WGST.socket={connection:io.connect(window.WGST.config.socketAddress),roomId:""},window.WGST.speak=!1,window.WGST.panels={assembly:{top:80,left:90},collection:{top:80,left:90},collectionTree:{top:120,left:180},mergedCollectionTree:{top:120,left:180},representativeCollectionTree:{top:80,left:90},assemblyUploadNavigator:{top:70,left:110},assemblyUploadAnalytics:{top:70,left:726},assemblyUploadMetadata:{top:225,left:110},assemblyUploadProgress:{top:80,left:90},map:{top:"15%",left:"20%"}},window.WGST.assembly={analysis:{UPLOAD_OK:"UPLOAD_OK",METADATA_OK:"METADATA_OK",MLST_RESULT:"MLST_RESULT",PAARSNP_RESULT:"PAARSNP_RESULT",FP_COMP:"FP_COMP",CORE:"CORE"}},window.WGST.collection={analysis:{CORE_MUTANT_TREE:"CORE_MUTANT_TREE"},representative:{tree:{},metadata:{}}},window.WGST.settings=window.WGST.settings||{},window.WGST.settings.referenceCollectionId=window.WGST.config.referenceCollectionId,window.WGST.antibioticNameRegex=/[\W]+/g,$(function(){"use strict";if("undefined"==typeof window.WGST.requestedCollectionId&&window.WGST.isNewCollection!==!0)return $(".wgst-page__landing").removeClass("wgst--hide-this"),void 0;if($(".wgst-page__app").removeClass("wgst--hide-this"),window.WGST.speak){var e=new SpeechSynthesisUtterance("Welcome to WGSA");window.speechSynthesis.speak(e)}$("body").tooltip({selector:'[data-toggle="tooltip"]'}),window.onerror=function(e){"undefined"!=typeof e.message?console.error("[WGST][Error] "+e.message):(console.error("[WGST][Error]"),console.dir(e)),n(e)},window.WGST.geo={map:{initialised:!1,canvas:{},options:{zoom:5,center:new google.maps.LatLng(48.6908333333,9.14055555556),mapTypeId:google.maps.MapTypeId.ROADMAP,minZoom:2,maxZoom:11},markers:{assembly:{},metadata:{},representativeTree:[],group:{}},markerBounds:new google.maps.LatLngBounds,searchBoxBounds:new google.maps.LatLngBounds,init:function(){console.debug("*** 1 No no no ****"),this.initialised!==!0&&(console.debug("*** 2 No no no ****"),window.WGST.geo.map.canvas=new google.maps.Map($(".wgst-map")[0],window.WGST.geo.map.options),window.WGST.geo.map.initialised=!0,window.WGST.geo.map.markers.metadata=new google.maps.Marker({position:new google.maps.LatLng(51.511214,-.119824),map:window.WGST.geo.map.canvas,visible:!1}),google.maps.event.addListener(window.WGST.geo.map.canvas,"bounds_changed",function(){window.WGST.geo.map.searchBoxBounds=window.WGST.geo.map.canvas.getBounds()}))},remove:function(){window.WGST.geo.map.initialised=!1}},placeSearchBox:{}},window.WGST.alert={status:{SUCCESS:"success",FAILURE:"failure"}},window.WGST.init={all:{SOCKET_CONNECT:"Socket connected",SOCKET_ROOM_ID:"Received socket room id",REPRESENTATIVE_COLLECTION_TREE_METADATA:"Loaded representative collectiontree metadata"},loaded:[]};var o=function(e){if(WGST.init.loaded.push(e),WGST.init.loaded.length===Object.keys(WGST.init.all).length){var o=$(".wgst-init");o.find(".wgst-init-status").html(""),setTimeout(function(){o.fadeOut("fast")},500),delete window.WGST.init}};$(".tree-controls-draw-subtree").on("click",function(){var e=$(this).closest(".wgst-panel").attr("data-collection-id"),o=$(this).attr("data-selected-node");console.log("collectionId: "+e),console.log("selectedNode: "+o),WGST.collection[e].tree.canvas.redrawFromBranch(o)}),$(".collection-view-horizontal-split").on("click",function(){$(".wgst-paper__collection-tree"),$(".wgst-paper__collection-metadata")});var t=function(e,o,t){if(console.error("[WGST][Error] ✗ "+e),WGST.speak){var e=new SpeechSynthesisUtterance(e);window.speechSynthesis.speak(e),WGST.speak=!1}var n=$(".wgst-alert");n.attr("class","wgst-alert").addClass("wgst-alert__"+o),n.html(e).show(),t&&setTimeout(function(){n.fadeOut("fast")},3e3)},n=function(){var e=$(".wgst-notification__error");e.html("Please refresh your page.").show()};!function(){$(".wgst-draggable").draggable({handle:".wgst-draggable-handle",appendTo:"body",scroll:!1,start:function(){ringDragging=!0},stop:function(e,o){ringDragging=!1;var t=o.helper.attr("data-panel-name");WGST.panels[t].top=o.position.top,WGST.panels[t].left=o.position.left}}),WGST.socket.connection.on("roomId",function(e){console.log("[WGST][Socket.io] Received room id: "+e),console.log("[WGST][Socket.io] Ready"),WGST.socket.roomId=e,o(WGST.init.all.SOCKET_ROOM_ID)}),WGST.socket.connection.emit("getRoomId"),WGST.socket.connection.on("connect",function(){"undefined"!=typeof WGST.init&&o(WGST.init.all.SOCKET_CONNECT)}),WGST.socket.connection.on("error",function(){t("Unexpected error has occured.",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("disconnect",function(){t("Disconnected from the server.",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("reconnecting",function(){t("Reconnecting to the server...",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("reconnect",function(){t("Reconnected to the server.",WGST.alert.status.SUCCESS,!0)}),WGST.socket.connection.on("reconnect_failed",function(){t("Failed to reconnect to the server.",WGST.alert.status.FAILURE,!1)}),o(WGST.init.all.REPRESENTATIVE_COLLECTION_TREE_METADATA)}(),"undefined"!=typeof WGST.requestedCollectionId?window.WGST.exports.getCollection(WGST.requestedCollectionId):window.WGST.exports.showBackground("drag-and-drop");var i=function(e){for(var o,t,n=e,i=n.offset(),a=n.closest(".wgst-panel").attr("data-collection-id"),s=WGST.collection[a].tree.CORE_TREE_RESULT.canvas,l=s.leaves,c={top:s.translateClickY(i.top),left:s.translateClickX(i.left)},r={bottom:s.translateClickY(i.top+n.height()),right:s.translateClickX(i.left+n.width())},d=$(".collection-assembly-list"),T=$(".collection-assembly-list-full"),p=document.createDocumentFragment(),g=0,w=0;w<l.length;)t=l[w],t.centerx>=c.left&&t.centerx<=r.right&&t.centery>=c.top&&t.centery<=r.bottom&&(o=T.find('.assembly-list-item[data-assembly-id="'+t.id+'"]')[0],p.appendChild(o.cloneNode(!0)),g+=1),w+=1;g>7?$(".collection-assembly-list-more-assemblies").show():$(".collection-assembly-list-more-assemblies").hide();for(var S=d[0];S.firstChild;)S.removeChild(S.firstChild);S.appendChild(p),d.find('.antibiotic[data-toggle="tooltip"]').tooltip()};$("body").on("click",".tree-controls-match-assembly-list",function(){var e=$(this).closest(".wgst-panel-body-container").find("canvas.phylocanvas");i(e)})});