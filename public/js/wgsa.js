$(function(){!function(){window.WGST.exports.createAssemblyPanel=function(e,t){var s="assembly__"+e,a="assembly",n={panelId:s,panelType:a,assemblyId:e};return"undefined"!=typeof t&&$.extend(n,t),window.WGST.exports.createPanel(a,n),s},window.WGST.exports.calculateAssemblyTopScore=function(e){var t,s=[];for(t in e)e.hasOwnProperty(t)&&s.push({referenceId:e[t].referenceId,score:e[t].score});return s=s.sort(function(e,t){return t.score-e.score}),s[0]};var e=function(e){var t="";return t=0===e.length?"Not found":e},t=function(e,t){var s,a,n,r,o,i,l=[];for(n in e)if(e.hasOwnProperty(n)){r=e[n],s=[];for(o in r)r.hasOwnProperty(o)&&(a="","undefined"!=typeof t[n]?"undefined"!=typeof t[n][o]?(i=t[n][o],a="RESISTANT"===i?"RESISTANT":"SENSITIVE"===i?"SENSITIVE":"UNKNOWN"):a="UNKNOWN":a="UNKNOWN",s.push({antibioticName:o,antibioticResistanceData:a}));l.push({antibioticClassName:n,antibioticClassResistanceData:s})}return l},s=function(e){var t,s,a,n=[];for(a in e)e.hasOwnProperty(a)&&(t=e[a],s={},s=null===t?{locusId:"None",alleleId:a}:{locusId:e[a].locusId,alleleId:e[a].alleleId},n.push(s));return n},a=function(e){var t=window.WGST.exports.calculateAssemblyTopScore(e),s=t.referenceId;return s},n=function(e,t){for(var s=[],a=Object.keys(t).sort(function(e,s){return t[e]-t[s]}),n=a.length;0!==n;){n-=1;var r=a[n],o=t[r],i=o.score.toFixed(2)+" = "+Math.round(o.score*parseInt(e,10))+"/"+e;s.push({referenceId:o.referenceId,text:i})}return s};window.WGST.exports.getAssemblyData=function(e,t){$.ajax({type:"POST",url:"/api/assembly",datatype:"json",data:{assemblyId:e}}).done(function(e){t({assembly:e.assembly,antibiotics:e.antibiotics},null)}).fail(function(e,s){t(null,s)})},window.WGST.exports.prepareAssemblyDataForRendering=function(r,o){var i={metadata:{}},l=r.ASSEMBLY_METADATA.userAssemblyId;i.assemblyUserId=l;var c=r.PAARSNP_RESULT.resistanceProfile,d=t(o,c);i.resistanceProfile=d;var p=r.MLST_RESULT.stType,u=e(p);i.sequenceType=u;var T=r.MLST_RESULT.alleles,S=s(T);i.mlst=S;var y=r.FP_COMP.scores,f=a(y);i.nearestRepresentative=f;var b=r.FP_COMP.fingerprintSize,w=n(b,y);i.scores=w;var m=window.WGST.exports.calculateAssemblyTopScore(y);return i.topScore=m,i.topScorePercentage=Math.round(100*m.score.toFixed(2)),i.metadata.latitude=r.ASSEMBLY_METADATA.geography.position.latitude,i.metadata.longitude=r.ASSEMBLY_METADATA.geography.position.longitude,i},window.WGST.exports.getAssembly=function(e){window.WGST.exports.getAssemblyData(e,function(t,s){if(!s){var a=window.WGST.exports.prepareAssemblyDataForRendering(t.assembly,t.antibiotics),n={assemblyUserId:a.assemblyUserId,antibioticResistanceData:a.resistanceProfile,sequenceTypeData:a.sequenceType,mlstData:a.mlst,nearestRepresentativeData:a.nearestRepresentative,scoresData:a.scores},r=window.WGST.exports.createAssemblyPanel(e,n);window.WGST.exports.bringPanelToFront(r),window.WGST.exports.showPanel(r)}})},window.WGST.exports.__old_remove__getAssembly=function(r){$.ajax({type:"POST",url:"/api/assembly",datatype:"json",data:{assemblyId:r}}).done(function(o){var i=o.assembly,l=i.ASSEMBLY_METADATA.userAssemblyId,c=o.antibiotics,d=i.PAARSNP_RESULT.paarResult.resistanceProfile,p=t(c,d),u=i.MLST_RESULT.stType,T=e(u),S=i.MLST_RESULT.alleles,y=s(S),f=i.FP_COMP.scores,b=a(f),w=i.FP_COMP.fingerprintSize,m=n(w,f),A={assemblyUserId:l,antibioticResistanceData:p,sequenceTypeData:T,mlstData:y,nearestRepresentativeData:b,scoresData:m},P=window.WGST.exports.createAssemblyPanel(r,A);window.WGST.exports.bringPanelToFront(P),window.WGST.exports.showPanel(P)}).fail(function(){})}}()});
$(function(){$("body").on("click","[data-wgst-download-assembly-metadata-json]",function(){}),$("body").on("click","[data-wgst-download-assembly-metadata-csv]",function(){})});
$(function(){!function(){window.WGST.exports.showAssemblyUploadAnalytics=function(s){$(".wgst-panel__assembly-upload-analytics .wgst-upload-assembly__analytics").addClass("wgst--hide-this"),$('.wgst-panel__assembly-upload-analytics .wgst-upload-assembly__analytics[data-assembly-file-id="'+s+'"]').removeClass("wgst--hide-this"),$(".wgst-panel__assembly-upload-analytics header").find("small").text(s)}}()});
$(function(){!function(){window.WGST.exports.showAssemblyUploadMetadata=function(a){$(".wgst-panel__assembly-upload-metadata .wgst-upload-assembly__metadata").addClass("wgst--hide-this"),$('.wgst-panel__assembly-upload-metadata .wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').removeClass("wgst--hide-this"),$(".wgst-panel__assembly-upload-metadata header").find("small").text(a)},$("body").on("change",".wgst-assembly-upload__metadata .assembly-timestamp-input",function(){var e=$(this),t=e.attr("data-assembly-file-id"),s=$('.assembly-timestamp-input-year[data-assembly-file-id="'+t+'"]').val(),o=$('.assembly-timestamp-input-month[data-assembly-file-id="'+t+'"]').val(),d=$('.assembly-timestamp-input-day[data-assembly-file-id="'+t+'"]'),l=d.val(),n=e.attr("data-timestamp-input");("year"===n||"month"===n)&&"-1"!==s&&"-1"!==o&&(window.WGST.exports.populateDaySelect(d,s,o),"-1"!==l&&d.find('option:contains("'+l+'")').prop("selected",!0)),"year"===n?$('.assembly-metadata-timestamp-month[data-assembly-file-id="'+t+'"]').removeClass("wgst--hide-this"):"month"===n&&$('.assembly-metadata-timestamp-day[data-assembly-file-id="'+t+'"]').removeClass("wgst--hide-this");var i;"-1"!==s&&(i="-1"!==o?"-1"!==l?new Date(s,o,l):new Date(s,o):new Date(s),window.WGST.exports.setAssemblyUploadMetadataModel(t,"datetime",i)),"-1"!==s&&a(e),window.WGST.exports.updateMetadataProgressBar()}),window.WGST.exports.updateMetadataProgressBar=function(){var a=+$(".assembly-timestamp-input-year").length+$(".assembly-sample-location-input").length+$(".assembly-sample-source-input").length,e=+$(".assembly-timestamp-input-year").filter(function(){return"-1"!==this.value}).length+$(".assembly-sample-location-input").filter(function(){return 0!==this.value.length}).length+$(".assembly-sample-source-input").filter(function(){return"0"!==this.value}).length,t=Math.floor(100*e/a);if($(".adding-metadata-progress-container .progress-bar").width(t+"%"),$(".adding-metadata-progress-container .progress-bar").attr("aria-valuenow",t),$(".adding-metadata-progress-container .progress-percentage").text(t+"%"),100===t&&($(".adding-metadata-progress-container .progress-container").hide(),$(".adding-metadata-progress-container .upload-controls-container").show(),WGST.speak)){var s=new SpeechSynthesisUtterance("Ready to upload");window.speechSynthesis.speak(s)}},window.WGST.exports.initAssemblyMetadataLocation=function(a){var e=$('.wgst-assembly-upload__metadata li[data-assembly-file-id="'+a+'"] .assembly-sample-location-input')[0];window.WGST.geo.placeSearchBox[a]=new google.maps.places.SearchBox(e,{bounds:window.WGST.geo.map.searchBoxBounds}),google.maps.event.addListener(window.WGST.geo.placeSearchBox[a],"places_changed",function(){window.WGST.exports.handlePlacesChanged(a)})},window.WGST.exports.handlePlacesChanged=function(e){var t=WGST.geo.placeSearchBox[e].getPlaces(),s=t[0];if("undefined"!=typeof s&&"undefined"!=typeof s.geometry){var o=s.geometry.location.lat(),d=s.geometry.location.lng(),l=s.formatted_address,n=$('.assembly-sample-location-input[data-assembly-file-id="'+e+'"]');n.val().length>0&&a(n),n.blur().val(l),WGST.geo.map.canvas.setCenter(s.geometry.location),WGST.geo.map.markers.metadata.setMap(WGST.geo.map.canvas),WGST.geo.map.markers.metadata.setPosition(s.geometry.location),WGST.geo.map.markers.metadata.setVisible(!0),window.WGST.exports.setAssemblyUploadMetadataModel(e,"geography",{address:l,position:{latitude:o,longitude:d},type:s.types[0]}),window.WGST.exports.updateMetadataProgressBar()}},$("body").on("change",".assembly-sample-source-input",function(){var e=$(this).attr("data-assembly-file-id"),t=$(this);window.WGST.exports.setAssemblyUploadMetadataModel(e,"source",$(this).val()),window.WGST.exports.updateMetadataProgressBar(),a(t)}),$("body").on("click","[data-wgst-copy-metadata-to-all-empty-assemblies]",function(){var a=$(this).closest(".wgst-upload-assembly__metadata"),e=(a.find(".assembly-sample-location-input"),a.find(".assembly-sample-source-input"),a.attr("data-assembly-file-id"));window.WGST.exports.copyAssemblyMetadataToAssembliesWithNoMetadata(e),$(".wgst-assembly-metadata-block").show(),window.WGST.exports.updateMetadataProgressBar()});var a=function(a){a.closest(".wgst-assembly-metadata-block").next(".wgst-assembly-metadata-block").removeClass("wgst--hide-this"),a.closest(".wgst-upload-assembly__metadata .assembly-metadata").animate({scrollTop:a.closest(".wgst-assembly-metadata-block").next(".wgst-assembly-metadata-block").offset().top},"fast")};window.WGST.exports.setAssemblyUploadMetadataModel=function(a,e,t){window.WGST.upload.fastaAndMetadata[a].metadata=window.WGST.upload.fastaAndMetadata[a].metadata||{},window.WGST.upload.fastaAndMetadata[a].metadata[e]=t},window.WGST.exports.getAssemblyUploadMetadataModel=function(a,e){return window.WGST.upload.fastaAndMetadata[a].metadata[e]}}()});
$(function(){!function(){$("body").on("change",".wgst-dropped-assembly-list",function(){var o=$(this).val();window.WGST.exports.showAssemblyUpload(o)}),$("body").on("click",'[data-wgst-dropped-assembly-list-navigation-button="previous"]',function(){window.WGST.exports.showPreviousAssemblyUpload()}),$("body").on("click",'[data-wgst-dropped-assembly-list-navigation-button="next"]',function(){window.WGST.exports.showNextAssemblyUpload()}),window.WGST.exports.showPreviousAssemblyUpload=function(){var o=$(".wgst-dropped-assembly-list option:selected").prev();o.length>0&&o.prop("selected","selected").change()},window.WGST.exports.showNextAssemblyUpload=function(){var o=$(".wgst-dropped-assembly-list option:selected").next();o.length>0&&o.prop("selected","selected").change()},window.WGST.exports.showAssemblyUpload=function(o){return"undefined"==typeof o?!1:(window.WGST.exports.showAssemblyUploadAnalytics(o),window.WGST.exports.showAssemblyUploadMetadata(o),void 0)}}()});
$(function(){!function(){var a=2e3;$("body").on("click",".assemblies-upload-ready-button",function(){window.WGST.geo.map.markers.metadata.setMap(null),window.WGST.exports.removePanel("assembly-upload-navigation"),window.WGST.exports.removePanel("assembly-upload-metadata"),window.WGST.exports.removePanel("assembly-upload-analytics"),window.WGST.exports.removeFullscreen("collection-map"),window.WGST.exports.removeHidable("collection-map"),WGST.dragAndDrop.files=[];window.WGST.exports.showBackground("uploading");var e="";setTimeout(function(){$.ajax({type:"POST",url:"/collection/add/",datatype:"json",data:{collectionId:e,userAssemblyIds:Object.keys(window.WGST.upload.fastaAndMetadata)}}).done(function(a){var e=a.collectionId,s=a.userAssemblyIdToAssemblyIdMap;WGST.upload.collection[e]={},WGST.upload.collection[e].notifications={assembly:{},all:{},tree:!1};var o=[];$.each(s,function(a){var t=s[a];"undefined"!=typeof window.WGST.upload.fastaAndMetadata[t]&&o.push([e,a,window.WGST.upload.fastaAndMetadata[t]])}),o.forEach(function(a){{var e=a[0],s=a[1],o=a[2],l={};o.name}l.collectionId=e,l.assemblyId=s,l.userAssemblyId=o.fasta.name,l.sequences=o.fasta.assembly,l.metadata={datetime:o.metadata.datetime,geography:{position:{latitude:o.metadata.geography.position.latitude,longitude:o.metadata.geography.position.longitude},address:o.metadata.geography.address},source:o.metadata.source},t(l)})}).fail(function(){})},a)});var e=0,s=5,o=2e3,t=function(a){s>e?(e+=1,a.socketRoomId=WGST.socket.roomId,$.ajax({type:"POST",url:"/assembly/add/",datatype:"json",data:a}).done(function(){}).fail(function(a,e){showNotification(e)})):setTimeout(t,o,a)};window.WGST.socket.connection.on("assemblyUploadNotification",function(a){if(!window.WGST.exports.isContainerExists("assembly-upload-progress")){var e=Object.keys(window.WGST.upload.fastaAndMetadata).length;window.WGST.exports.createFullscreen("assembly-upload-progress",{fullscreenId:"assembly-upload-progress",fullscreenType:"assembly-upload-progress",assemblyFileIds:Object.keys(window.WGST.upload.fastaAndMetadata),totalNumberOfAssembliesUploading:e}),window.WGST.exports.showFullscreen("assembly-upload-progress"),window.WGST.exports.hideBackground("uploading")}var s=a.collectionId,o=a.assemblyId,t=a.userAssemblyId,i=a.result,r=s+"__"+o+"__"+i,p=Object.keys(window.WGST.upload.fastaAndMetadata),c=Object.keys(window.WGST.assembly.analysis).length,u=c*p.length,m=Object.keys(window.WGST.collection.analysis).length,y=u+m;-1===Object.keys(window.WGST.upload.collection[s].notifications.all).indexOf(r)&&(window.WGST.upload.collection[s].notifications.all[r]="OK",-1!==Object.keys(window.WGST.assembly.analysis).indexOf(i)&&l(o,t,c,i),n(s,t,o,y,i),y===Object.keys(window.WGST.upload.collection[s].notifications.all).length&&setTimeout(function(){window.WGST.exports.removeContainer("assembly-upload-progress"),d(),window.WGST.exports.getCollection(s)},1e3))});var l=function(a,s,o,t){var l=$('.assembly-list-upload-progress tr[data-assembly-file-id="'+s+'"] '),n=l.find(".progress-bar"),d='<span class="glyphicon glyphicon-ok"></span>',i=parseFloat(l.find(".progress-bar").attr("aria-valuenow")),r=100/o,p=i+r;if(t===window.WGST.assembly.analysis.UPLOAD_OK?l.find(".assembly-upload-uploaded").html(d):t===WGST.assembly.analysis.MLST_RESULT?l.find(".assembly-upload-result-mlst").html(d):t===WGST.assembly.analysis.PAARSNP_RESULT?l.find(".assembly-upload-result-paarsnp").html(d):t===WGST.assembly.analysis.FP_COMP?l.find(".assembly-upload-result-fp-comp").html(d):t===WGST.assembly.analysis.CORE&&l.find(".assembly-upload-result-core").html(d),n.css("width",p+"%").attr("aria-valuenow",p),p>0&&n.text(Math.round(p)+"%"),p>=100){e-=1,l.find(".progress").removeClass("active").removeClass("progress-striped"),n.removeClass("progress-bar-info").addClass("progress-bar-success");var c=l.find(".assembly-upload-name").text();l.find(".assembly-upload-name").html('<a href="#" class="open-assembly-button" data-assembly-id="'+a+'">'+c+"</a>");var u=$(".assemblies-upload-processed");u.text(parseInt(u.text(),10)+1)}},n=function(a,e,s,o){var t=$(".assemblies-upload-progress").find(".progress-bar"),l=parseFloat(t.attr("aria-valuenow")),n=100/o,d=l+n;if(t.css("width",d+"%").attr("aria-valuenow",d),d>0&&t.text(Math.round(d)+"%"),d>=100&&t.addClass("progress-bar-success"),WGST.speak===!0&&d%30===0){var i=new SpeechSynthesisUtterance("Uploaded over "+d+" percent");window.speechSynthesis.speak(i)}},d=function(){window.WGST.upload.fastaAndMetadata={}}}()});
$(function(){!function(){window.WGST.exports.showBackground=function(d){$('[data-wgst-background-id="'+d+'"]').removeClass("wgst--hide-this")},window.WGST.exports.hideBackground=function(d){$('[data-wgst-background-id="'+d+'"]').addClass("wgst--hide-this")}}()});
$(function(){window.WGST.exports.mapCollectionIdToCollectionName={"5324c298-4cd0-4329-848b-30d7fe28a560":"EMRSA15","c0ca8c57-11b9-4e27-93a5-6ffe841e7768":"ST239","b8d3aab1-625f-49aa-9857-a5e97f5d6be5":"Reference"},window.WGST.exports.initCollectionDataStructure=function(e,t){WGST.collection[e]={assemblies:{},tree:{}},$.isArray(t)&&t.forEach(function(t){window.WGST.collection[e].tree[t]={}})},window.WGST.exports.setCollectionData=function(e,t,a){window.WGST.exports.initCollectionDataStructure(e),window.WGST.collection[e].assemblies=t,$.each(a,function(t,a){window.WGST.collection[e].tree[t]={type:t,data:a.data,name:a.name}})};var e=function(e){var t=window.WGST.collection[e].assemblies,a=[],o=[],i="CORE_TREE_RESULT",s=window.WGST.collection[e].tree[i];$.each(s.leavesOrder,function(e,i){a.push(t[i.id]),o.push(i.id)}),window.WGST.collection[e].sortedAssemblyIds=o};window.WGST.exports.getCollection=function(a){if(window.WGST.speak){var o=new SpeechSynthesisUtterance("Loading collection");window.speechSynthesis.speak(o)}window.WGST.exports.showBackground("get-collection"),$.ajax({type:"POST",url:"/collection/",datatype:"json",data:{collectionId:a}}).done(function(o){if(Object.keys(o).length>0){window.WGST.antibiotics=o.antibiotics,window.WGST.exports.setCollectionData(a,o.collection.assemblies,o.collection.tree);{var i=window.WGST.exports.createCollectionDataPanel(a);$('.wgst-panel[data-panel-id="'+i+'"]')}window.WGST.exports.createFullscreen("collection-map",{fullscreenId:"collection-map",fullscreenType:"collection-map"}),window.WGST.exports.showFullscreen("collection-map"),window.WGST.geo.map.init(),window.WGST.exports.bringPanelToFront(i),window.WGST.exports.renderCollectionTrees(a),window.WGST.exports.renderCollectionTreeButtons(a,i),window.WGST.exports.addResistanceProfileDataToCollection(a),e(a),window.WGST.exports.renderAssemblyAnalysisList(a,i,WGST.antibiotics),window.WGST.exports.showPanel(i),"undefined"!=typeof window.WGST.exports.mapCollectionIdToCollectionName[a]?$(".wgst-header-collection-name").text(window.WGST.exports.mapCollectionIdToCollectionName[a]):$(".wgst-header-collection-name").text(a),Object.keys(window.WGST.collection[a].assemblies).length>100&&t(a),window.history.replaceState("Object","WGST Collection","/collection/"+a),window.WGST.exports.hideBackground("get-collection")}}).fail(function(e,t){showNotification(t)})};window.WGST.exports.addResistanceProfileDataToCollection=function(e){var t,a,o,i,s,n,l={};for(t in WGST.collection[e].assemblies){a=WGST.collection[e].assemblies[t],l=a.PAARSNP_RESULT.resistanceProfile,s={};for(o in l){i=l[o];for(n in i)s[n]=i[n]}WGST.collection[e].assemblies[t].PAARSNP_RESULT.paarResult.ungroupedResistanceProfile=s}},window.WGST.exports.renderAssemblyAnalysisList=function(e,t){var a,o,i=window.WGST.collection[e].assemblies,s=window.WGST.collection[e].sortedAssemblyIds,n=s.map(function(t){return a=i[t],o=window.WGST.exports.prepareAssemblyDataForRendering(a,window.WGST.antibiotics),window.WGST.collection[e].assemblies[t].FP_COMP.topScore=o.topScore,{assemblyId:t,assemblyUserId:o.assemblyUserId,antibioticResistanceData:o.resistanceProfile,sequenceTypeData:o.sequenceType,mlstData:o.mlst,nearestRepresentativeData:o.nearestRepresentative,scoresData:o.scores,topScore:o.topScore,topScorePercentage:o.topScorePercentage,metadata:{latitude:o.metadata.latitude,longitude:o.metadata.longitude}}}),l={collectionId:e,assemblies:n},c=$('.wgst-template[data-template-id="panel-body__collection-data__assemblies"]').html(),d=Handlebars.compile(c),r=$('.wgst-template[data-template-id="panel-body__collection-data__assemblies__assembly"]').html();Handlebars.registerPartial("assembly",r);var p=d(l),m=$('.wgst-panel[data-panel-id="'+t+'"]'),w=m.find(".wgst-panel-body-container");w.prepend(p),$(".wgst-assembly-show-on-map").prop("checked",!0).change()},window.WGST.exports.__old_remove__renderAssemblyAnalysisList=function(e,t,a){for(var o,i,s,n,l,c,d,r=WGST.collection[e].assemblies,p=WGST.collection[e].sortedAssemblyIds,m=0,w=$('.wgst-panel[data-panel-id="'+t+'"]'),b=w.find(".collection-assembly-list"),S=w.find(".collection-assembly-list-full"),T=document.createDocumentFragment();m<p.length;)o=p[m],i=r[o].PAARSNP_RESULT.paarResult.resistanceProfile,s=window.WGST.exports.createAssemblyResistanceProfilePreviewHtml(i,a),n=window.WGST.exports.calculateAssemblyTopScore(r[o].FP_COMP.scores),WGST.collection[e].assemblies[o].FP_COMP.topScore=n,l=r[o].ASSEMBLY_METADATA.geography.position.latitude,c=r[o].ASSEMBLY_METADATA.geography.position.longitude,d=$((m%2===0?'<div class="row-stripe assembly-list-item" data-assembly-id="'+r[o].FP_COMP.assemblyId+'">':'<div class="assembly-list-item" data-assembly-id="'+r[o].FP_COMP.assemblyId+'">')+'<div class="show-on-map-checkbox assembly-list-header-map"><input type="checkbox" data-reference-id="'+n.referenceId+'" data-assembly-id="'+r[o].FP_COMP.assemblyId+'" data-latitude="'+l+'" data-longitude="'+c+'"></div><div class="assembly-list-header-id"><a href="#" class="open-assembly-button" data-assembly-id="'+r[o].FP_COMP.assemblyId+'" title="'+r[o].ASSEMBLY_METADATA.userAssemblyId+'" data-mixpanel-open-assembly-panel="'+r[o].ASSEMBLY_METADATA.userAssemblyId+'">'+r[o].ASSEMBLY_METADATA.userAssemblyId+'</a></div><div class="assembly-list-header-nearest-representative">'+n.referenceId+" ("+Math.round(100*n.score.toFixed(2))+'%)</div><div class="assembly-list-header-st">'+(0===r[o].MLST_RESULT.stType.length?"Not found":r[o].MLST_RESULT.stType)+'</div><div class="assembly-list-header-resistance-profile"><div class="assembly-resistance-profile-container">'+s+"</div></div></div>"),T.appendChild(d[0]),m+=1;b[0].appendChild(T.cloneNode(!0)),S[0].appendChild(T.cloneNode(!0)),$('.show-on-map-checkbox input[type="checkbox"]').prop("checked",!0).change()},window.WGST.exports.__old_remove__createAssemblyResistanceProfilePreviewHtml=function(e,t){var a,o,i,s,n,l,c,d="";for(o in t)if(t.hasOwnProperty(o)){a=t[o],i='<div class="antibiotic-group" data-antibiotic-group-name="'+o+'">{{antibioticsHtml}}</div>',l="";for(s in a)a.hasOwnProperty(s)&&(n="","undefined"!=typeof e[o]?"undefined"!=typeof e[o][s]?(c=e[o][s].resistanceState,n="RESISTANT"===c?n+'<span class="antibiotic resistance-fail" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>':"SENSITIVE"===c?n+'<span class="antibiotic resistance-success" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>':n+'<span class="antibiotic resistance-unknown" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>'):n=n+'<span class="antibiotic resistance-unknown" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>':n=n+'<span class="antibiotic no-resistance-data" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>',l+=n);i=i.replace(/{{antibioticsHtml}}/g,l),d+=i}return d};var t=function(e){window.WGST.exports.maximizePanel("collection-data__"+e)}});
$(function(){!function(){window.WGST.exports.createCollectionDataPanel=function(e){var t="collection-data__"+e,a="collection-data",o={collectionId:e,panelId:t,panelType:a};return window.WGST.exports.createPanel(a,o),t};$("body").on("change",".wgst-assembly-show-on-map",function(){var e,t=($(this).attr("data-assembly-id"),$(this).closest("[data-wgst-collection-data]").attr("data-collection-id")),a=$(this).closest(".wgst-collection-data-assemblies").find(".wgst-assembly-show-on-map:checked"),o=[];a.each(function(){e=$(this).attr("data-assembly-id"),o.push(e)}),window.WGST.exports.triggerMapMarkers(t,o),"map"!==$(".wgst-fullscreen--active").attr("data-fullscreen-name")&&($(".wgst-panel__map").hasClass("wgst-panel--active")||window.WGST.exports.showPanel("map")),0===$(this).closest(".wgst-collection-data-assemblies").find('input[type="checkbox"]:not(:checked)').length?$(".wgst-assembly-show-all-on-map").prop("checked",!0):$(".wgst-assembly-show-all-on-map").prop("checked",!1)}),$("body").on("click",".open-assembly-button",function(e){var t=$(this).attr("data-assembly-id");window.WGST.exports.getAssembly(t),e.preventDefault()}),$("body").on("click",".wgst-collection-control__show-tree",function(){var e=$(this).attr("data-collection-id"),t=$(this).attr("data-tree-type"),a="collection-tree__"+e+"__"+t;window.WGST.exports.showPanel(a),window.WGST.exports.bringPanelToFront(a)}),$(".wgst-panel__collection").on("click",".wgst-collection-control__show-data-table",function(){var e=$(this).attr("data-collection-id"),t=WGST.collection[e].assemblies,a=Object.keys(t);$.ajax({type:"POST",url:"/api/assembly/table-data",datatype:"json",data:{assemblyIds:a}}).done(function(){})}),window.WGST.exports.renderCollectionTreeButtons=function(t,a){var o=WGST.collection[t].tree;$.each(o,function(o){"COLLECTION_TREE"===o&&e(t,a,o)})};var e=function(e,t,a){var o=WGST.collection[e].tree[a],l=(o.name,{collectionTreeType:a,collectionId:e,collectionTreeName:"Tree"}),n=$('.wgst-template[data-template-id="panel-body__collection-data__tree-button"]').html(),s=Handlebars.compile(n),c=s(l);$('.wgst-panel[data-panel-id="'+t+'"]').find(".wgst-collection-controls__show-tree .btn-group").prepend(c)};window.WGST.exports.renderCollectionTrees=function(e,a){var o=window.WGST.collection[e].tree;$.each(o,function(o){t(e,o,a)})};var t=function(e,t,o){var l="collection-tree__"+e+"__"+t,n=window.WGST.collection[e].tree[t].name.capitalize(),s="phylocanvas__"+e+"__"+t,c="collection-tree",i={panelId:l,panelType:c,collectionId:e,collectionTreeType:t,collectionTreeTitle:n,phylocanvasId:s,invisibleThis:!0,dataAttributes:[{name:"data-collection-tree-type",value:t}]};"undefined"!=typeof o&&$.extend(i,o),e===window.WGST.config.referenceCollectionId&&(i.mergeWithButton=!0),window.WGST.exports.createPanel(c,i);var r,d=window.WGST.collection[e].tree[t],p=window.WGST.collection[e].assemblies;d.canvas=new PhyloCanvas.Tree($('[data-phylocanvas-id="'+s+'"]')[0],{history_collapsed:!0}),d.canvas.parseNwk(d.data),d.canvas.treeType="rectangular";var w=d.canvas;w.on("selected",function(t){var o=t.nodeIds;"string"==typeof o&&(o=[o]),0!==o.length&&a(e,o)});for(r in p)p.hasOwnProperty(r)&&w.branches[r].leaf&&(w.branches[r].label=p[r].ASSEMBLY_METADATA.userAssemblyId);w.resizeToContainer(),w.drawn=!1,w.draw();var y=w.leaves;y.sort(function(e,t){return e.centery-t.centery}),d.leavesOrder=y;var m=d.data;for(r in p)p.hasOwnProperty(r)&&(m=m.replace(r,p[r].ASSEMBLY_METADATA.userAssemblyId));window.WGST.collection[e].tree[t].newickStringWithLabels=m,$collectionTreePanel=$('.wgst-panel[data-panel-id="'+l+'"]'),window.WGST.exports.populateListOfAntibiotics($collectionTreePanel.find(".wgst-tree-control__change-node-colour")),w.resizeToContainer(),w.drawn=!1,w.draw()},a=function(e,t){var a=WGST.collection[e].assemblies;$('.collection-assembly-list .assembly-list-item [type="radio"]').prop("checked",!1),$.each(a,function(e){-1!==$.inArray(e,t)?($('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"]').addClass("row-selected"),$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"] [type="checkbox"]').prop("checked",!0)):($('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"]').removeClass("row-selected"),$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"] [type="checkbox"]').prop("checked",!1))}),window.WGST.exports.triggerMapMarkers(e,t),1===t.length&&$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+t+'"] [type="radio"]').prop("checked",!0)};$("body").on("change",".wgst-assembly-show-all-on-map",function(){var e=$(this).closest("[data-wgst-collection-data]").find(".wgst-collection-data-assemblies .wgst-assembly-show-on-map");$(this).prop("checked")?e.prop("checked",!0).trigger("change"):e.prop("checked",!1).trigger("change")}),$("body").on("click","[data-wgst-download-metadata]",function(){var e=$(this).attr("data-wgst-assembly-id");$.ajax({type:"GET",url:"/api/download/assembly/"+e+"/metadata",datatype:"json"}).done(function(){})})}()});
$(function(){!function(){$(".tree-controls-show-labels").on("click",function(){var e=$(this).closest("[data-collection-tree-content]").attr("data-collection-id");WGST.collection[e].tree.CORE_TREE_RESULT.canvas.displayLabels()}),$(".tree-controls-hide-labels").on("click",function(){var e=$(this).closest("[data-collection-tree-content]").attr("data-collection-id");WGST.collection[e].tree.CORE_TREE_RESULT.canvas.hideLabels()}),$("body").on("change",".wgst-tree-control__change-node-label",function(){var t,o=$(this),n=o.closest("[data-collection-tree-content]").attr("data-collection-id"),a=o.closest("[data-collection-tree-content]").attr("data-collection-tree-type"),c=WGST.collection[n].tree[a].canvas,l=WGST.collection[n].assemblies;if("1"===o.val())for(t in l)l.hasOwnProperty(t)&&c.branches[t]&&c.branches[t].leaf&&(c.branches[t].label=l[t].ASSEMBLY_METADATA.userAssemblyId);else if("2"===o.val())for(t in l)l.hasOwnProperty(t)&&c.branches[t]&&c.branches[t].leaf&&(c.branches[t].label=window.WGST.collection[n].assemblies[t].FP_COMP.topScore.referenceId);else if("3"===o.val())for(t in l)l.hasOwnProperty(t)&&c.branches[t]&&c.branches[t].leaf&&(c.branches[t].label=0===l[t].MLST_RESULT.stType.length?"Not found":l[t].MLST_RESULT.stType);else if("4"===o.val()){var s,i;for(t in l)l.hasOwnProperty(t)&&(s=l[t].PAARSNP_RESULT.resistanceProfile,i=e(s,WGST.antibiotics),c.branches[t]&&c.branches[t].leaf&&(c.branches[t].label=i))}else if("5"===o.val())for(t in l)l.hasOwnProperty(t)&&c.branches[t]&&c.branches[t].leaf&&(c.branches[t].label=l[t].ASSEMBLY_METADATA.geography.address);c.draw()}),$("body").on("change",".wgst-tree-control__change-node-colour",function(){var e,t=$(this).find("option:selected"),o=t.closest("[data-collection-tree-content]").attr("data-collection-id"),n=t.closest("[data-collection-tree-content]").attr("data-collection-tree-type"),a=WGST.collection[o].tree[n].canvas,c=WGST.collection[o].assemblies;if("0"===t.val())for(e in c)c.hasOwnProperty(e)&&a.setNodeColourAndShape(e,"#ffffff");else{var l,s;for(e in c)c.hasOwnProperty(e)&&(l=c[e].PAARSNP_RESULT.paarResult.ungroupedResistanceProfile,s=l[t.text()],"undefined"!=typeof s?a.branches[e]&&a.branches[e].leaf&&("RESISTANT"===s?a.setNodeColourAndShape(e,"#ff0000"):"SENSITIVE"===s?a.setNodeColourAndShape(e,"#4dbd33"):"UNKNOWN"===s&&a.setNodeColourAndShape(e,"#ffffff")):a.branches[e]&&a.branches[e].leaf&&a.setNodeColourAndShape(e,"#ffffff"))}}),$("body").on("change",".wgst-tree-control__change-tree-type",function(){var e,t=$(this).find("option:selected"),o=t.closest("[data-collection-tree-content]").attr("data-collection-id"),n=t.closest("[data-collection-tree-content]").attr("data-collection-tree-type");e=window.WGST.collection[o].tree[n].canvas,e.setTreeType(t.val())}),$("body").on("click",".wgst-tree-control__show-newick",function(){var e,t,o=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),n=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");e=WGST.collection[o].tree[n].newickStringWithLabels,t=window.open(),t.document.write(e)}),$("body").on("click",".wgst-tree-control__decrease-label-font-size",function(){var e,t,o=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),n=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");t=WGST.collection[o].tree[n].canvas,e=t.textSize,t.setTextSize(e-3)}),$("body").on("click",".wgst-tree-control__increase-label-font-size",function(){var e,t,o=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),n=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");t=WGST.collection[o].tree[n].canvas,e=t.textSize,t.setTextSize(e+3)}),$("body").on("click",".wgst-tree-control__decrease-node-size",function(){var e,t,o=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),n=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");e=WGST.collection[o].tree[n].canvas,t=e.baseNodeSize,t>3?(e.setNodeSize(t-3),t=e.baseNodeSize,3>t&&$(this).attr("disabled",!0)):$(this).attr("disabled",!0)}),$("body").on("click",".wgst-tree-control__increase-node-size",function(){var e,t,o=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),n=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");e=WGST.collection[o].tree[n].canvas,t=e.baseNodeSize,e.setNodeSize(t+3),e.baseNodeSize>3&&$(this).closest(".wgst-tree-control").find(".wgst-tree-control__decrease-node-size").attr("disabled",!1)}),$("body").on("change",".wgst-tree-control__show-node-labels",function(){var e,t=$(this).closest("[data-collection-tree-content]").attr("data-collection-id"),o=$(this).closest("[data-collection-tree-content]").attr("data-collection-tree-type");e=WGST.collection[t].tree[o].canvas,e.toggleLabels()}),window.WGST.socket.connection.on("collectionTreeMergeNotification",function(e){if(WGST.speak){var t=new SpeechSynthesisUtterance("Merged collections");window.speechSynthesis.speak(t)}var o=e.mergedCollectionTreeId,n=e.tree,a=e.assemblies,c=[];c=a.map(function(e){return e.assemblyId}),$.ajax({type:"POST",url:"/api/assemblies/",datatype:"json",data:{assemblyIds:c}}).done(function(e){window.WGST.exports.setCollectionData(o,e,n),window.WGST.exports.renderCollectionTrees(o,{matchAssemblyListButton:!0,mergeWithButton:!0,panelLabel:"Merge Tree"});var t,a,c;for(t in window.WGST.collection[o].assemblies)WGST.collection[o].assemblies.hasOwnProperty(t)&&(a=window.WGST.collection[o].assemblies[t],c=a.FP_COMP.scores,window.WGST.collection[o].assemblies[t].FP_COMP.topScore=window.WGST.exports.calculateAssemblyTopScore(c));window.WGST.exports.addResistanceProfileDataToCollection(o),window.WGST.exports.populateListOfAntibiotics($("#select-tree-node-antibiotic-merged")),function(){var e=$("[data-button-merge]");e.find(".wgst-spinner").addClass("wgst--hide-this"),e.find(".wgst-spinner-label").removeClass("wgst--hide-this"),e.attr("disabled",!1)}();var l="MERGED",s="collection-tree__"+o+"__"+l;window.WGST.exports.showPanel(s),window.WGST.exports.bringPanelToFront(s)}).fail(function(){})}),$("body").on("click","[data-button-merge-tree]",function(){var e=$("[data-button-merge]");e.attr("disabled",!0),e.find(".wgst-spinner-label").addClass("wgst--hide-this"),e.find(".wgst-spinner").removeClass("wgst--hide-this");var t=$(this),o={collectionId:e.closest("[data-collection-tree-content]").attr("data-collection-id"),mergeWithCollectionId:t.attr("data-merge-with-collection"),collectionTreeType:e.attr("data-collection-tree-type"),socketRoomId:window.WGST.socket.roomId};$.ajax({type:"POST",url:"/api/collection/tree/merge",datatype:"json",data:o}).done(function(){})}),$("body").on("click",".wgst-tree-control__merge-collection-trees",function(){var e=$(this);e.attr("disabled",!0),e.find(".wgst-spinner-label").addClass("wgst--hide-this"),e.find(".wgst-spinner").removeClass("wgst--hide-this");var t={collectionId:e.closest("[data-collection-tree-content]").attr("data-collection-id"),mergeWithCollectionId:window.WGST.settings.referenceCollectionId,collectionTreeType:e.attr("data-collection-tree-type"),socketRoomId:WGST.socket.roomId};$.ajax({type:"POST",url:"/api/collection/tree/merge",datatype:"json",data:t}).done(function(){})});var e=function(e,t){var o,n,a,c,l,s,i,r="";for(n in t)if(t.hasOwnProperty(n)){o=t[n],a="  ",s="";for(c in o)o.hasOwnProperty(c)&&(l="","undefined"!=typeof e[n]?"undefined"!=typeof e[n][c]?(i=e[n][c],l+="RESISTANT"===i?"⦿":"SENSITIVE"===i?"○":"○"):l+="○":l+="○",s+=l);a+=s,r+=a}return r}}()});
$(function(){!function(){window.WGST.exports.isContainerExists=function(e){return window.WGST.exports.isPanelExists(e)?!0:window.WGST.exports.isFullscreenExists(e)?!0:!1},window.WGST.exports.getContainerType=function(e){return window.WGST.exports.isPanelExists(e)?"panel":window.WGST.exports.isFullscreenExists(e)?"fullscreen":"unknown"},window.WGST.exports.bringContainerToFront=function(e,n){var o,t=0;$(".wgst-panel, .wgst-fullscreen").each(function(){var e=$(this);o=parseInt(e.css("z-index"),10),o>=t&&(t=o)}),"panel"===e?$('[data-panel-id="'+n+'"]').css("z-index",t+1):"fullscreen"===e&&$('[data-fullscreen-id="'+n+'"]').css("z-index",t+1)},window.WGST.exports.removeContainer=function(e){"panel"===window.WGST.exports.getContainerType(e)?window.WGST.exports.removePanel(e):"fullscreen"===window.WGST.exports.getContainerType(e)&&window.WGST.exports.removeFullscreen(e)},window.WGST.exports.extendContainerOptions=function(e,n){return $.extend(e,{additional:n}),e},window.WGST.exports.getContainerLabel=function(e){var n="Anonymous";return"collection-data"===e.containerType?n="Data":"collection-map"===e.containerType?n="Map":"collection-tree"===e.containerType?n="Tree":"assembly"===e.containerType?n=e.additional.assemblyUserId:"assembly-upload-progress"===e.containerType?n="Upload Progress":"assembly-upload-metadata"===e.containerType?n="Assembly Metadata":"assembly-upload-analytics"===e.containerType?n="Assembly Analytics":"assembly-upload-navigation"===e.containerType&&(n="Collection Navigation"),n}}()});
$(function(){!function(){window.WGST.exports.extractContigsFromFastaFileString=function(t){var n=[];return n=t.trim().split(">").filter(function(t){return t.length>0})},window.WGST.exports.splitContigIntoParts=function(t){var n=[];return n=t.split(/\n/).filter(function(t){return t.length>0}),n.map(function(t){return t.trim()}),n},window.WGST.exports.extractDnaStringIdFromContig=function(t){var n=window.WGST.exports.splitContigIntoParts(t),r=n[0].trim().replace(">","");return r},window.WGST.regex=WGST.regex||{},window.WGST.regex.DNA_SEQUENCE=/^[CTAGNUX]+$/i,window.WGST.exports.extractDnaStringFromContig=function(t){var n=window.WGST.exports.splitContigIntoParts(t),r=n.splice(1,n.length);WGST.regex.DNA_SEQUENCE.test(r[0].trim())||(r=r.splice(1,r.length));var e=r.join("").replace(/\s/g,"");return e},window.WGST.exports.extractDnaStringsFromContigs=function(t){var n,r=[];return t.forEach(function(t){n=window.WGST.exports.extractDnaStringFromContig(t),r.push(n)}),r},window.WGST.exports.isValidDnaString=function(t){return WGST.regex.DNA_SEQUENCE.test(t)},window.WGST.exports.isValidContig=function(t){var n=window.WGST.exports.splitContigIntoParts(t),r=window.WGST.exports.extractDnaStringFromContig(t);return n.length>1&&window.WGST.exports.isValidDnaString(r)},window.WGST.exports.calculateN50=function(t){for(var n=t.sort(function(t,n){return n.length-t.length}),r=[],e=0;e<n.length;e++)r.length>0?r.push(n[e].length+r[r.length-1]):r.push(n[e].length);for(var a=Math.floor(r[r.length-1]/2),i=0,o={},e=0;e<n.length;e++)if(i+=n[e].length,i>=a){o.sequenceNumber=e+1,o.sum=i,o.sequenceLength=n[e].length;break}return o},window.WGST.exports.calculateTotalNumberOfNucleotidesInDnaStrings=function(t){var n=0;return t.forEach(function(t){n+=t.length}),n},window.WGST.exports.calculateAverageNumberOfNucleotidesInDnaStrings=function(t){var n=window.WGST.exports.calculateTotalNumberOfNucleotidesInDnaStrings(t),r=t.length,e=Math.floor(n/r);return e},window.WGST.exports.calculateSmallestNumberOfNucleotidesInDnaStrings=function(t){var n=t.map(function(t){return t.length}),r=n.reduce(function(t,n){return Math.min(t,n)});return r},window.WGST.exports.calculateBiggestNumberOfNucleotidesInDnaStrings=function(t){var n=t.map(function(t){return t.length}),r=n.reduce(function(t,n){return Math.max(t,n)});return r},window.WGST.exports.calculateSumsOfNucleotidesInDnaStrings=function(t){var n=t.sort(function(t,n){return n.length-t.length}),r=[];return n.forEach(function(t){0===r.length?r.push(t.length):r.push(t.length+r[r.length-1])}),r},window.WGST.exports.validateContigs=function(t){var n={valid:[],invalid:[]};return t.forEach(function(t){var r=(window.WGST.exports.splitContigIntoParts(t),window.WGST.exports.extractDnaStringFromContig(t)),e=window.WGST.exports.extractDnaStringIdFromContig(t);window.WGST.exports.isValidContig(t)?n.valid.push({id:e,dnaString:r}):n.invalid.push({id:e,dnaString:r})}),n},window.WGST.exports.drawN50Chart=function(t,n,r){var e=460,a=312,i=(d3.extent(t,function(t){return t.sequenceLength}),d3.scale.linear().domain([0,t.length]).range([40,e-50])),o=d3.scale.linear().domain([t[t.length-1],0]).range([30,a-52]),s=d3.svg.axis().scale(i).orient("bottom").ticks(10),u=d3.svg.axis().scale(o).orient("left").ticks(10),c=d3.select(r).append("svg").attr("width",e).attr("height",a);c.append("g").attr("class","x axis").attr("transform","translate(20, 260)").call(s),c.append("g").attr("class","y axis").attr("transform","translate(60, 0)").call(u),c.select(".x.axis").append("text").text("Ordered contigs").attr("class","axis-label").attr("text-anchor","end").attr("x",e/2+49).attr("y",45),c.select(".y.axis").append("text").text("Nucleotides sum").attr("class","axis-label").attr("transform","rotate(-90)").attr("x",-(a/2)-44).attr("y",398),c.selectAll("circle").data(t).enter().append("circle").attr("cx",function(t,n){return i(n+1)+20}).attr("cy",function(t){return o(t)}).attr("r",5);var l=d3.svg.line().x(function(t,n){return i(n+1)+20}).y(function(t){return o(t)});c.append("path").attr("d",l(t));{var g=[{x:i(0)+20,y:o(0)},{x:i(1)+20,y:o(t[0])}],d=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear"),p=(c.append("path").attr("d",d(g)),c.selectAll(".n50-circle").data([n]).enter().append("g").attr("class","n50-group"));p.append("circle").attr("cx",function(t){return i(t.sequenceNumber)+20}).attr("cy",function(t){return o(t.sum)}).attr("r",6)}p.append("text").attr("dx",function(t){return i(t.sequenceNumber)+20+9}).attr("dy",function(t){return o(t.sum)+5}).attr("text-anchor","right").text("N50");var x=[{x:54,y:o(n.sum)},{x:i(n.sequenceNumber)+20,y:o(n.sum)},{x:i(n.sequenceNumber)+20,y:a-46}],f=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear");p.append("path").attr("d",f(x))}}()});
$(function(){!function(){$("body").on("submit",'[data-form="feedback"]',function(a){a.preventDefault();var e=$(this).find('[type="submit"]');e.prop("disabled",!0),e.find("span").addClass("wgst--hide-this"),e.find(".wgst-spinner").removeClass("wgst--hide-this");var t=$('[data-form="feedback"]'),d=t.find('[data-input="name"]').val(),i=t.find('[data-input="email"]').val(),s=t.find('[data-input="feedback"]').val(),n={name:d,email:i,feedback:s};window.WGST.exports.mixpanel.submitFeedback(),$.ajax({type:"POST",url:"/feedback/",datatype:"json",data:n}).done(function(){e.addClass("wgst--hide-this"),$(".wgst-send-feedback-success-message").removeClass("wgst--hide-this")}).fail(function(){})})}()});
$(function(){!function(){window.WGST.exports.mapFullscreenTypeToTemplateId={"collection-map":"collection-map-fullscreen","collection-data":"collection-data-fullscreen","collection-tree":"collection-tree-fullscreen","assembly-upload-progress":"assembly-upload-progress-fullscreen",assembly:"assembly-fullscreen"},window.WGST.exports.mapFullscreenIdToPanelType={"collection-map":"collection-map","collection-data":"collection-data","collection-tree":"collection-tree"},window.WGST.exports.createFullscreen=function(e,l){if(!($('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').length>0)&&"undefined"!=typeof l){var t={containerName:"fullscreen",containerType:l.fullscreenType,containerId:e};if("assembly"===t.containerType){var n={assemblyUserId:"AAA"};t=window.WGST.exports.extendContainerOptions(t,n)}l.fullscreenLabel=window.WGST.exports.getContainerLabel(t);var o=window.WGST.exports.mapFullscreenTypeToTemplateId[l.fullscreenType],a=$('.wgst-template[data-template-id="'+o+'"]').html(),s=Handlebars.compile(a),i=s(l);$(".wgst-workspace").prepend(i),window.WGST.exports.happenedCreateFullscreen({fullscreenId:e,fullscreenLabel:l.fullscreenLabel})}},window.WGST.exports.removeFullscreen=function(e){$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').remove(),window.WGST.exports.happenedRemoveFullscreen(e),"collection-map"===e&&window.WGST.geo.map.remove()},window.WGST.exports.showFullscreen=function(e){$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').removeClass("wgst--hide-this wgst--invisible-this"),window.WGST.exports.happenedShowFullscreen(e)},window.WGST.exports.hideFullscreen=function(e){$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').addClass("wgst--hide-this wgst--invisible-this"),window.WGST.exports.happenedHideFullscreen(e)},window.WGST.exports.isFullscreenExists=function(e){return $('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').length>0?!0:!1},window.WGST.exports.toggleFullscreen=function(e){var l=$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]');l.is(".wgst--hide-this, .wgst--invisible-this")?window.WGST.exports.showFullscreen(e):window.WGST.exports.hideFullscreen(e)},window.WGST.exports.bringFullscreenToFront=function(e){window.WGST.exports.bringContainerToFront("fullscreen",e)},window.WGST.exports.bringFullscreenToBack=function(e){$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').css("z-index","auto")},window.WGST.exports.bringFullscreenToPanel=function(e,l){if(0!==$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').length){var t=e.split("__")[0],n=e,o=e.split("__")[1],a=t,o=$("[data-collection-tree-content]").attr("data-collection-id"),s=$("[data-collection-tree-content]").attr("data-collection-tree-type");if(window.WGST.exports.createPanel(t,{panelId:n,panelType:t,collectionId:o}),"undefined"!=typeof l&&l(),"collection-data"===a){var i=$('.wgst-fullscreen[data-fullscreen-id="'+e+'"]').find(".wgst-panel-body"),r=$('.wgst-panel[data-panel-id="'+n+'"]');r.find(".wgst-panel-body").replaceWith(i.clone(!0)),r.find(".wgst-collection-controls").removeClass("wgst--hide-this")}else if("collection-map"===a)$('.wgst-panel[data-panel-id="'+n+'"]').find(".wgst-panel-body-container").append(window.WGST.geo.map.canvas.getDiv());else if("collection-tree"===a){var c=$('[data-fullscreen-type="collection-tree"]').find("[data-collection-tree-content]");$('.wgst-panel[data-panel-id="'+e+'"]').find(".wgst-panel-body-container").html("").append(c)}else if("assembly"===a){var i=$('[data-fullscreen-type="assembly"]');$('.wgst-panel[data-panel-id="'+e+'"]').find(".wgst-panel-body-container").html("").append(i.html())}else if("assembly-upload-progress"===a){var i=$('[data-fullscreen-type="assembly-upload-progress"]');$('.wgst-panel[data-panel-id="'+e+'"]').find(".wgst-panel-body-container").html("").append(i.html())}window.WGST.exports.removeFullscreen(e),window.WGST.exports.showPanel(n),"collection-map"===a?google.maps.event.trigger(window.WGST.geo.map.canvas,"resize"):"collection-tree"===t&&(window.WGST.collection[o].tree[s].canvas.resizeToContainer(),window.WGST.collection[o].tree[s].canvas.draw()),window.WGST.exports.bringPanelToFront(n),window.WGST.exports.happenedFullscreenToPanel(e)}},window.WGST.exports.bringPanelToFullscreen=function(e){var l=e.split("__")[0],t=e;if(!window.WGST.exports.isFullscreenExists(t)){window.WGST.exports.createFullscreen(t,{fullscreenType:l,fullscreenId:t});var n=$('.wgst-panel[data-panel-id="'+e+'"]').attr("data-panel-type"),o=$('.wgst-fullscreen[data-fullscreen-id="'+t+'"]');if("collection-data"===n){var a=$('.wgst-panel[data-panel-id="'+e+'"]').find(".wgst-panel-body");a.clone(!0).appendTo(o),o.find(".wgst-collection-controls").addClass("wgst--hide-this")}else if("collection-map"===n)$('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').find(".wgst-map").replaceWith(window.WGST.geo.map.canvas.getDiv());else if("collection-tree"===n){var s=$('[data-panel-type="collection-tree"]').find("[data-collection-tree-content]");$('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').html("").append(s)}else if("assembly"===n){var i=$('[data-panel-type="assembly"]').find(".wgst-panel-body-container");$('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').html("").append(i.html())}else if("assembly-upload-progress"===n){var r=$('[data-panel-type="assembly-upload-progress"]').find(".wgst-panel-body-container");$('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').html("").append(r.html())}if(window.WGST.exports.showFullscreen(t),"collection-map"===n)google.maps.event.trigger(window.WGST.geo.map.canvas,"resize");else if("collection-tree"===n){var c=$('[data-fullscreen-type="collection-tree"]'),d={width:c.outerWidth(),height:c.outerHeight()},p=c.find(".wgst-tree-controls"),w={width:p.outerWidth(),height:p.outerHeight()},u={width:d.width,height:d.height-w.height};$('[data-fullscreen-type="collection-tree"]').find(".wgst-tree-content").width(u.width),$('[data-fullscreen-type="collection-tree"]').find(".wgst-tree-content").height(u.height);var f=$("[data-collection-tree-content]").attr("data-collection-id"),g=$("[data-collection-tree-content]").attr("data-collection-tree-type");window.WGST.collection[f].tree[g].canvas.resizeToContainer(),window.WGST.collection[f].tree[g].canvas.draw()}window.WGST.exports.removePanel(e),window.WGST.exports.happenedPanelToFullscreen(e)}}}()});
$(function(){!function(){window.WGST.exports.createHidable=function(e,t,a){if(!($('.wgst-hidable[data-hidable-id="'+e+'"]').length>0)){var d={hidableId:e,hidableLabel:t};"undefined"!=typeof a&&$.extend(d,a),window.WGST.exports.isHidableTree(e)||("undefined"!=typeof e.split("__")[0]&&"assembly"===e.split("__")[0]?d.close=!0:("assembly-upload-navigation"===e||"assembly-upload-analytics"===e||"assembly-upload-metadata"===e)&&(d.noFullscreen=!0,d.close=!1)),"panel"===window.WGST.exports.getContainerType(e)?d.isPanel=!0:"fullscreen"===window.WGST.exports.getContainerType(e)&&(d.isFullscreen=!0);var i="hidable",s=$('.wgst-template[data-template-id="'+i+'"]').html(),n=Handlebars.compile(s),l=n(d);$(".wgst-hidables").prepend(l),window.WGST.exports.isHidableTree(e)&&window.WGST.exports.happenedHidePanel(e),window.WGST.exports.showSidebar()}},window.WGST.exports.isHidableTree=function(e){return"undefined"!=typeof e.split("__")[2]?!0:!1},window.WGST.exports.removeHidable=function(e){window.WGST.exports.isContainerExists(e)||($('.wgst-hidable[data-hidable-id="'+e+'"]').remove(),0===$(".wgst-hidable").length&&window.WGST.exports.hideSidebar())},$("body").on("mouseenter",".wgst-hidable",function(){var e=$(this).find(".wgst-hidable-controls");e.toggleClass("wgst--hide-this")}),$("body").on("mouseleave",".wgst-hidable",function(){$(this).find(".wgst-hidable-controls").addClass("wgst--hide-this")}),$("body").on("click",'[data-wgst-hidable-button="fullscreen"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id");$('.wgst-panel[data-panel-id="'+t+'"]').length>0&&(window.WGST.exports.maximizePanel(t),$(this).closest("[data-wgst-hidable-controls]").find('[data-wgst-hidable="fullscreen"]').addClass("wgst--hide-this"),$(this).closest("[data-wgst-hidable-controls]").find('[data-wgst-hidable="panel"]').removeClass("wgst--hide-this")),e.preventDefault()}),$("body").on("click",'[data-wgst-hidable-button="panel"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id");$('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').length>0&&(window.WGST.exports.bringFullscreenToPanel(t),window.WGST.exports.showPanel(t),$(this).closest("[data-wgst-hidable-controls]").find('[data-wgst-hidable="fullscreen"]').removeClass("wgst--hide-this"),$(this).closest("[data-wgst-hidable-controls]").find('[data-wgst-hidable="panel"]').addClass("wgst--hide-this")),e.preventDefault()}),$("body").on("click",'[data-wgst-hidable-button="show"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id");$('.wgst-panel[data-panel-id="'+t+'"]').length>0?(window.WGST.exports.showPanel(t),window.WGST.exports.bringPanelToFront(t)):$('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').length>0&&window.WGST.exports.showFullscreen(t),e.preventDefault()}),$("body").on("click",'[data-wgst-hidable-button="hide"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id");$('.wgst-panel[data-panel-id="'+t+'"]').length>0?window.WGST.exports.hidePanel(t):$('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').length>0&&window.WGST.exports.hideFullscreen(t),e.preventDefault()}),$("body").on("click",'[data-wgst-hidable-button="close"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id");window.WGST.exports.isContainerExists(t)&&window.WGST.exports.removeContainer(t),window.WGST.exports.removeHidable(t),e.preventDefault()}),$("body").on("click",'[data-wgst-hidable-button="focus"]',function(e){e.stopPropagation();var t=$(this).closest(".wgst-hidable").attr("data-hidable-id"),a=$('.wgst-panel[data-panel-id="'+t+'"]');if(a.length>0){var d;$(".wgst-panel").each(function(){d=$(this).attr("data-panel-id"),d!==t&&window.WGST.exports.hidePanel(d)}),(a.hasClass("wgst--hide-this")||a.hasClass("wgst--invisible-this"))&&window.WGST.exports.showPanel(t)}else $('.wgst-fullscreen[data-fullscreen-id="'+t+'"]').length>0&&($(".wgst-panel").each(function(){d=$(this).attr("data-panel-id"),window.WGST.exports.hidePanel(d)}),window.WGST.exports.showFullscreen(t));e.preventDefault()}),window.WGST.exports.happenedPanelToFullscreen=function(e){$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="panel"]').removeClass("wgst--hide-this"),$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="fullscreen"]').addClass("wgst--hide-this")},window.WGST.exports.happenedFullscreenToPanel=function(e){$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="panel"]').addClass("wgst--hide-this"),$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="fullscreen"]').removeClass("wgst--hide-this")},window.WGST.exports.happenedCreatePanel=function(e){window.WGST.exports.createHidable(e.panelId,e.panelLabel)},window.WGST.exports.happenedHidePanel=function(e){$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="show"]').removeClass("wgst--hide-this"),$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="hide"]').addClass("wgst--hide-this")},window.WGST.exports.happenedShowPanel=function(e){$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="hide"]').removeClass("wgst--hide-this"),$('.wgst-hidable[data-hidable-id="'+e+'"]').find(".wgst-hidable-controls").find('[data-wgst-hidable-button="show"]').addClass("wgst--hide-this")},window.WGST.exports.happenedRemovePanel=function(e){window.WGST.exports.removeHidable(e)},window.WGST.exports.happenedCreateFullscreen=function(e){window.WGST.exports.createHidable(e.fullscreenId,e.fullscreenLabel)},window.WGST.exports.happenedHideFullscreen=function(e){window.WGST.exports.happenedHidePanel(e)},window.WGST.exports.happenedShowFullscreen=function(e){window.WGST.exports.happenedShowPanel(e)},window.WGST.exports.happenedRemoveFullscreen=function(e){window.WGST.exports.removeHidable(e)}}()});
window.WGST=window.WGST||{},$(function(){window.chrome||$(".wgst-chrome-only").removeClass("wgst--hide-this")});
$(function(){!function(){var o,e=[],n=function(o,e){for(var n,a,t,i,r={},s=window.WGST.collection[o].assemblies,g=0;g<e.length;g++)n=e[g],a=s[n].ASSEMBLY_METADATA.geography.position.latitude,t=s[n].ASSEMBLY_METADATA.geography.position.longitude,i=new google.maps.LatLng(a,t),"undefined"==typeof r[i.toString()]&&(r[i.toString()]=[]),r[i.toString()].push(n);return r},a=function(o,n){var a={groupAssemblies:n,location:n[0].ASSEMBLY_METADATA.geography.address},t=$('.wgst-template[data-template-id="info-window"]').html(),i=Handlebars.compile(t),r=i(a),s=new google.maps.InfoWindow({content:'<div class="test">'+r+"</div>"}),g=n.map(function(o){return o.ASSEMBLY_METADATA.assemblyId});return google.maps.event.addListener(s,"closeclick",function(){0!==typeof e.length&&window.WGST.collection[o].tree.COLLECTION_TREE.canvas.setNodeColourAndShape(g,null,"o",null,null)}),s},t=function(e,n){var t=n.map(function(o){return o.ASSEMBLY_METADATA.assemblyId}),i=n[0].ASSEMBLY_METADATA.geography.position.latitude,r=n[0].ASSEMBLY_METADATA.geography.position.longitude,s=n.length,g="//chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+s+"|00FFFF|000000",p=new google.maps.LatLng(i,r),l=p.toString();window.WGST.geo.map.markers.group[l]={assemblyIds:t,marker:{}},window.WGST.geo.map.markers.group[l].marker=new google.maps.Marker({position:p,map:window.WGST.geo.map.canvas,icon:g,optimized:!0});var d=a(e,n);google.maps.event.addListener(window.WGST.geo.map.markers.group[l].marker,"click",function(){"undefined"!=typeof o&&(o.close(),google.maps.event.trigger(o,"closeclick")),d.open(window.WGST.geo.map.canvas,window.WGST.geo.map.markers.group[l].marker),o=d,window.WGST.collection[e].tree.COLLECTION_TREE.canvas.setNodeColourAndShape(t,null,"t",null,null)})},i=function(){var o,e,n=WGST.geo.map.markers.group;for(o in n)e=n[o].marker,e.setMap(null),delete WGST.geo.map.markers.group[o];$(".show-all-assemblies-on-map").prop("checked",!1)};window.WGST.exports.triggerMapMarkers=function(o,e){var a=new google.maps.LatLngBounds;if(i(),e.length>0){var r,s,g,p=n(o,e),l=window.WGST.collection[o].assemblies;for(r in p)if(p.hasOwnProperty(r)){var d,m=p[r],c=[];m.map(function(o){d=l[o],c.push(d)}),t(o,c),s=d.ASSEMBLY_METADATA.geography.position.latitude,g=d.ASSEMBLY_METADATA.geography.position.longitude,a.extend(new google.maps.LatLng(s,g))}}a.isEmpty()?(window.WGST.geo.map.canvas.setCenter(new google.maps.LatLng(48.6908333333,9.14055555556)),window.WGST.geo.map.canvas.setZoom(5)):(window.WGST.geo.map.canvas.panToBounds(a),window.WGST.geo.map.canvas.fitBounds(a))}}()});
$(function(){$('[data-navigation-id="feedback"]').on("click",function(e){window.WGST.exports.createOverlay("feedback"),e.preventDefault()})});
$(function(){!function(){window.WGST.exports.mapOverlayTypeToTemplateId={feedback:"feedback-overlay"},window.WGST.exports.createOverlay=function(e,a){if(!($('.wgst-overlay[data-overlay-id="'+e+'"]').length>0)){"undefined"==typeof a&&(a={});var t=window.WGST.exports.mapOverlayTypeToTemplateId[e],o=$('.wgst-template[data-template-id="'+t+'"]').html(),r=Handlebars.compile(o),l=r(a);$(".wgst-page__app").prepend(l)}},window.WGST.exports.removeOverlay=function(e){$('.wgst-overlay[data-overlay-id="'+e+'"]').remove()},$("body").on("click",".wgst-close-overlay",function(e){var a=$(this).closest(".wgst-overlay").attr("data-overlay-id");window.WGST.exports.removeOverlay(a),e.preventDefault()})}()});
$(function(){!function(){window.WGST.exports.mapPanelTypeToPanelHeaderTemplateId={assembly:"panel-header__assembly","collection-data":"panel-header__collection-data","collection-tree":"panel-header__collection-tree","collection-map":"panel-header__collection-map","assembly-upload-metadata":"panel-header__assembly-upload-metadata","assembly-upload-navigation":"panel-header__assembly-upload-navigation","assembly-upload-analytics":"panel-header__assembly-upload-analytics","assembly-upload-progress":"panel-header__assembly-upload-progress"},window.WGST.exports.mapPanelTypeToPanelBodyTemplateId={assembly:"panel-body__assembly","collection-data":"panel-body__collection-data","collection-tree":"panel-body__collection-tree","collection-map":"panel-body__collection-map","assembly-upload-metadata":"panel-body__assembly-upload-metadata","assembly-upload-navigation":"panel-body__assembly-upload-navigation","assembly-upload-analytics":"panel-body__assembly-upload-analytics","assembly-upload-progress":"panel-body__assembly-upload-progress"},window.WGST.exports.mapPanelTypeToPanelButtonRules={assembly:{},"collection-data":{noCloseButton:!0},"collection-tree":{noCloseButton:!0},"collection-map":{noCloseButton:!0},"assembly-upload-metadata":{noFullscreenButton:!0,noCloseButton:!0},"assembly-upload-navigation":{noFullscreenButton:!0,noCloseButton:!0},"assembly-upload-analytics":{noFullscreenButton:!0,noCloseButton:!0},"assembly-upload-progress":{noCloseButton:!0}},window.WGST.exports.createPanel=function(e,a){if($('.wgst-panel[data-panel-id="'+a.panelId+'"]').length>0)return window.WGST.exports.showPanel(a.panelId),void 0;$.extend(a,window.WGST.exports.mapPanelTypeToPanelButtonRules[e]),"undefined"==typeof a.panelLabel&&(a.panelLabel=window.WGST.exports.getContainerLabel({containerName:"panel",containerType:e,containerId:a.panelId,additional:a}));var n=$('.wgst-template[data-template-id="panel"]').html(),l=Handlebars.compile(n),t=window.WGST.exports.mapPanelTypeToPanelHeaderTemplateId[e];Handlebars.registerPartial("header",$('.wgst-template[data-template-id="'+t+'"]').html());var o=window.WGST.exports.mapPanelTypeToPanelBodyTemplateId[e];Handlebars.registerPartial("body",$('.wgst-template[data-template-id="'+o+'"]').html());var d=l(a);$(".wgst-workspace").prepend(d);var s=$('.wgst-panel[data-panel-id="'+a.panelId+'"]');s.draggable({handle:s.find(".wgst-draggable-handle"),appendTo:".wgst-page__app",scroll:!1}),window.WGST.exports.happenedCreatePanel({panelId:a.panelId,panelLabel:a.panelLabel})},window.WGST.exports.removePanel=function(e){$('.wgst-panel[data-panel-id="'+e+'"]').remove(),window.WGST.exports.happenedRemovePanel(e),"collection-map"===e&&window.WGST.geo.map.remove()},window.WGST.exports.showPanel=function(e){$('.wgst-panel[data-panel-id="'+e+'"]').removeClass("wgst--hide-this wgst--invisible-this"),window.WGST.exports.happenedShowPanel(e)},window.WGST.exports.hidePanel=function(e){$('.wgst-panel[data-panel-id="'+e+'"]').addClass("wgst--invisible-this"),window.WGST.exports.happenedHidePanel(e)},window.WGST.exports.isPanelExists=function(e){return $('.wgst-panel[data-panel-id="'+e+'"]').length>0?!0:!1},window.WGST.exports.togglePanel=function(e){var a=$('.wgst-panel[data-panel-id="'+e+'"]');a.is(".wgst--hide-this, .wgst--invisible-this")?window.WGST.exports.showPanel(e):window.WGST.exports.hidePanel(e)},window.WGST.exports.bringPanelToFront=function(e){window.WGST.exports.bringContainerToFront("panel",e)},window.WGST.exports.maximizePanel=function(e){var a=$(".wgst-fullscreen").attr("data-fullscreen-id");window.WGST.exports.bringFullscreenToPanel(a),window.WGST.exports.hidePanel(a),window.WGST.exports.bringPanelToFullscreen(e),google.maps.event.trigger(window.WGST.geo.map.canvas,"resize")},$("body").on("click",'[data-panel-header-control-button="fullscreen"]',function(){var e=$(this).closest(".wgst-panel"),a=e.attr("data-panel-id");$('[data-hidable-id="'+a+'"]').find('[data-wgst-hidable-button="fullscreen"]').trigger("click")}),$("body").on("click",'[data-panel-header-control-button="close"]',function(){var e=$(this).closest(".wgst-panel"),a=e.attr("data-panel-id");$('[data-hidable-id="'+a+'"]').find('[data-wgst-hidable-button="close"]').trigger("click")}),$("body").on("click",'[data-panel-header-control-button="hide"]',function(){var e=$(this).closest(".wgst-panel"),a=e.attr("data-panel-id");$('[data-hidable-id="'+a+'"]').find('[data-wgst-hidable-button="hide"]').trigger("click")}),$("body").on("mousedown",".wgst-panel",function(){window.WGST.exports.bringPanelToFront($(this).attr("data-panel-id"))})}()});
$(function(){!function(){window.WGST.exports.showSidebar=function(){$("[data-wgst-sidebar]").removeClass("wgst--hide-this")},window.WGST.exports.hideSidebar=function(){$("[data-wgst-sidebar]").addClass("wgst--hide-this")}}()});
$(function(){!function(){$("body").on("submit",'[data-form="subscribe"]',function(s){s.preventDefault();var i=$('[data-form="subscribe"]'),t=i.find('[data-input="email"]').val();if("undefined"!=typeof t&&""!==t){var a=$(this).find('[type="submit"]');a.prop("disabled",!0),a.find("span").addClass("wgst--hide-this"),a.find(".wgst-spinner").removeClass("wgst--hide-this");var e={email:t};$.ajax({type:"POST",url:"/subscribe/",datatype:"json",data:e}).done(function(){a.addClass("wgst--hide-this"),$(".wgst-subscribe-success-message").removeClass("wgst--hide-this")}).fail(function(){})}})}()});
$(function(){!function(){window.WGST.exports.populateListOfAntibiotics=function(i){var o,t,n=[],e={};for(o in WGST.antibiotics)for(t in WGST.antibiotics[o])n.push(t),e[t]='<option value="'+t.replace(WGST.antibioticNameRegex,"_").toLowerCase()+'">'+t+"</option>";n.sort();var a=n.length;for(a=0;a<n.length;)t=n[a],i.append($(e[t])),a+=1}}()});
String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},window.WGST.regex=window.WGST.regex||{},window.WGST.regex.EMAIL=/^(([^<>()[]\.,;:s@"]+(.[^<>()[]\.,;:s@"]+)*)|(".+"))@(([[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}])|(([a-zA-Z-0-9]+.)+[a-zA-Z]{2,}))$/;
$(function(){window.WGST=window.WGST||{},window.WGST.exports=window.WGST.exports||{},window.WGST.exports.mixpanel=window.WGST.exports.mixpanel||{},$('[data-mixpanel-open-collection="Reference"]').on("click",function(){mixpanel.track("Landing > Open reference collection")}),$('[data-mixpanel-open-collection="ST239"]').on("click",function(){mixpanel.track("Landing > Open ST239 collection")}),$('[data-mixpanel-open-collection="EMRSA15"]').on("click",function(){mixpanel.track("Landing > Open EMRSA15 collection")}),$('[data-mixpanel-button="subscribe"]').on("click",function(){mixpanel.track("Landing > Open EMRSA15 collection")}),$("body").on("click",'[data-mixpanel-navigation="feedback"]',function(){mixpanel.track("App > Open feedback")}),$("body").on("click",'[data-mixpanel-navigation="landing"]',function(){mixpanel.track("App > Go to landing page")}),$("body").on("click",'[data-mixpanel-show-tree-button="CORE_TREE_RESULT"]',function(){mixpanel.track("App | Collection Data Panel > Open CORE_TREE_RESULT tree")}),$("body").on("click","[data-mixpanel-open-assembly-panel]",function(){if($(this).is("[title]")){var n=$(this).attr("title");mixpanel.track("App | Collection Data Panel > Open assembly"),mixpanel.track("App | Collection Data Panel > Open assembly "+n)}}),window.WGST.exports.mixpanel.submitFeedback=function(){mixpanel.track("App > Submit feedback")},$('[data-mixpanel-not-found-navigation="homepage"]').on("click",function(){mixpanel.track("404 > Go to landing page")})});
$(function(){!function(){window.WGST.upload={collection:{},assembly:{},fastaAndMetadata:{},stats:{totalNumberOfContigs:0}},window.WGST.dragAndDrop={files:[],droppedFiles:[],droppedValidFiles:[],loadedFiles:[],fastaFileNameRegex:/^.+(.fa|.fas|.fna|.ffn|.faa|.frn|.fasta|.contig)$/i,csvFileTypeRegex:/^.+(.csv)$/i},window.WGST.exports.initFastaAndMetadata=function(a){"undefined"==typeof window.WGST.upload.fastaAndMetadata[a]&&(window.WGST.upload.fastaAndMetadata[a]={fasta:{name:a,assembly:""},metadata:{}})};var a=function(){var a=$('[data-wgst-background-id="drag-and-drop"]');a.find(".wgst-drag-and-drop-content").addClass("wgst-drag-over"),a.find(".wgst-drag-and-drop-content").find(".fa").addClass("animated bounce")},e=function(a){return a.preventDefault&&a.preventDefault(),a.dataTransfer.dropEffect="copy",!1},t=function(){var a=$('[data-wgst-background-id="drag-and-drop"]');a.find(".wgst-drag-and-drop-content").removeClass("wgst-drag-over"),a.find(".wgst-drag-and-drop-content").find(".fa").removeClass("animated bounce")},n=function(a){var e=a.content,t=Papa.parse(e,{header:!0,dynamicTyping:!0});return t.data},d=function(a,e){var t=moment(e);if(t.isValid()){var n=t.year();$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').find('[data-timestamp-input="year"]').val(n).change();var d=t.month();$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').find('[data-timestamp-input="month"]').val(d).change();var s=t.date();$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').find('[data-timestamp-input="day"]').val(s).change()}},s=function(a,e){var t=e,n=new google.maps.Geocoder;n.geocode({address:t},function(e,t){if(t==google.maps.GeocoderStatus.OK){var n=e[0],d=n.formatted_address,s=n.geometry.location.lat(),o=n.geometry.location.lng();$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').find(".assembly-sample-location-input").val(d).change(),window.WGST.exports.setAssemblyUploadMetadataModel(a,"geography",{address:d,position:{latitude:s,longitude:o},type:"Unknown"}),window.WGST.exports.updateMetadataProgressBar()}})},o=function(a,e){var t=e;$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').find(".assembly-sample-source-input").val(t).change()},i=function(a){0===$(".wgst-dropped-assembly-list").find('option[value="'+a+'"]').length&&$(".wgst-dropped-assembly-list").append('<option value="'+a+'">'+a+"</option>")},r=function(){$(".wgst-assembly-metadata-block").removeClass("wgst--hide-this")},l=function(a){var e=n(a);e.map(function(a){if("undefined"!=typeof a.filename){var e=a.filename;window.WGST.exports.initFastaAndMetadata(e),window.WGST.exports.renderAssemblyMetadataForm(e),window.WGST.exports.initAssemblyMetadataLocation(e),"undefined"!=typeof a.date&&d(e,a.date),"undefined"!=typeof a.location&&s(e,a.location),"undefined"!=typeof a.source&&o(e,a.source),r(),i(e)}})},u=function(a){return a.sort(function(a,e){return a.name>e.name?1:a.name<e.name?-1:0}),a},p=function(a){var e=a.name,t=a.content;window.WGST.exports.initFastaAndMetadata(e),window.WGST.upload.fastaAndMetadata[e].fasta.assembly=t;var n=T(e,t);window.WGST.exports.renderAssemblyAnalytics(e,n),window.WGST.exports.drawN50Chart(n.sumsOfNucleotidesInDnaStrings,n.assemblyN50Data,'.sequence-length-distribution-chart[data-assembly-file-id="'+e+'"]'),window.WGST.exports.renderAssemblyMetadataForm(e),window.WGST.exports.initAssemblyMetadataLocation(e),i(e)},f=function(a){return a.name.match(window.WGST.dragAndDrop.fastaFileNameRegex)},c=function(a){return a.name.match(window.WGST.dragAndDrop.csvFileTypeRegex)},m=function(a){return f(a)||c(a)?!0:!1},g=function(a){for(var e,t={validFiles:[],invalidFiles:[]},n=a.length;0!==n;)n-=1,e=a[n],m(e)?t.validFiles.push(e):t.invalidFiles.push(e);return t},w=function(a,e){var t=new FileReader;t.onload=function(a){e(null,a.target.result)},t.readAsText(a)},y=function(a,e){var t=[];a.map(function(n){w(n,function(d,s){d||(t.push({name:n.name,content:s}),t.length===a.length&&e(null,t))})})},v=function(a){var e=a[0],t="Unknown";if(c(e)){var d=n(e);t=d[0].filename}else f(e)&&(t=a[0].name);return t},b=function(a){var e=u(a);window.WGST.exports.showSidebar(),window.WGST.exports.createPanel("assembly-upload-navigation",{panelType:"assembly-upload-navigation",panelId:"assembly-upload-navigation"}),window.WGST.exports.showPanel("assembly-upload-navigation"),window.WGST.exports.createPanel("assembly-upload-metadata",{panelType:"assembly-upload-metadata",panelId:"assembly-upload-metadata"}),window.WGST.exports.showPanel("assembly-upload-metadata"),window.WGST.exports.createPanel("assembly-upload-analytics",{panelType:"assembly-upload-analytics",panelId:"assembly-upload-analytics"}),window.WGST.exports.showPanel("assembly-upload-analytics");var t="collection-map",n=t;window.WGST.exports.createFullscreen(n,{fullscreenType:t,fullscreenId:n}),window.WGST.exports.showFullscreen(n),window.WGST.geo.map.init(),e.map(function(a){c(a)?l(a):f(a)&&p(a)}),window.WGST.exports.showAssemblyUpload(v(e)),$('[data-wgst-background-id="drag-and-drop"]').addClass("wgst--hide-this")},S=function(a){if(window.WGST.config.allowUpload){var e=$('[data-wgst-background-id="drag-and-drop"]');if(e.find(".wgst-drag-and-drop-content").find(".fa").removeClass("animated bounce"),e.find(".wgst-drag-and-drop-content").find(".fa").addClass("animated pulse"),$("[data-wgst-drag-and-drop-ready]").addClass("wgst--hide-this"),$("[data-wgst-drag-and-drop-analysing-data]").removeClass("wgst--hide-this"),a.dataTransfer.files.length>0){a.stopPropagation(),a.preventDefault();var t=a.dataTransfer.files,n=g(t);return y(n.validFiles,function(a,e){b(e)}),void 0}}},T=function(a,e){var t=window.WGST.exports.extractContigsFromFastaFileString(e),n=t.length,d=window.WGST.exports.extractDnaStringsFromContigs(t),s=window.WGST.exports.calculateN50(d),o=s.sequenceLength,i=window.WGST.exports.calculateSumsOfNucleotidesInDnaStrings(d),r=window.WGST.exports.calculateTotalNumberOfNucleotidesInDnaStrings(d),l=window.WGST.exports.calculateAverageNumberOfNucleotidesInDnaStrings(d),u=window.WGST.exports.calculateSmallestNumberOfNucleotidesInDnaStrings(d),p=window.WGST.exports.calculateBiggestNumberOfNucleotidesInDnaStrings(d);return window.WGST.exports.validateContigs(t),window.WGST.upload.stats.totalNumberOfContigs=window.WGST.upload.stats.totalNumberOfContigs+t.length,{totalNumberOfContigs:n,dnaStrings:d,assemblyN50Data:s,contigN50:o,sumsOfNucleotidesInDnaStrings:i,totalNumberOfNucleotidesInDnaStrings:r,averageNumberOfNucleotidesInDnaStrings:l,smallestNumberOfNucleotidesInDnaStrings:u,biggestNumberOfNucleotidesInDnaStrings:p}},G=$("[data-wgst-drag-and-drop-zone]")[0];G.addEventListener("dragenter",a,!1),G.addEventListener("dragover",e,!1),G.addEventListener("dragleave",t,!1),G.addEventListener("drop",S,!1)}()});
$(function(){!function(){window.WGST.exports.isAssemblyAnalyticsExists=function(e){return 0===$('.wgst-upload-assembly__analytics[data-assembly-file-id="'+e+'"]').length?!1:!0},window.WGST.exports.renderAssemblyAnalytics=function(e,t){if(!window.WGST.exports.isAssemblyAnalyticsExists(e)){var s=t.totalNumberOfNucleotidesInDnaStrings,n=t.totalNumberOfContigs,i=t.smallestNumberOfNucleotidesInDnaStrings,a=t.averageNumberOfNucleotidesInDnaStrings,l=t.biggestNumberOfNucleotidesInDnaStrings,r=t.contigN50,o={assemblyFileId:e,totalNumberOfNucleotidesInDnaStrings:s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),totalNumberOfContigs:n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),smallestNumberOfNucleotidesInDnaStrings:i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),averageNumberOfNucleotidesInDnaStrings:a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),biggestNumberOfNucleotidesInDnaStrings:l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),contigN50:r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},d=$('.wgst-template[data-template-id="droppedAssemblyAnalytics"]').html(),g=Handlebars.compile(d),c=g(o);$(".wgst-assembly-upload__analytics ul").append($(c))}}}()});
$(function(){!function(){window.WGST.exports.setAssemblyMetadataValue=function(a){var t=a.assemblyFileId,e=a.assemblyMetadataKey,d=a.assemblyMetadataValue;"datetime"===e?window.WGST.upload.fastaAndMetadata[t].metadata.datetime=d:"geography"===e?(window.WGST.upload.fastaAndMetadata[t].metadata.geography={address:"",position:{latitude:"",longitude:""},type:""},window.WGST.upload.fastaAndMetadata[t].metadata.geography.address=d.address,window.WGST.upload.fastaAndMetadata[t].metadata.geography.position.latitude=d.position.latitude,window.WGST.upload.fastaAndMetadata[t].metadata.geography.position.longitude=d.position.longitude,window.WGST.upload.fastaAndMetadata[t].metadata.geography.type=d.type):"source"===e&&(window.WGST.upload.fastaAndMetadata[t].metadata.source=d),window.WGST.exports.happenedSetAssemblyMetadata(a)},window.WGST.exports.copyAssemblyMetadata=function(a,t){var e=window.WGST.upload.fastaAndMetadata[a].metadata;Object.keys(e).map(function(a){window.WGST.exports.setAssemblyMetadataValue({assemblyFileId:t,assemblyMetadataKey:a,assemblyMetadataValue:e[a]})})},window.WGST.exports.copyAssemblyMetadataToAssembliesWithNoMetadata=function(a){var t=window.WGST.upload.fastaAndMetadata;Object.keys(t).map(function(e){var d=t[e].metadata;0===Object.keys(d).length&&(window.WGST.exports.copyAssemblyMetadata(a,e),window.WGST.exports.copyAssemblyMetadataView(a,e))})},window.WGST.exports.happenedSetAssemblyMetadata=function(a){return}}()});
$(function(){!function(){window.WGST.exports.isAssemblyMetadataFormExists=function(a){return 0===$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').length?!1:!0},window.WGST.exports.renderAssemblyMetadataForm=function(a){if(!window.WGST.exports.isAssemblyMetadataFormExists(a)){var e={assemblyFileId:a,listOfYears:window.WGST.exports.generateYears(1940,2014),listOfMonths:window.WGST.exports.generateMonths(),listOfDays:window.WGST.exports.generateDays()},s=$('.wgst-template[data-template-id="droppedAssemblyMetadataForm"]').html(),t=Handlebars.compile(s),l=t(e);$(".wgst-assembly-upload__metadata ul").append($(l))}},window.WGST.exports.renderAssemblyMetadataDateForm=function(a){if(!window.WGST.exports.isAssemblyMetadataFormExists(a)){var e={assemblyFileId:a,listOfYears:window.WGST.exports.generateYears(1940,2014),listOfMonths:window.WGST.exports.generateMonths(),listOfDays:window.WGST.exports.generateDays()},s=$('.wgst-template[data-template-id="droppedAssemblyMetadataForm"]').html(),t=Handlebars.compile(s),l=t(e);$(".wgst-assembly-upload__metadata ul").append($(l))}},window.WGST.exports.copyAssemblyMetadataView=function(a,e){var s=$(".wgst-panel__assembly-upload-metadata"),t=s.find('.wgst-upload-assembly__metadata[data-assembly-file-id="'+e+'"]');window.WGST.exports.copyAssemblyMetadataTimestamp(a,e);var l=s.find('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]');$sourceAssemblyMetadataLocation=l.find(".assembly-sample-location-input"),$sourceAssemblyMetadataSource=l.find(".assembly-sample-source-input"),t.find(".assembly-sample-location-input").val($sourceAssemblyMetadataLocation.val()),t.find(".assembly-sample-source-input").val($sourceAssemblyMetadataSource.val()),$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+e+'"] .wgst-assembly-metadata-block').removeClass("wgst--hide-this")}}()});
$(function(){!function(){var e=function(e,t){return 32-new Date(e,t,32).getDate()};window.WGST.exports.populateDaySelect=function(e,a,i){e.html("").append($('<option value="-1">Choose day</option>')).append(t(a,i))};window.WGST.exports.generateYears=function(e,t){for(var a=[],i=t;i!==e-1;)a.push(i),i-=1;return a};window.WGST.exports.generateMonths=function(){var e=["January","February","March","April","May","June","July","August","September","October","November","December"];return e=e.map(function(e,t){return{name:e,number:t}})};var t=function(t,a){if("undefined"==typeof t||"undefined"==typeof a)return"";for(var i,n=e(t,a),s=0,o='<option value="{{day}}">{{day}}</option>',d="";n>s;)s+=1,i=o.replace(/{{day}}/g,s),d+=i;return d};window.WGST.exports.generateDays=function(t,a){if("undefined"==typeof t||"undefined"==typeof a)return"";for(var i=[],n=e(t,a),s=0;n>s;)s+=1,i.push(s);return i},window.WGST.exports.isValidDateString=function(e){return moment(e).isValid()},window.WGST.exports.setAssemblyMetadataDateView=function(e,t){if(window.WGST.exports.isValidDateString(t))var t=(moment(dateString).year(),moment(dateString).month(),moment(dateString).date())},window.WGST.exports.copyAssemblyMetadataTimestamp=function(e,t){if(e!==t){var a=$('.assembly-metadata-timestamp-year[data-assembly-file-id="'+e+'"]'),i=a.find("select option:selected").val(),n=$('.assembly-metadata-timestamp-month[data-assembly-file-id="'+e+'"]'),s=n.find("select option:selected").val(),o=$('.assembly-metadata-timestamp-day[data-assembly-file-id="'+e+'"]'),d=o.find("select option:selected").val(),r=$('.assembly-metadata-timestamp-year[data-assembly-file-id="'+t+'"]'),l=$('.assembly-metadata-timestamp-month[data-assembly-file-id="'+t+'"]'),m=$('.assembly-metadata-timestamp-day[data-assembly-file-id="'+t+'"]'),p=m.find("select");"-1"!==i&&r.find('option[value="'+i+'"]').prop("selected",!0),"-1"!==s&&l.find('option[value="'+s+'"]').prop("selected",!0),"-1"!==d&&(window.WGST.exports.populateDaySelect(p,i,s),p.find('option[value="'+d+'"]').prop("selected",!0)),a.is(":visible")&&r.removeClass("wgst--hide-this"),n.is(":visible")&&l.removeClass("wgst--hide-this"),o.is(":visible")&&m.removeClass("wgst--hide-this")}}}()});
window.WGST.version=window.WGST.config.version,window.WGST.socket={connection:io.connect(window.WGST.config.socketAddress),roomId:""},window.WGST.speak=!1,window.WGST.panels={assembly:{top:80,left:90},collection:{top:80,left:90},collectionTree:{top:120,left:180},mergedCollectionTree:{top:120,left:180},representativeCollectionTree:{top:80,left:90},assemblyUploadNavigator:{top:70,left:110},assemblyUploadAnalytics:{top:70,left:726},assemblyUploadMetadata:{top:225,left:110},assemblyUploadProgress:{top:80,left:90},map:{top:"15%",left:"20%"}},window.WGST.assembly={analysis:{UPLOAD_OK:"UPLOAD_OK",METADATA_OK:"METADATA_OK",MLST_RESULT:"MLST_RESULT",PAARSNP_RESULT:"PAARSNP_RESULT",FP_COMP:"FP_COMP",CORE:"CORE"}},window.WGST.collection={analysis:{CORE_MUTANT_TREE:"CORE_MUTANT_TREE"},representative:{tree:{},metadata:{}}},window.WGST.settings=window.WGST.settings||{},window.WGST.settings.referenceCollectionId=window.WGST.config.referenceCollectionId,window.WGST.antibioticNameRegex=/[\W]+/g,$(function(){"use strict";if("undefined"==typeof window.WGST.requestedCollectionId&&window.WGST.isNewCollection!==!0)return $(".wgst-page__landing").removeClass("wgst--hide-this"),void 0;if($(".wgst-page__app").removeClass("wgst--hide-this"),window.WGST.speak){var e=new SpeechSynthesisUtterance("Welcome to WGSA");window.speechSynthesis.speak(e)}$("body").tooltip({selector:'[data-toggle="tooltip"]'}),window.onerror=function(e){"undefined"!=typeof e.message,n(e)},window.WGST.geo={map:{initialised:!1,canvas:{},options:{zoom:5,center:new google.maps.LatLng(48.6908333333,9.14055555556),mapTypeId:google.maps.MapTypeId.ROADMAP,minZoom:2,maxZoom:11},markers:{assembly:{},metadata:{},representativeTree:[],group:{}},markerBounds:new google.maps.LatLngBounds,searchBoxBounds:new google.maps.LatLngBounds,init:function(){this.initialised!==!0&&(window.WGST.geo.map.canvas=new google.maps.Map($(".wgst-map")[0],window.WGST.geo.map.options),window.WGST.geo.map.initialised=!0,window.WGST.geo.map.markers.metadata=new google.maps.Marker({position:new google.maps.LatLng(51.511214,-.119824),map:window.WGST.geo.map.canvas,visible:!1}),google.maps.event.addListener(window.WGST.geo.map.canvas,"bounds_changed",function(){window.WGST.geo.map.searchBoxBounds=window.WGST.geo.map.canvas.getBounds()}))},remove:function(){window.WGST.geo.map.initialised=!1}},placeSearchBox:{}},window.WGST.alert={status:{SUCCESS:"success",FAILURE:"failure"}},window.WGST.init={all:{SOCKET_CONNECT:"Socket connected",SOCKET_ROOM_ID:"Received socket room id",REPRESENTATIVE_COLLECTION_TREE_METADATA:"Loaded representative collectiontree metadata"},loaded:[]};var t=function(e){if(WGST.init.loaded.push(e),WGST.init.loaded.length===Object.keys(WGST.init.all).length){var t=$(".wgst-init");t.find(".wgst-init-status").html(""),setTimeout(function(){t.fadeOut("fast")},500),delete window.WGST.init}};$(".tree-controls-draw-subtree").on("click",function(){var e=$(this).closest(".wgst-panel").attr("data-collection-id"),t=$(this).attr("data-selected-node");WGST.collection[e].tree.canvas.redrawFromBranch(t)}),$(".collection-view-horizontal-split").on("click",function(){$(".wgst-paper__collection-tree"),$(".wgst-paper__collection-metadata")});var o=function(e,t,o){if(WGST.speak){var e=new SpeechSynthesisUtterance(e);window.speechSynthesis.speak(e),WGST.speak=!1}var n=$(".wgst-alert");n.attr("class","wgst-alert").addClass("wgst-alert__"+t),n.html(e).show(),o&&setTimeout(function(){n.fadeOut("fast")},3e3)},n=function(){var e=$(".wgst-notification__error");e.html("Please refresh your page.").show()};!function(){$(".wgst-draggable").draggable({handle:".wgst-draggable-handle",appendTo:"body",scroll:!1,start:function(){ringDragging=!0},stop:function(e,t){ringDragging=!1;var o=t.helper.attr("data-panel-name");WGST.panels[o].top=t.position.top,WGST.panels[o].left=t.position.left}}),WGST.socket.connection.on("roomId",function(e){WGST.socket.roomId=e,t(WGST.init.all.SOCKET_ROOM_ID)}),WGST.socket.connection.emit("getRoomId"),WGST.socket.connection.on("connect",function(){"undefined"!=typeof WGST.init&&t(WGST.init.all.SOCKET_CONNECT)}),WGST.socket.connection.on("error",function(){o("Unexpected error has occured.",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("disconnect",function(){o("Disconnected from the server.",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("reconnecting",function(){o("Reconnecting to the server...",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("reconnect",function(){o("Reconnected to the server.",WGST.alert.status.SUCCESS,!0)}),WGST.socket.connection.on("reconnect_failed",function(){o("Failed to reconnect to the server.",WGST.alert.status.FAILURE,!1)}),t(WGST.init.all.REPRESENTATIVE_COLLECTION_TREE_METADATA)}(),"undefined"!=typeof WGST.requestedCollectionId?window.WGST.exports.getCollection(WGST.requestedCollectionId):window.WGST.exports.showBackground("drag-and-drop");var i=function(e){for(var t,o,n=e,i=n.offset(),a=n.closest(".wgst-panel").attr("data-collection-id"),s=WGST.collection[a].tree.CORE_TREE_RESULT.canvas,l=s.leaves,c={top:s.translateClickY(i.top),left:s.translateClickX(i.left)},r={bottom:s.translateClickY(i.top+n.height()),right:s.translateClickX(i.left+n.width())},d=$(".collection-assembly-list"),p=$(".collection-assembly-list-full"),T=document.createDocumentFragment(),w=0,g=0;g<l.length;)o=l[g],o.centerx>=c.left&&o.centerx<=r.right&&o.centery>=c.top&&o.centery<=r.bottom&&(t=p.find('.assembly-list-item[data-assembly-id="'+o.id+'"]')[0],T.appendChild(t.cloneNode(!0)),w+=1),g+=1;w>7?$(".collection-assembly-list-more-assemblies").show():$(".collection-assembly-list-more-assemblies").hide();for(var S=d[0];S.firstChild;)S.removeChild(S.firstChild);S.appendChild(T),d.find('.antibiotic[data-toggle="tooltip"]').tooltip()};$("body").on("click",".tree-controls-match-assembly-list",function(){var e=$(this).closest(".wgst-panel-body-container").find("canvas.phylocanvas");i(e)})});