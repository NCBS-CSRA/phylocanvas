window.WGST.version="0.1.4",window.WGST.socket={connection:io.connect(window.WGST.config.socketAddress),roomId:""},window.WGST.speak=!1,window.WGST.panels={assembly:{top:80,left:90},collection:{top:80,left:90},collectionTree:{top:120,left:180},mergedCollectionTree:{top:120,left:180},representativeCollectionTree:{top:80,left:90},assemblyUploadNavigator:{top:70,left:110},assemblyUploadAnalytics:{top:70,left:726},assemblyUploadMetadata:{top:225,left:110},assemblyUploadProgress:{top:80,left:90},map:{top:"15%",left:"20%"}},window.WGST.assembly={analysis:{UPLOAD_OK:"UPLOAD_OK",METADATA_OK:"METADATA_OK",MLST_RESULT:"MLST_RESULT",PAARSNP_RESULT:"PAARSNP_RESULT",FP_COMP:"FP_COMP",CORE:"CORE"}},window.WGST.collection={analysis:{CORE_MUTANT_TREE:"CORE_MUTANT_TREE"},representative:{tree:{},metadata:{}}},window.WGST.upload={collection:{},assembly:{},fastaAndMetadata:{},stats:{totalNumberOfContigs:0}},window.WGST.settings=window.WGST.settings||{},window.WGST.settings.referenceCollectionId=window.WGST.config.referenceCollectionId,window.WGST.antibioticNameRegex=/[\W]+/g,$(function(){"use strict";if("undefined"==typeof window.WGST.requestedCollectionId&&window.WGST.isNewCollection!==!0)return $(".wgst-page__landing").removeClass("wgst--hide-this"),void 0;if($(".wgst-page__app").removeClass("wgst--hide-this"),window.WGST.speak){var e=new SpeechSynthesisUtterance("Welcome to WGSA");window.speechSynthesis.speak(e)}$("body").tooltip({selector:'[data-toggle="tooltip"]'}),window.onerror=function(e){"undefined"!=typeof e.message?console.error("[WGST][Error] "+e.message):(console.error("[WGST][Error]"),console.dir(e)),n(e)},window.WGST.geo={map:{initialised:!1,canvas:{},options:{zoom:5,center:new google.maps.LatLng(48.6908333333,9.14055555556),mapTypeId:google.maps.MapTypeId.ROADMAP,minZoom:2,maxZoom:11},markers:{assembly:{},metadata:{},representativeTree:[],group:{}},markerBounds:new google.maps.LatLngBounds,searchBoxBounds:new google.maps.LatLngBounds,init:function(){console.debug("*** 1 No no no ****"),this.initialised!==!0&&(console.debug("*** 2 No no no ****"),window.WGST.geo.map.canvas=new google.maps.Map($(".wgst-map")[0],window.WGST.geo.map.options),window.WGST.geo.map.initialised=!0,window.WGST.geo.map.markers.metadata=new google.maps.Marker({position:new google.maps.LatLng(51.511214,-.119824),map:window.WGST.geo.map.canvas,visible:!1}),google.maps.event.addListener(window.WGST.geo.map.canvas,"bounds_changed",function(){window.WGST.geo.map.searchBoxBounds=window.WGST.geo.map.canvas.getBounds()}))},remove:function(){window.WGST.geo.map.initialised=!1}},placeSearchBox:{}},window.WGST.alert={status:{SUCCESS:"success",FAILURE:"failure"}},window.WGST.init={all:{SOCKET_CONNECT:"Socket connected",SOCKET_ROOM_ID:"Received socket room id",REPRESENTATIVE_COLLECTION_TREE_METADATA:"Loaded representative collectiontree metadata"},loaded:[]},window.WGST.dragAndDrop=WGST.dragAndDrop||{},window.WGST.dragAndDrop.files=[],window.WGST.dragAndDrop.fastaFileNameRegex=/^.+(.fa|.fas|.fna|.ffn|.faa|.frn|.fasta|.contig)$/i;var t=function(e){if(WGST.init.loaded.push(e),WGST.init.loaded.length===Object.keys(WGST.init.all).length){var t=$(".wgst-init");t.find(".wgst-init-status").html(""),setTimeout(function(){t.fadeOut("fast")},500),delete window.WGST.init}};$(".tree-controls-draw-subtree").on("click",function(){var e=$(this).closest(".wgst-panel").attr("data-collection-id"),t=$(this).attr("data-selected-node");console.log("collectionId: "+e),console.log("selectedNode: "+t),WGST.collection[e].tree.canvas.redrawFromBranch(t)}),$(".collection-view-horizontal-split").on("click",function(){$(".wgst-paper__collection-tree"),$(".wgst-paper__collection-metadata")});var o=function(e,t,o){if(console.error("[WGST][Error] âœ— "+e),WGST.speak){var e=new SpeechSynthesisUtterance(e);window.speechSynthesis.speak(e),WGST.speak=!1}var n=$(".wgst-alert");n.attr("class","wgst-alert").addClass("wgst-alert__"+t),n.html(e).show(),o&&setTimeout(function(){n.fadeOut("fast")},3e3)},n=function(){var e=$(".wgst-notification__error");e.html("Please refresh your page.").show()};!function(){$(".wgst-draggable").draggable({handle:".wgst-draggable-handle",appendTo:"body",scroll:!1,start:function(){ringDragging=!0},stop:function(e,t){ringDragging=!1;var o=t.helper.attr("data-panel-name");WGST.panels[o].top=t.position.top,WGST.panels[o].left=t.position.left}}),WGST.socket.connection.on("roomId",function(e){console.log("[WGST][Socket.io] Received room id: "+e),console.log("[WGST][Socket.io] Ready"),WGST.socket.roomId=e,t(WGST.init.all.SOCKET_ROOM_ID)}),WGST.socket.connection.emit("getRoomId"),WGST.socket.connection.on("connect",function(){"undefined"!=typeof WGST.init&&t(WGST.init.all.SOCKET_CONNECT)}),WGST.socket.connection.on("error",function(){o("Unexpected error has occured.",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("disconnect",function(){o("Disconnected from the server.",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("reconnecting",function(){o("Reconnecting to the server...",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("reconnect",function(){o("Reconnected to the server.",WGST.alert.status.SUCCESS,!0)}),WGST.socket.connection.on("reconnect_failed",function(){o("Failed to reconnect to the server.",WGST.alert.status.FAILURE,!1)}),t(WGST.init.all.REPRESENTATIVE_COLLECTION_TREE_METADATA)}(),"undefined"!=typeof WGST.requestedCollectionId?window.WGST.exports.getCollection(WGST.requestedCollectionId):window.WGST.exports.showBackground("drag-and-drop");var a={},s="",i=function(){var e=0;$.each($(".assembly-item"),function(t,o){e+=parseInt($(o).find(".assembly-stats-number-contigs").text(),10)}),$(".assembly-sequences-average").text(Math.floor(e/Object.keys(a).length)),$(".assembly-upload-total-number").text(Object.keys(a).length)};$(".wgst-assembly-upload__metadata").on("change",".assembly-sample-source-input",function(){var e=$(this);0!==e.val()&&(e.closest(".form-block").next(".form-block").fadeIn(),e.closest(".assembly-metadata").animate({scrollTop:e.closest(".assembly-metadata").height()},400)),updateMetadataProgressBar(),$(".adding-metadata-progress-container .progress-hint").fadeOut()});$(".cancel-assembly-upload-button").on("click",function(){$('.assembly-item[data-name="'+s+'"]').remove(),delete a[s],$(".assembly-list-slider").slider("option","max",WGST.dragAndDrop.droppedFiles.length),$(".total-number-of-dropped-assemblies").text(WGST.dragAndDrop.droppedFiles.length),updateSelectedFilesUI($(".assembly-list-slider").slider("value")),1===Object.keys(a).length?($(".assembly-upload-total-number-label").text("assembly"),$(".upload-single-assembly-file-name").text(a[Object.getOwnPropertyNames(a)[0]].name),$(".upload-multiple-assemblies-label").hide(),$(".upload-single-assembly-label").show(),$(".assembly-navigator").hide()):updateRangeNavigationButtons($(".assembly-list-slider").slider("value")),i(),updateMetadataProgressBar()}),$(".tree-panel .wgst-tree-controls button").on("click",function(){$(this).blur()}),$(".wgst-navigation-item").on("click",function(e){e.preventDefault()}),$(".wgst-navigation-item__map").on("click",function(){var e=$(".wgst-fullscreen--active");"map"===e.attr("data-fullscreen-name")&&bringFullscreenToPanel(!1),window.WGST.openPanel("map"),google.maps.event.trigger(WGST.geo.map.canvas,"resize")}),$(".wgst-navigation-item__representative-tree").on("click",function(){return!1}),$(".wgst-navigation-item__collection").on("click",function(){if(isNavItemEnabled("collection")){var e=$(".wgst-fullscreen--active");"collection"===e.attr("data-fullscreen-name")&&bringFullscreenToPanel(!1),window.WGST.openPanel("collection")}});$("body").on("click",".wgst-panel-control-button__opacity",function(){if($(this).hasClass("wgst-panel-control-button--active")){var e=$(this).closest(".wgst-panel");"1"!==e.css("opacity")?e.css("opacity","1"):e.css("opacity","0.85")}});var l=function(e){for(var t,o,n=e,a=n.offset(),s=n.closest(".wgst-panel").attr("data-collection-id"),i=WGST.collection[s].tree.CORE_TREE_RESULT.canvas,l=i.leaves,c={top:i.translateClickY(a.top),left:i.translateClickX(a.left)},r={bottom:i.translateClickY(a.top+n.height()),right:i.translateClickX(a.left+n.width())},d=$(".collection-assembly-list"),p=$(".collection-assembly-list-full"),g=document.createDocumentFragment(),m=0,w=0;w<l.length;)o=l[w],o.centerx>=c.left&&o.centerx<=r.right&&o.centery>=c.top&&o.centery<=r.bottom&&(t=p.find('.assembly-list-item[data-assembly-id="'+o.id+'"]')[0],g.appendChild(t.cloneNode(!0)),m+=1),w+=1;m>7?$(".collection-assembly-list-more-assemblies").show():$(".collection-assembly-list-more-assemblies").hide();for(var T=d[0];T.firstChild;)T.removeChild(T.firstChild);T.appendChild(g),d.find('.antibiotic[data-toggle="tooltip"]').tooltip()};$("body").on("click",".tree-controls-match-assembly-list",function(){var e=$(this).closest(".wgst-panel-body-container").find("canvas.phylocanvas");l(e)})});