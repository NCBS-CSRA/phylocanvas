window.WGST.version="0.1.4",window.WGST.socket={connection:io.connect(window.WGST.config.socketAddress),roomId:""},window.WGST.speak=!1,window.WGST.panels={assembly:{top:80,left:90},collection:{top:80,left:90},collectionTree:{top:120,left:180},mergedCollectionTree:{top:120,left:180},representativeCollectionTree:{top:80,left:90},assemblyUploadNavigator:{top:70,left:110},assemblyUploadAnalytics:{top:70,left:726},assemblyUploadMetadata:{top:225,left:110},assemblyUploadProgress:{top:80,left:90},map:{top:"15%",left:"20%"}},window.WGST.assembly={analysis:{UPLOAD_OK:"UPLOAD_OK",METADATA_OK:"METADATA_OK",MLST_RESULT:"MLST_RESULT",PAARSNP_RESULT:"PAARSNP_RESULT",FP_COMP:"FP_COMP",CORE:"CORE"}},window.WGST.collection={analysis:{COLLECTION_TREE:"COLLECTION_TREE",CORE_MUTANT_TREE:"CORE_MUTANT_TREE"},representative:{tree:{},metadata:{}}},window.WGST.upload={collection:{},assembly:{},fastaAndMetadata:{},stats:{totalNumberOfContigs:0}},window.WGST.settings=window.WGST.settings||{},window.WGST.settings.representativeCollectionId=window.WGST.config.referenceCollectionId,window.WGST.antibioticNameRegex=/[\W]+/g,$(function(){"use strict";if("undefined"==typeof window.WGST.requestedCollectionId&&window.WGST.isNewCollection!==!0)return $(".wgst-page__landing").removeClass("wgst--hide-this"),void 0;if($(".wgst-page__app").removeClass("wgst--hide-this"),window.WGST.speak){var e=new SpeechSynthesisUtterance("Welcome to WGSA");window.speechSynthesis.speak(e)}if($("body").tooltip({selector:'[data-toggle="tooltip"]'}),"undefined"!=typeof window.WGST.requestedCollectionId){var t="collection-map",o="collection-map";window.WGST.exports.createFullscreen(o,{fullscreenType:t,fullscreenId:o}),window.WGST.exports.showFullscreen(o)}window.onerror=function(e){"undefined"!=typeof e.message?console.error("[WGST][Error] "+e.message):(console.error("[WGST][Error]"),console.dir(e)),s(e)},window.WGST.geo={map:{initialised:!1,canvas:{},options:{zoom:5,center:new google.maps.LatLng(48.6908333333,9.14055555556),mapTypeId:google.maps.MapTypeId.ROADMAP,minZoom:2,maxZoom:11},markers:{assembly:{},metadata:{},representativeTree:[],group:{}},markerBounds:new google.maps.LatLngBounds,searchBoxBounds:new google.maps.LatLngBounds,init:function(){this.initialised!==!0&&(window.WGST.geo.map.canvas=new google.maps.Map($(".wgst-map")[0],window.WGST.geo.map.options),window.WGST.geo.map.initialised=!0,window.WGST.geo.map.markers.metadata=new google.maps.Marker({position:new google.maps.LatLng(51.511214,-.119824),map:WGST.geo.map.canvas,visible:!1}),google.maps.event.addListener(WGST.geo.map.canvas,"bounds_changed",function(){window.WGST.geo.map.searchBoxBounds=window.WGST.geo.map.canvas.getBounds()}))}},placeSearchBox:{}},window.WGST.alert={status:{SUCCESS:"success",FAILURE:"failure"}},window.WGST.init={all:{SOCKET_CONNECT:"Socket connected",SOCKET_ROOM_ID:"Received socket room id",REPRESENTATIVE_COLLECTION_TREE_METADATA:"Loaded representative collectiontree metadata"},loaded:[]},window.WGST.dragAndDrop=WGST.dragAndDrop||{},window.WGST.dragAndDrop.files=[],window.WGST.dragAndDrop.fastaFileNameRegex=/^.+(.fa|.fas|.fna|.ffn|.faa|.frn|.fasta|.contig)$/i;var n=function(e){if(WGST.init.loaded.push(e),WGST.init.loaded.length===Object.keys(WGST.init.all).length){var t=$(".wgst-init");t.find(".wgst-init-status").html(""),setTimeout(function(){t.fadeOut("fast")},500),delete window.WGST.init}};$(".tree-controls-draw-subtree").on("click",function(){var e=$(this).closest(".wgst-panel").attr("data-collection-id"),t=$(this).attr("data-selected-node");console.log("collectionId: "+e),console.log("selectedNode: "+t),WGST.collection[e].tree.canvas.redrawFromBranch(t)}),$(".collection-view-horizontal-split").on("click",function(){$(".wgst-paper__collection-tree"),$(".wgst-paper__collection-metadata")});var a=function(e,t,o){if(console.error("[WGST][Error] âœ— "+e),WGST.speak){var e=new SpeechSynthesisUtterance(e);window.speechSynthesis.speak(e),WGST.speak=!1}var n=$(".wgst-alert");n.attr("class","wgst-alert").addClass("wgst-alert__"+t),n.html(e).show(),o&&setTimeout(function(){n.fadeOut("fast")},3e3)},s=function(){var e=$(".wgst-notification__error");e.html("Please refresh your page.").show()};!function(){$(".wgst-draggable").draggable({handle:".wgst-draggable-handle",appendTo:"body",scroll:!1,start:function(){ringDragging=!0},stop:function(e,t){ringDragging=!1;var o=t.helper.attr("data-panel-name");WGST.panels[o].top=t.position.top,WGST.panels[o].left=t.position.left}}),WGST.socket.connection.on("roomId",function(e){console.log("[WGST][Socket.io] Received room id: "+e),console.log("[WGST][Socket.io] Ready"),WGST.socket.roomId=e,n(WGST.init.all.SOCKET_ROOM_ID)}),WGST.socket.connection.emit("getRoomId"),WGST.socket.connection.on("connect",function(){"undefined"!=typeof WGST.init&&n(WGST.init.all.SOCKET_CONNECT)}),WGST.socket.connection.on("error",function(){a("Unexpected error has occured.",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("disconnect",function(){a("Disconnected from the server.",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("reconnecting",function(){a("Reconnecting to the server...",WGST.alert.status.FAILURE,!1)}),WGST.socket.connection.on("reconnect",function(){a("Reconnected to the server.",WGST.alert.status.SUCCESS,!0)}),WGST.socket.connection.on("reconnect_failed",function(){a("Failed to reconnect to the server.",WGST.alert.status.FAILURE,!1)}),n(WGST.init.all.REPRESENTATIVE_COLLECTION_TREE_METADATA)}(),"undefined"!=typeof WGST.requestedCollectionId?window.WGST.exports.getCollection(WGST.requestedCollectionId):$(".wgst-header-collection-name").text("New");var l={},i="",c=function(){var e=0;$.each($(".assembly-item"),function(t,o){e+=parseInt($(o).find(".assembly-stats-number-contigs").text(),10)}),$(".assembly-sequences-average").text(Math.floor(e/Object.keys(l).length)),$(".assembly-upload-total-number").text(Object.keys(l).length)};$(".wgst-assembly-upload__metadata").on("change",".assembly-sample-source-input",function(){var e=$(this);0!==e.val()&&(e.closest(".form-block").next(".form-block").fadeIn(),e.closest(".assembly-metadata").animate({scrollTop:e.closest(".assembly-metadata").height()},400)),updateMetadataProgressBar(),$(".adding-metadata-progress-container .progress-hint").fadeOut()});$(".cancel-assembly-upload-button").on("click",function(){$('.assembly-item[data-name="'+i+'"]').remove(),delete l[i],$(".assembly-list-slider").slider("option","max",WGST.dragAndDrop.droppedFiles.length),$(".total-number-of-dropped-assemblies").text(WGST.dragAndDrop.droppedFiles.length),updateSelectedFilesUI($(".assembly-list-slider").slider("value")),1===Object.keys(l).length?($(".assembly-upload-total-number-label").text("assembly"),$(".upload-single-assembly-file-name").text(l[Object.getOwnPropertyNames(l)[0]].name),$(".upload-multiple-assemblies-label").hide(),$(".upload-single-assembly-label").show(),$(".assembly-navigator").hide()):updateRangeNavigationButtons($(".assembly-list-slider").slider("value")),c(),updateMetadataProgressBar()}),$(".tree-panel .wgst-tree-controls button").on("click",function(){$(this).blur()}),$("body").on("click",".wgst-tree-control__show-newick",function(){var e,t,o=$(this).closest(".wgst-panel").attr("data-collection-id"),n=$(this).closest(".wgst-panel").attr("data-collection-tree-type");e=WGST.collection[o].tree[n].newickStringWithLabels,t=window.open(),t.document.write(e)}),$("body").on("click",".wgst-tree-control__decrease-label-font-size",function(){var e,t,o=$(this).closest(".wgst-panel").attr("data-collection-id"),n=$(this).closest(".wgst-panel").attr("data-collection-tree-type");t=WGST.collection[o].tree[n].canvas,e=t.textSize,t.setTextSize(e-3)}),$("body").on("click",".wgst-tree-control__increase-label-font-size",function(){var e,t,o=$(this).closest(".wgst-panel").attr("data-collection-id"),n=$(this).closest(".wgst-panel").attr("data-collection-tree-type");t=WGST.collection[o].tree[n].canvas,e=t.textSize,t.setTextSize(e+3)}),$("body").on("click",".wgst-tree-control__decrease-node-size",function(){var e,t,o=$(this).closest(".wgst-panel").attr("data-collection-id"),n=$(this).closest(".wgst-panel").attr("data-collection-tree-type");e=WGST.collection[o].tree[n].canvas,t=e.baseNodeSize,t>3?(e.setNodeSize(t-3),t=e.baseNodeSize,3>t&&$(this).attr("disabled",!0)):$(this).attr("disabled",!0)}),$("body").on("click",".wgst-tree-control__increase-node-size",function(){var e,t,o=$(this).closest(".wgst-panel").attr("data-collection-id"),n=$(this).closest(".wgst-panel").attr("data-collection-tree-type");e=WGST.collection[o].tree[n].canvas,t=e.baseNodeSize,e.setNodeSize(t+3),e.baseNodeSize>3&&$(this).closest(".wgst-tree-control").find(".wgst-tree-control__decrease-node-size").attr("disabled",!1)}),$("body").on("change",".wgst-tree-control__show-node-labels",function(){var e,t=$(this).closest(".wgst-panel").attr("data-collection-id"),o=$(this).closest(".wgst-panel").attr("data-collection-tree-type");e=WGST.collection[t].tree[o].canvas,e.toggleLabels()});$(".wgst-navigation-item").on("click",function(e){e.preventDefault()}),$(".wgst-navigation-item__map").on("click",function(){var e=$(".wgst-fullscreen--active");"map"===e.attr("data-fullscreen-name")&&bringFullscreenToPanel(!1),window.WGST.openPanel("map"),google.maps.event.trigger(WGST.geo.map.canvas,"resize")}),$(".wgst-navigation-item__representative-tree").on("click",function(){return!1}),$(".wgst-navigation-item__collection").on("click",function(){if(isNavItemEnabled("collection")){var e=$(".wgst-fullscreen--active");"collection"===e.attr("data-fullscreen-name")&&bringFullscreenToPanel(!1),window.WGST.openPanel("collection")}});$("body").on("click",".wgst-panel-control-button__opacity",function(){if($(this).hasClass("wgst-panel-control-button--active")){var e=$(this).closest(".wgst-panel");"1"!==e.css("opacity")?e.css("opacity","1"):e.css("opacity","0.85")}});var r=function(e){for(var t,o,n=e,a=n.offset(),s=n.closest(".wgst-panel").attr("data-collection-id"),l=WGST.collection[s].tree.CORE_TREE_RESULT.canvas,i=l.leaves,c={top:l.translateClickY(a.top),left:l.translateClickX(a.left)},r={bottom:l.translateClickY(a.top+n.height()),right:l.translateClickX(a.left+n.width())},d=$(".collection-assembly-list"),p=$(".collection-assembly-list-full"),g=document.createDocumentFragment(),m=0,w=0;w<i.length;)o=i[w],o.centerx>=c.left&&o.centerx<=r.right&&o.centery>=c.top&&o.centery<=r.bottom&&(t=p.find('.assembly-list-item[data-assembly-id="'+o.id+'"]')[0],g.appendChild(t.cloneNode(!0)),m+=1),w+=1;m>7?$(".collection-assembly-list-more-assemblies").show():$(".collection-assembly-list-more-assemblies").hide();for(var T=d[0];T.firstChild;)T.removeChild(T.firstChild);T.appendChild(g),d.find('.antibiotic[data-toggle="tooltip"]').tooltip()};$(".collection-assembly-list-view-all-assemblies").on("click",function(e){var t=$(this).closest(".wgst-panel").attr("data-collection-id"),o=$(".collection-assembly-list");WGST.collection[t].tree.canvas.redrawOriginalTree(),WGST.collection[t].tree.canvas.setZoom(-.05),o.find(".assembly-list-item").remove(),o.append($(".collection-assembly-list-full .assembly-list-item").clone()),o.find('.antibiotic[data-toggle="tooltip"]').tooltip(),$(".collection-assembly-list-all-assemblies").hide(),$(".collection-assembly-list-more-assemblies").show(),e.preventDefault()}),$("body").on("click",".tree-controls-match-assembly-list",function(){var e=$(this).closest(".wgst-panel-body-content").find("canvas.phylocanvas");r(e)})});