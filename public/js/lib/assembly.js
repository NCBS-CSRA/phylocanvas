$(function(){!function(){window.WGST.exports.createAssemblyPanel=function(e,o){var n="assembly__"+e,r="assembly",s={panelId:n,panelType:r};return"undefined"!=typeof o&&$.extend(s,o),window.WGST.exports.createPanel(r,s),n},window.WGST.exports.calculateAssemblyTopScore=function(e){var o,n=[];for(o in e)e.hasOwnProperty(o)&&n.push({referenceId:e[o].referenceId,score:e[o].score});return n=n.sort(function(e,o){return o.score-e.score}),n[0]};var e=function(e){var o="";return o=0===e.length?"Not found":e},o=function(e,o){var n,r,s,a,t,l,i=[];for(s in e)if(e.hasOwnProperty(s)){a=e[s],n=[];for(t in a)a.hasOwnProperty(t)&&(r="","undefined"!=typeof o[s]?"undefined"!=typeof o[s][t]?(l=o[s][t].resistanceState,r="RESISTANT"===l?"RESISTANT":"SENSITIVE"===l?"SENSITIVE":"UNKNOWN"):r="UNKNOWN":r="UNKNOWN",n.push({antibioticName:t,antibioticResistanceData:r}));i.push({antibioticGroupName:s,antibioticGroupResistanceData:n})}return i},n=function(e){var o,n,r,s=[];for(r in e)e.hasOwnProperty(r)&&(o=e[r],n={},n=null===o?{locusId:"None",alleleId:r}:{locusId:e[r].locusId,alleleId:e[r].alleleId},s.push(n));return s},r=function(e){var o=window.WGST.exports.calculateAssemblyTopScore(e),n=o.referenceId;return n},s=function(e,o){for(var n=[],r=Object.keys(o).sort(function(e,n){return o[e]-o[n]}),s=r.length;0!==s;){s-=1;var a=r[s],t=o[a],l=t.score.toFixed(2)+" = "+Math.round(t.score*parseInt(e,10))+"/"+e;n.push({referenceId:t.referenceId,text:l})}return n};window.WGST.exports.getAssembly=function(a){$.ajax({type:"POST",url:"/api/assembly",datatype:"json",data:{assemblyId:a}}).done(function(t){console.log("[WGST] Received data for assembly "+a);var l=t.assembly,i=l.ASSEMBLY_METADATA.userAssemblyId,c=t.antibiotics,d=l.PAARSNP_RESULT.paarResult.resistanceProfile,u=o(c,d);console.debug("assemblyResistanceData:"),console.dir(u);var p=l.MLST_RESULT.stType,f=e(p);console.debug("assemblySequenceTypeData:"),console.log(f);var b=l.MLST_RESULT.alleles,y=n(b);console.debug("assemblyMlstData:"),console.dir(y);var S=l.FP_COMP.scores,T=r(S);console.debug("assemblyNearestRepresentativeData:"),console.dir(T);var m=l.FP_COMP.fingerprintSize,w=s(m,S);console.debug("assemblyScoresData:"),console.dir(w);var I={assemblyUserId:i,antibioticResistanceData:u,sequenceTypeData:f,mlstData:y,nearestRepresentativeData:T,scoresData:w};console.debug("additionalTemplateContext:"),console.dir(I);var N=window.WGST.exports.createAssemblyPanel(a,I);window.WGST.exports.bringPanelToFront(N),window.WGST.exports.showPanel(N)}).fail(function(e,o,n){console.log("[WGST][Error] Failed to get assembly data"),console.error(o),console.error(n),console.error(e),showNotification(o)})}}()});