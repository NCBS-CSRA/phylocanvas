$(function(){!function(){window.WGST.exports.createAssemblyPanel=function(e,o){var n="assembly__"+e,s="assembly",r={panelId:n,panelType:s};return"undefined"!=typeof o&&$.extend(r,o),window.WGST.exports.createPanel(s,r),n},window.WGST.exports.calculateAssemblyTopScore=function(e){var o,n=[];for(o in e)e.hasOwnProperty(o)&&n.push({referenceId:e[o].referenceId,score:e[o].score});return n=n.sort(function(e,o){return o.score-e.score}),n[0]};var e=function(e){var o="";return o=0===e.length?"Not found":e},o=function(e,o){var n,s,r,a,t,l,i=[];for(r in e)if(e.hasOwnProperty(r)){a=e[r],n=[];for(t in a)a.hasOwnProperty(t)&&(s="","undefined"!=typeof o[r]?"undefined"!=typeof o[r][t]?(l=o[r][t].resistanceState,s="RESISTANT"===l?"RESISTANT":"SENSITIVE"===l?"SENSITIVE":"UNKNOWN"):s="UNKNOWN":s="UNKNOWN",n.push({antibioticName:t,antibioticResistanceData:s}));i.push({antibioticGroupName:r,antibioticGroupResistanceData:n})}return i},n=function(e){var o,n,s,r=[];for(s in e)e.hasOwnProperty(s)&&(o=e[s],n={},n=null===o?{locusId:"None",alleleId:s}:{locusId:e[s].locusId,alleleId:e[s].alleleId},r.push(n));return r},s=function(e){var o=window.WGST.exports.calculateAssemblyTopScore(e),n=o.referenceId;return n},r=function(e,o){for(var n=[],s=Object.keys(o).sort(function(e,n){return o[e]-o[n]}),r=s.length;0!==r;){r-=1;var a=s[r],t=o[a],l=t.score.toFixed(2)+" = "+Math.round(t.score*parseInt(e,10))+"/"+e;n.push({referenceId:t.referenceId,text:l})}return n};window.WGST.exports.getAssembly=function(a){$.ajax({type:"POST",url:"/api/assembly",datatype:"json",data:{assemblyId:a}}).done(function(t){console.log("[WGST] Received data for assembly "+a);var l=t.assembly,i=l.ASSEMBLY_METADATA.userAssemblyId,c=t.antibiotics,d=l.PAARSNP_RESULT.paarResult.resistanceProfile,u=o(c,d);console.debug("assemblyResistanceData:"),console.dir(u);var p=l.MLST_RESULT.stType,f=e(p);console.debug("assemblySequenceTypeData:"),console.log(f);var b=l.MLST_RESULT.alleles,y=n(b);console.debug("assemblyMlstData:"),console.dir(y);var S=l.FP_COMP.scores,T=s(S);console.debug("assemblyNearestRepresentativeData:"),console.dir(T);var m=l.FP_COMP.fingerprintSize,w=r(m,S);console.debug("assemblyScoresData:"),console.dir(w);var I={assemblyUserId:i,antibioticResistanceData:u,sequenceTypeData:f,mlstData:y,nearestRepresentativeData:T,scoresData:w};console.debug("additionalTemplateContext:"),console.dir(I);var N=window.WGST.exports.createAssemblyPanel(a,I);window.WGST.exports.bringPanelToTop(N),window.WGST.exports.showPanel(N)}).fail(function(e,o,n){console.log("[WGST][Error] Failed to get assembly data"),console.error(o),console.error(n),console.error(e),showNotification(o)})}}()});