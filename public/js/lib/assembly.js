$(function(){!function(){window.WGST.exports.createAssemblyPanel=function(e,n){var o="assembly__"+e,r="assembly",s={panelId:o,panelType:r};return"undefined"!=typeof n&&$.extend(s,n),window.WGST.exports.createPanel(r,s),o},window.WGST.exports.calculateAssemblyTopScore=function(e){var n,o=[];for(n in e)e.hasOwnProperty(n)&&o.push({referenceId:e[n].referenceId,score:e[n].score});return o=o.sort(function(e,n){return n.score-e.score}),o[0]};var e=function(e){var n="";return n=0===e.length?"Not found":e},n=function(e,n){var o,r,s,t,a,l,c=[];for(s in e)if(e.hasOwnProperty(s)){t=e[s],o=[];for(a in t)t.hasOwnProperty(a)&&(r="","undefined"!=typeof n[s]?"undefined"!=typeof n[s][a]?(l=n[s][a].resistanceState,r="RESISTANT"===l?"RESISTANT":"SENSITIVE"===l?"SENSITIVE":"UNKNOWN"):r="UNKNOWN":r="UNKNOWN",o.push({antibioticName:a,antibioticResistanceData:r}));c.push({antibioticGroupName:s,antibioticGroupResistanceData:o})}return c},o=function(e){var n,o,r,s=[];for(r in e)e.hasOwnProperty(r)&&(n=e[r],o={},o=null===n?{locusId:"None",alleleId:r}:{locusId:e[r].locusId,alleleId:e[r].alleleId},s.push(o));return s},r=function(e){var n=window.WGST.exports.calculateAssemblyTopScore(e),o=n.referenceId;return o},s=function(e,n){for(var o=[],r=Object.keys(n).sort(function(e,o){return n[e]-n[o]}),s=r.length;0!==s;){s-=1;var t=r[s],a=n[t],l=a.score.toFixed(2)+" = "+Math.round(a.score*parseInt(e,10))+"/"+e;o.push({referenceId:a.referenceId,text:l})}return o};window.WGST.exports.getAssembly=function(t){$.ajax({type:"POST",url:"/api/assembly",datatype:"json",data:{assemblyId:t}}).done(function(a){console.log("[WGST] Received data for assembly "+t);var l=a.assembly,c=l.ASSEMBLY_METADATA.userAssemblyId,i=a.antibiotics,u=l.PAARSNP_RESULT.paarResult.resistanceProfile,d=n(i,u),p=l.MLST_RESULT.stType,f=e(p);console.debug("assemblySequenceTypeData:"),console.log(f);var S=l.MLST_RESULT.alleles,y=o(S);console.debug("assemblyMlstData:"),console.dir(y);var T=l.FP_COMP.scores,b=r(T);console.debug("assemblyNearestRepresentativeData:"),console.dir(b);var I=l.FP_COMP.fingerprintSize,m=s(I,T);console.debug("assemblyScoresData:"),console.dir(m);var w={assemblyUserId:c,antibioticResistanceData:d,sequenceTypeData:f,mlstData:y,nearestRepresentativeData:b,scoresData:m},N=window.WGST.exports.createAssemblyPanel(t,w);window.WGST.exports.bringPanelToFront(N),window.WGST.exports.showPanel(N)}).fail(function(e,n,o){console.log("[WGST][Error] Failed to get assembly data"),console.error(n),console.error(o),console.error(e)})}}()});