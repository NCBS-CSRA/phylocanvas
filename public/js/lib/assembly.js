$(function(){!function(){window.WGST.exports.createAssemblyPanel=function(e,s){var a="assembly__"+e,o="assembly",t={panelId:a,panelType:o};return"undefined"!=typeof s&&$.extend(t,s),window.WGST.exports.createPanel(o,t),a},window.WGST.exports.calculateAssemblyTopScore=function(e){var s,a=[];for(s in e)e.hasOwnProperty(s)&&a.push({referenceId:e[s].referenceId,score:e[s].score});return a=a.sort(function(e,s){return s.score-e.score}),a[0]};var e=function(e){var s="";return s=0===e.length?"Not found":e},s=function(e,s){var a,o,t,r,n,l,i=[];for(t in e)if(e.hasOwnProperty(t)){r=e[t],a=[];for(n in r)r.hasOwnProperty(n)&&(o="","undefined"!=typeof s[t]?"undefined"!=typeof s[t][n]?(l=s[t][n].resistanceState,o="RESISTANT"===l?"RESISTANT":"SENSITIVE"===l?"SENSITIVE":"UNKNOWN"):o="UNKNOWN":o="UNKNOWN",a.push({antibioticName:n,antibioticResistanceData:o}));i.push({antibioticGroupName:t,antibioticGroupResistanceData:a})}return i},a=function(e){var s,a,o,t=[];for(o in e)e.hasOwnProperty(o)&&(s=e[o],a={},a=null===s?{locusId:"None",alleleId:o}:{locusId:e[o].locusId,alleleId:e[o].alleleId},t.push(a));return t},o=function(e){var s=window.WGST.exports.calculateAssemblyTopScore(e),a=s.referenceId;return a},t=function(e,s){for(var a=[],o=Object.keys(s).sort(function(e,a){return s[e]-s[a]}),t=o.length;0!==t;){t-=1;var r=o[t],n=s[r],l=n.score.toFixed(2)+" = "+Math.round(n.score*parseInt(e,10))+"/"+e;a.push({referenceId:n.referenceId,text:l})}return a};window.WGST.exports.getAssemblyData=function(e,s){console.log("[WGST] Getting assembly "+e+" data"),$.ajax({type:"POST",url:"/api/assembly",datatype:"json",data:{assemblyId:e}}).done(function(a){console.log("[WGST] Received data for assembly "+e),s({assembly:a.assembly,antibiotics:a.antibiotics},null)}).fail(function(e,a){s(null,a)})},window.WGST.exports.prepareAssemblyDataForRendering=function(r,n){console.log("[WGST] Parsing assembly "+r.assemblyId+" data");var l={metadata:{}},i=r.ASSEMBLY_METADATA.userAssemblyId;l.assemblyUserId=i;var c=r.PAARSNP_RESULT.paarResult.resistanceProfile,d=s(n,c);l.resistanceProfile=d;var u=r.MLST_RESULT.stType,p=e(u);l.sequenceType=p,console.debug("assemblySequenceTypeData:"),console.log(p);var y=r.MLST_RESULT.alleles,S=a(y);l.mlst=S,console.debug("assemblyMlstData:"),console.dir(S);var b=r.FP_COMP.scores,T=o(b);l.nearestRepresentative=T,console.debug("assemblyNearestRepresentativeData:"),console.dir(T);var m=r.FP_COMP.fingerprintSize,f=t(m,b);l.scores=f,console.debug("assemblyScoresData:"),console.dir(f);var w=window.WGST.exports.calculateAssemblyTopScore(b);return l.topScore=w,l.topScorePercentage=Math.round(100*w.score.toFixed(2)),l.metadata.latitude=r.ASSEMBLY_METADATA.geography.position.latitude,l.metadata.longitude=r.ASSEMBLY_METADATA.geography.position.longitude,l},window.WGST.exports.getAssembly=function(e){window.WGST.exports.getAssemblyData(e,function(s,a){if(a)return console.error("[WGST][Error] Failed to get assembly data: "+a),void 0;var o=window.WGST.exports.prepareAssemblyDataForRendering(s.assembly,s.antibiotics),t={assemblyUserId:o.assemblyUserId,antibioticResistanceData:o.resistanceProfile,sequenceTypeData:o.sequenceType,mlstData:o.mlst,nearestRepresentativeData:o.nearestRepresentative,scoresData:o.scores},r=window.WGST.exports.createAssemblyPanel(e,t);window.WGST.exports.bringPanelToFront(r),window.WGST.exports.showPanel(r)})},window.WGST.exports.__old_remove__getAssembly=function(r){console.log("[WGST] Getting assembly "+r),$.ajax({type:"POST",url:"/api/assembly",datatype:"json",data:{assemblyId:r}}).done(function(n){console.log("[WGST] Received data for assembly "+r);var l=n.assembly,i=l.ASSEMBLY_METADATA.userAssemblyId,c=n.antibiotics,d=l.PAARSNP_RESULT.paarResult.resistanceProfile,u=s(c,d),p=l.MLST_RESULT.stType,y=e(p);console.debug("assemblySequenceTypeData:"),console.log(y);var S=l.MLST_RESULT.alleles,b=a(S);console.debug("assemblyMlstData:"),console.dir(b);var T=l.FP_COMP.scores,m=o(T);console.debug("assemblyNearestRepresentativeData:"),console.dir(m);var f=l.FP_COMP.fingerprintSize,w=t(f,T);console.debug("assemblyScoresData:"),console.dir(w);var g={assemblyUserId:i,antibioticResistanceData:u,sequenceTypeData:y,mlstData:b,nearestRepresentativeData:m,scoresData:w},A=window.WGST.exports.createAssemblyPanel(r,g);window.WGST.exports.bringPanelToFront(A),window.WGST.exports.showPanel(A)}).fail(function(e,s,a){console.error("[WGST][Error] Failed to get assembly data"),console.error(s),console.error(a),console.error(e)})}}()});