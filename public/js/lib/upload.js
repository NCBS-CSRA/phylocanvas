$(function(){!function(){var e=/csv/,a=0,t=function(){var e=$('[data-wgst-background-id="drag-and-drop"]');e.find(".wgst-drag-and-drop-content").addClass("wgst-drag-over"),e.find(".wgst-drag-and-drop-content").find(".fa").addClass("animated bounce")},n=function(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",!1},s=function(){var e=$('[data-wgst-background-id="drag-and-drop"]');e.find(".wgst-drag-and-drop-content").removeClass("wgst-drag-over"),e.find(".wgst-drag-and-drop-content").find(".fa").removeClass("animated bounce")},l=function(t){if(window.WGST.config.allowUpload){var n=$('[data-wgst-background-id="drag-and-drop"]');if(n.find(".wgst-drag-and-drop-content").find(".fa").removeClass("animated bounce"),n.find(".wgst-drag-and-drop-content").find(".fa").addClass("animated pulse"),$("[data-wgst-drag-and-drop-ready]").addClass("wgst--hide-this"),$("[data-wgst-drag-and-drop-analysing-data]").removeClass("wgst--hide-this"),t.dataTransfer.files.length>0){t.stopPropagation(),t.preventDefault();var s="";if(WGST.speak){var l,o="";o=s.length>0?"You have dropped "+t.dataTransfer.files.length+" files to the existing collection.":"You have dropped "+t.dataTransfer.files.length+" files",l=new SpeechSynthesisUtterance(o),window.speechSynthesis.speak(l)}var r=t.dataTransfer.files;WGST.dragAndDrop.files=$.merge(WGST.dragAndDrop.files,r),WGST.dragAndDrop.loadedFiles=[];{var i=WGST.dragAndDrop.files,p=i[0],g=p.name;new FileReader}1===i.length?($(".upload-multiple-assemblies-label").hide(),$(".upload-single-assembly-file-name").text(g),$(".upload-single-assembly-label").show()):($(".upload-single-assembly-label").hide(),$(".upload-multiple-assemblies-label").show()),$(".total-number-of-dropped-assemblies").text(i.length),$(".assembly-list-slider").slider("option","max",i.length-1),$(".assembly-file-name").text(g),i.length>1&&($(".assembly-navigator").show(),$(".ui-slider-handle").focus()),a=Object.keys(i).length,$.each(i,function(a,t){if(t.type.match(e))console.log("Dropped CSV file"),console.dir(t),handleCsvDrop(t);else if(t.name.match(WGST.dragAndDrop.fastaFileNameRegex)){if(console.log("Dropped FASTA file"),0===$('.wgst-panel__assembly-upload-analytics .assembly-item[data-name="'+t.name+'"]').length){var n=new FileReader;n.addEventListener("load",function(e){if(console.log("[WGST] Loaded file "+e.target.name),WGST.dragAndDrop.loadedFiles.push({uid:uuid.v4(),event:e,fileCounter:a,file:t,droppedFiles:r,collectionId:s}),WGST.dragAndDrop.loadedFiles.length===WGST.dragAndDrop.files.length){WGST.dragAndDrop.loadedFiles.sort(function(e,a){return e.file.name>a.file.name?1:e.file.name<a.file.name?-1:0}),window.WGST.exports.showSidebar(),window.WGST.exports.createPanel("assembly-upload-navigation",{panelType:"assembly-upload-navigation",panelId:"assembly-upload-navigation"}),window.WGST.exports.showPanel("assembly-upload-navigation"),window.WGST.exports.createPanel("assembly-upload-metadata",{panelType:"assembly-upload-metadata",panelId:"assembly-upload-metadata"}),window.WGST.exports.showPanel("assembly-upload-metadata"),window.WGST.exports.createPanel("assembly-upload-analytics",{panelType:"assembly-upload-analytics",panelId:"assembly-upload-analytics"}),window.WGST.exports.showPanel("assembly-upload-analytics");var n="collection-map",l=n;window.WGST.exports.createFullscreen(l,{fullscreenType:n,fullscreenId:l}),window.WGST.exports.showFullscreen(l),window.WGST.geo.map.init(),window.WGST.dragAndDrop.loadedFiles.forEach(function(e){d(e.event,e.fileCounter,e.file,e.droppedFiles,e.collectionId,e.uid),$(".wgst-dropped-assembly-list").append('<option value="'+e.file.name+'">'+e.file.name+"</option>")}),window.WGST.exports.showAssemblyUpload(WGST.dragAndDrop.loadedFiles[0].file.name),$('[data-wgst-background-id="drag-and-drop"]').addClass("wgst--hide-this")}}),n.readAsText(t)}}else React.renderComponent(WorkflowQuestion({title:"What type of data have you dropped?",buttons:[{label:"Assemblies in FASTA format",value:"fasta"},{label:"Metadata in CSV format",value:"csv"}]}),document.querySelectorAll(".wgst-react-component__workflow-question")[0])}),$(".assembly-upload-total-number").text(i.length),$(".assembly-upload-total-number-label").html(1===i.length?"assembly":"assemblies")}}},d=function(e,a,t){var n=t.name,s=e.target.result;window.WGST.upload.fastaAndMetadata[n]={fasta:{name:n,assembly:s},metadata:{}};var l=e.target.result,d=window.WGST.exports.extractContigsFromFastaFileString(l);window.WGST.exports.validateContigs(d);var o=window.WGST.exports.extractDnaStringsFromContigs(d),r=window.WGST.exports.calculateN50(o),o=window.WGST.exports.extractDnaStringsFromContigs(d),i=window.WGST.exports.calculateTotalNumberOfNucleotidesInDnaStrings(o),p=window.WGST.exports.calculateAverageNumberOfNucleotidesInDnaStrings(o),g=window.WGST.exports.calculateSmallestNumberOfNucleotidesInDnaStrings(o),u=window.WGST.exports.calculateBiggestNumberOfNucleotidesInDnaStrings(o);console.log("[WGST] * dev * dnaStrings:"),console.dir(o),console.log("[WGST] * dev * totalNumberOfNucleotidesInDnaStrings: "+i),console.log("[WGST] * dev * averageNumberOfNucleotidesInDnaStrings: "+p),console.log("[WGST] * dev * smallestNumberOfNucleotidesInDnaStrings: "+g),console.log("[WGST] * dev * biggestNumberOfNucleotidesInDnaStrings: "+u),window.WGST.upload.stats.totalNumberOfContigs=window.WGST.upload.stats.totalNumberOfContigs+d.length;var m={assemblyFileId:n,totalNumberOfNucleotidesInDnaStrings:i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),totalNumberOfContigs:d.length.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),smallestNumberOfNucleotidesInDnaStrings:g.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),averageNumberOfNucleotidesInDnaStrings:p.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),biggestNumberOfNucleotidesInDnaStrings:u.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),contigN50:r.sequenceLength.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},c=$('.wgst-template[data-template-id="droppedAssemblyAnalytics"]').html(),w=Handlebars.compile(c),f=w(m);$(".wgst-assembly-upload__analytics ul").append($(f));var S={assemblyFileId:n,listOfYears:window.WGST.exports.generateYears(1940,2014),listOfMonths:window.WGST.exports.generateMonths(),listOfDays:window.WGST.exports.generateDays()},b=$('.wgst-template[data-template-id="droppedAssemblyMetadataForm"]').html(),T=Handlebars.compile(b),h=T(S);$(".wgst-assembly-upload__metadata ul").append($(h));var v=window.WGST.exports.calculateSumsOfNucleotidesInDnaStrings(o);window.WGST.exports.drawN50Chart(v,r,'.sequence-length-distribution-chart[data-assembly-file-id="'+n+'"]'),window.WGST.exports.initAssemblyUploadMetadataLocation(n)},o=$("[wgst-drag-and-drop-zone]")[0];o.addEventListener("dragenter",t,!1),o.addEventListener("dragover",n,!1),o.addEventListener("dragleave",s,!1),o.addEventListener("drop",l,!1)}()});