$(function(){!function(){var e=/csv/,a=0,t=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},l=function(t){if(window.WGST.config.allowUpload&&t.dataTransfer.files.length>0){t.stopPropagation(),t.preventDefault();var l="";if(WGST.speak){var n,o="";o=l.length>0?"You have dropped "+t.dataTransfer.files.length+" files to the existing collection.":"You have dropped "+t.dataTransfer.files.length+" files",n=new SpeechSynthesisUtterance(o),window.speechSynthesis.speak(n)}var d=t.dataTransfer.files;WGST.dragAndDrop.files=$.merge(WGST.dragAndDrop.files,d),WGST.dragAndDrop.loadedFiles=[];{var i=WGST.dragAndDrop.files,r=i[0],p=r.name;new FileReader}1===i.length?($(".upload-multiple-assemblies-label").hide(),$(".upload-single-assembly-file-name").text(p),$(".upload-single-assembly-label").show()):($(".upload-single-assembly-label").hide(),$(".upload-multiple-assemblies-label").show()),$(".total-number-of-dropped-assemblies").text(i.length),$(".assembly-list-slider").slider("option","max",i.length-1),$(".assembly-file-name").text(p),i.length>1&&($(".assembly-navigator").show(),$(".ui-slider-handle").focus()),a=Object.keys(i).length,$.each(i,function(a,t){if(t.type.match(e))console.log("Dropped CSV file"),console.dir(t),handleCsvDrop(t);else if(t.name.match(WGST.dragAndDrop.fastaFileNameRegex)){if(console.log("Dropped FASTA file"),0===$('.wgst-panel__assembly-upload-analytics .assembly-item[data-name="'+t.name+'"]').length){var n=new FileReader;n.addEventListener("load",function(e){console.log("[WGST] Loaded file "+e.target.name),WGST.dragAndDrop.loadedFiles.push({uid:uuid.v4(),event:e,fileCounter:a,file:t,droppedFiles:d,collectionId:l}),WGST.dragAndDrop.loadedFiles.length===WGST.dragAndDrop.files.length&&(WGST.dragAndDrop.loadedFiles.sort(function(e,a){return e.file.name>a.file.name?1:e.file.name<a.file.name?-1:0}),window.WGST.exports.createPanel("assembly-upload-navigation",{panelType:"assembly-upload-navigation",panelId:"assembly-upload-navigation"}),window.WGST.exports.showPanel("assembly-upload-navigation"),window.WGST.exports.createPanel("assembly-upload-metadata",{panelType:"assembly-upload-metadata",panelId:"assembly-upload-metadata"}),window.WGST.exports.showPanel("assembly-upload-metadata"),window.WGST.exports.createPanel("assembly-upload-analytics",{panelType:"assembly-upload-analytics",panelId:"assembly-upload-analytics"}),window.WGST.exports.showPanel("assembly-upload-analytics"),WGST.dragAndDrop.loadedFiles.forEach(function(e){s(e.event,e.fileCounter,e.file,e.droppedFiles,e.collectionId,e.uid),$(".wgst-dropped-assembly-list").append('<option value="'+e.file.name+'">'+e.file.name+"</option>")}),window.WGST.exports.showAssemblyUpload(WGST.dragAndDrop.loadedFiles[0].file.name))}),n.readAsText(t)}}else React.renderComponent(WorkflowQuestion({title:"What type of data have you dropped?",buttons:[{label:"Assemblies in FASTA format",value:"fasta"},{label:"Metadata in CSV format",value:"csv"}]}),document.querySelectorAll(".wgst-react-component__workflow-question")[0])}),$(".assembly-upload-total-number").text(i.length),$(".assembly-upload-total-number-label").html(1===i.length?"assembly":"assemblies")}},s=function(e,a,t){var l=t.name,s=e.target.result;window.WGST.upload.fastaAndMetadata[l]={fasta:{name:l,assembly:s},metadata:{}};var n=e.target.result,o=window.WGST.exports.extractContigsFromFastaFileString(n);window.WGST.exports.validateContigs(o);var d=window.WGST.exports.extractDnaStringsFromContigs(o),i=window.WGST.exports.calculateN50(d),d=window.WGST.exports.extractDnaStringsFromContigs(o),r=window.WGST.exports.calculateTotalNumberOfNucleotidesInDnaStrings(d),p=window.WGST.exports.calculateAverageNumberOfNucleotidesInDnaStrings(d),g=window.WGST.exports.calculateSmallestNumberOfNucleotidesInDnaStrings(d),m=window.WGST.exports.calculateBiggestNumberOfNucleotidesInDnaStrings(d);console.log("[WGST] * dev * dnaStrings:"),console.dir(d),console.log("[WGST] * dev * totalNumberOfNucleotidesInDnaStrings: "+r),console.log("[WGST] * dev * averageNumberOfNucleotidesInDnaStrings: "+p),console.log("[WGST] * dev * smallestNumberOfNucleotidesInDnaStrings: "+g),console.log("[WGST] * dev * biggestNumberOfNucleotidesInDnaStrings: "+m),window.WGST.upload.stats.totalNumberOfContigs=window.WGST.upload.stats.totalNumberOfContigs+o.length;var u={assemblyFileId:l,totalNumberOfNucleotidesInDnaStrings:r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),totalNumberOfContigs:o.length.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),smallestNumberOfNucleotidesInDnaStrings:g.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),averageNumberOfNucleotidesInDnaStrings:p.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),biggestNumberOfNucleotidesInDnaStrings:m.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),contigN50:i.sequenceLength.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},c=$('.wgst-template[data-template-id="droppedAssemblyAnalytics"]').html(),f=Handlebars.compile(c),S=f(u);$(".wgst-assembly-upload__analytics ul").append($(S));var w={assemblyFileId:l,listOfYears:window.WGST.exports.generateYears(1940,2014),listOfMonths:window.WGST.exports.generateMonths(),listOfDays:window.WGST.exports.generateDays()},b=$('.wgst-template[data-template-id="droppedAssemblyMetadataForm"]').html(),T=Handlebars.compile(b),y=T(w);$(".wgst-assembly-upload__metadata ul").append($(y));var h=window.WGST.exports.calculateSumsOfNucleotidesInDnaStrings(d);window.WGST.exports.drawN50Chart(h,i,'.sequence-length-distribution-chart[data-assembly-file-id="'+l+'"]'),window.WGST.exports.initAssemblyUploadMetadataLocation(l)},n=$("body")[0];n.addEventListener("dragover",t,!1),n.addEventListener("drop",l,!1)}()});