$(function(){!function(){window.WGST.exports.showAssemblyUploadMetadata=function(a){$(".wgst-panel__assembly-upload-metadata .wgst-upload-assembly__metadata").addClass("wgst--hide-this"),$('.wgst-panel__assembly-upload-metadata .wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]').removeClass("wgst--hide-this"),$(".wgst-panel__assembly-upload-metadata header").find("small").text(a)},$("body").on("change",".wgst-assembly-upload__metadata .assembly-timestamp-input",function(){var a=$(this),t=a.attr("data-assembly-file-id"),s=$('.assembly-timestamp-input-year[data-assembly-file-id="'+t+'"]').val(),d=$('.assembly-timestamp-input-month[data-assembly-file-id="'+t+'"]').val(),l=$('.assembly-timestamp-input-day[data-assembly-file-id="'+t+'"]'),i=l.val(),n=a.attr("data-timestamp-input");("year"===n||"month"===n)&&"-1"!==s&&"-1"!==d&&(e(l,s,d),"-1"!==i&&l.find('option:contains("'+i+'")').prop("selected",!0)),"year"===n?$('.assembly-metadata-timestamp-month[data-assembly-file-id="'+t+'"]').removeClass("wgst--hide-this"):"month"===n&&$('.assembly-metadata-timestamp-day[data-assembly-file-id="'+t+'"]').removeClass("wgst--hide-this");var m;"-1"!==s&&(m="-1"!==d?"-1"!==i?new Date(s,d,i):new Date(s,d):new Date(s),window.WGST.exports.setAssemblyUploadMetadataModel(t,"datetime",m)),"-1"!==s&&o(a)}),window.WGST.exports.updateMetadataProgressBar=function(){var a=+$(".assembly-timestamp-input-year").length+$(".assembly-sample-location-input").length+$(".assembly-sample-source-input").length,e=+$(".assembly-timestamp-input-year").filter(function(){return"-1"!==this.value}).length+$(".assembly-sample-location-input").filter(function(){return 0!==this.value.length}).length+$(".assembly-sample-source-input").filter(function(){return"0"!==this.value}).length,t=Math.floor(100*e/a);if($(".adding-metadata-progress-container .progress-bar").width(t+"%"),$(".adding-metadata-progress-container .progress-bar").attr("aria-valuenow",t),$(".adding-metadata-progress-container .progress-percentage").text(t+"%"),100===t&&($(".adding-metadata-progress-container .progress-container").hide(),$(".adding-metadata-progress-container .upload-controls-container").show(),WGST.speak)){var s=new SpeechSynthesisUtterance("Ready to upload");window.speechSynthesis.speak(s)}};var a=function(a,e){return 32-new Date(a,e,32).getDate()},e=function(a,e,s){a.html("").append($('<option value="-1">Choose day</option>')).append(t(e,s))};window.WGST.exports.generateYears=function(a,e){for(var t=[],s=e;s!==a-1;)t.push(s),s-=1;return t};window.WGST.exports.generateMonths=function(){var a=["January","February","March","April","May","June","July","August","September","October","November","December"];return a=a.map(function(a,e){return{name:a,number:e}})};var t=function(e,t){if("undefined"==typeof e||"undefined"==typeof t)return"";for(var s,d=a(e,t),o=0,l='<option value="{{day}}">{{day}}</option>',i="";d>o;)o+=1,s=l.replace(/{{day}}/g,o),i+=s;return i};window.WGST.exports.generateDays=function(e,t){if("undefined"==typeof e||"undefined"==typeof t)return"";for(var s=[],d=a(e,t),o=0;d>o;)o+=1,s.push(o);return s},window.WGST.exports.initAssemblyUploadMetadataLocation=function(a){var e=$('.wgst-assembly-upload__metadata li[data-assembly-file-id="'+a+'"] .assembly-sample-location-input')[0];WGST.geo.placeSearchBox[a]=new google.maps.places.SearchBox(e,{bounds:WGST.geo.map.searchBoxBounds}),google.maps.event.addListener(WGST.geo.placeSearchBox[a],"places_changed",function(){s(a)})};var s=function(a){console.debug("Debug: "+$('.assembly-sample-location-input[data-assembly-file-id="'+a+'"]').length);var e=WGST.geo.placeSearchBox[a].getPlaces(),t=e[0];if("undefined"==typeof t||"undefined"==typeof t.geometry)return console.dir(WGST.geo.placeSearchBox[a]),void 0;var s=t.geometry.location.lat(),d=t.geometry.location.lng(),l=t.formatted_address;console.log("[WGST] Google Places API first SearchBox place: "+l);var i=$('.assembly-sample-location-input[data-assembly-file-id="'+a+'"]');i.val().length>0&&o(i),i.blur().val(l),WGST.geo.map.canvas.setCenter(t.geometry.location),WGST.geo.map.markers.metadata.setMap(WGST.geo.map.canvas),WGST.geo.map.markers.metadata.setPosition(t.geometry.location),WGST.geo.map.markers.metadata.setVisible(!0),window.WGST.exports.setAssemblyUploadMetadataModel(a,"geography",{address:l,position:{latitude:s,longitude:d},type:t.types[0]}),window.WGST.exports.updateMetadataProgressBar()};$("body").on("change",".assembly-sample-source-input",function(){var a=$(this).attr("data-assembly-file-id"),e=$(this);window.WGST.exports.setAssemblyUploadMetadataModel(a,"source",$(this).val()),window.WGST.exports.updateMetadataProgressBar(),o(e)}),$("body").on("click",".wgst-panel__assembly-upload-metadata .copy-metadata-to-all-empty-assemblies",function(){var a=$(this).closest(".wgst-upload-assembly__metadata"),e=a.find(".assembly-sample-location-input"),t=a.find(".assembly-sample-source-input"),s=a.attr("data-assembly-file-id"),o={assemblyFileId:s,metadata:window.WGST.upload.fastaAndMetadata[s].metadata},l=$(".wgst-panel__assembly-upload-metadata");$.each(window.WGST.upload.fastaAndMetadata,function(a,s){0===Object.keys(s.metadata).length&&(window.WGST.upload.fastaAndMetadata[a].metadata.datetime=o.metadata.datetime,window.WGST.upload.fastaAndMetadata[a].metadata.geography={address:"",position:{latitude:"",longitude:""},type:""},window.WGST.upload.fastaAndMetadata[a].metadata.geography.address=o.metadata.geography.address,console.debug("window.WGST.upload.fastaAndMetadata[targetAssemblyFileId].metadata"),console.debug(a),console.dir(window.WGST.upload.fastaAndMetadata[a].metadata),window.WGST.upload.fastaAndMetadata[a].metadata.geography.position.latitude=o.metadata.geography.position.latitude,window.WGST.upload.fastaAndMetadata[a].metadata.geography.position.longitude=o.metadata.geography.position.longitude,window.WGST.upload.fastaAndMetadata[a].metadata.geography.type=o.metadata.geography.type,window.WGST.upload.fastaAndMetadata[a].metadata.source=o.metadata.source,$targetAssemblyMetadata=l.find('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"]'),d(o.assemblyFileId,a),$targetAssemblyMetadata.find(".assembly-sample-location-input").val(e.val()),$targetAssemblyMetadata.find(".assembly-sample-source-input").val(t.val()),$('.wgst-upload-assembly__metadata[data-assembly-file-id="'+a+'"] .assembly-metadata-block').removeClass("wgst--hide-this"))}),$(".assembly-metadata-block").show(),window.WGST.exports.updateMetadataProgressBar()});var d=function(a,t){if(a!==t){var s=$('.assembly-metadata-timestamp-year[data-assembly-file-id="'+a+'"]'),d=s.find("select option:selected").val(),o=$('.assembly-metadata-timestamp-month[data-assembly-file-id="'+a+'"]'),l=o.find("select option:selected").val(),i=$('.assembly-metadata-timestamp-day[data-assembly-file-id="'+a+'"]'),n=i.find("select option:selected").val(),m=$('.assembly-metadata-timestamp-year[data-assembly-file-id="'+t+'"]'),r=$('.assembly-metadata-timestamp-month[data-assembly-file-id="'+t+'"]'),p=$('.assembly-metadata-timestamp-day[data-assembly-file-id="'+t+'"]'),u=p.find("select");"-1"!==d&&m.find('option[value="'+d+'"]').prop("selected",!0),"-1"!==l&&r.find('option[value="'+l+'"]').prop("selected",!0),"-1"!==n&&(e(u,d,l),u.find('option[value="'+n+'"]').prop("selected",!0)),s.is(":visible")&&m.removeClass("wgst--hide-this"),o.is(":visible")&&r.removeClass("wgst--hide-this"),i.is(":visible")&&p.removeClass("wgst--hide-this")}},o=function(a){a.closest(".assembly-metadata-block").next(".assembly-metadata-block").removeClass("wgst--hide-this"),a.closest(".wgst-upload-assembly__metadata .assembly-metadata").animate({scrollTop:a.closest(".assembly-metadata-block").next(".assembly-metadata-block").offset().top},"fast")};window.WGST.exports.setAssemblyUploadMetadataModel=function(a,e,t){window.WGST.upload.fastaAndMetadata[a].metadata=window.WGST.upload.fastaAndMetadata[a].metadata||{},window.WGST.upload.fastaAndMetadata[a].metadata[e]=t},window.WGST.exports.getAssemblyUploadMetadataModel=function(a,e){return window.WGST.upload.fastaAndMetadata[a].metadata[e]}}()});