$(function(){!function(){window.WGST.exports.mapCollectionIdToCollectionName={"5324c298-4cd0-4329-848b-30d7fe28a560":"EMRSA15","c0ca8c57-11b9-4e27-93a5-6ffe841e7768":"ST239","b8d3aab1-625f-49aa-9857-a5e97f5d6be5":"Reference"},window.WGST.exports.initCollectionDataStructure=function(e,t){WGST.collection[e]={assemblies:{},tree:{}},$.isArray(t)&&t.forEach(function(t){window.WGST.collection[e].tree[t]={}})},window.WGST.exports.setCollectionData=function(e,t,o){window.WGST.exports.initCollectionDataStructure(e),window.WGST.collection[e].assemblies=t,$.each(o,function(t,o){window.WGST.collection[e].tree[t]={type:t,data:o.data,name:o.name}})};var e=function(e){var t=window.WGST.collection[e].assemblies,o=[],i=[],a="COLLECTION_TREE",s=window.WGST.collection[e].tree[a];$.each(s.leavesOrder,function(e,a){o.push(t[a.id]),i.push(a.id)}),window.WGST.collection[e].sortedAssemblyIds=i};window.WGST.exports.getCollection=function(o){if(console.log("[WGST] Getting collection "+o),window.WGST.speak){var i=new SpeechSynthesisUtterance("Loading collection");window.speechSynthesis.speak(i)}window.WGST.exports.showBackground("get-collection"),$.ajax({type:"POST",url:"/collection/",datatype:"json",data:{collectionId:o}}).done(function(i){if(console.log("[WGST] Got collection "+o+" data"),Object.keys(i).length>0){console.log("[WGST] Collection "+o+" has "+Object.keys(i.collection.assemblies).length+" assemblies"),window.WGST.antibiotics=i.antibiotics,window.WGST.exports.setCollectionData(o,i.collection.assemblies,i.collection.tree);{var a=window.WGST.exports.createCollectionDataPanel(o);$('.wgst-panel[data-panel-id="'+a+'"]')}window.WGST.exports.createFullscreen("collection-map",{fullscreenId:"collection-map",fullscreenType:"collection-map"}),window.WGST.exports.showFullscreen("collection-map"),window.WGST.geo.map.init(),window.WGST.exports.bringPanelToFront(a),window.WGST.exports.renderCollectionTrees(o),window.WGST.exports.renderCollectionTreeButtons(o,a),window.WGST.exports.addResistanceProfileDataToCollection(o),e(o),window.WGST.exports.renderAssemblyAnalysisList(o,a,WGST.antibiotics),window.WGST.exports.showPanel(a),"undefined"!=typeof window.WGST.exports.mapCollectionIdToCollectionName[o]?$(".wgst-header-collection-name").text(window.WGST.exports.mapCollectionIdToCollectionName[o]):$(".wgst-header-collection-name").text(o),Object.keys(window.WGST.collection[o].assemblies).length>100&&(console.log("[WGST] Collection "+o+" will be displayed fullscreen"),t(o)),window.history.replaceState("Object","WGST Collection","/collection/"+o),window.WGST.exports.hideBackground("get-collection")}}).fail(function(e,t,o){console.log("[WGST][ERROR] Failed to get collection id"),console.error(t),console.error(o),console.error(e),showNotification(t)})};window.WGST.exports.addResistanceProfileDataToCollection=function(e){var t,o,i,a,s,n,l={};for(t in WGST.collection[e].assemblies){o=WGST.collection[e].assemblies[t],l=o.PAARSNP_RESULT.paarResult.resistanceProfile,s={};for(i in l){a=l[i];for(n in a)s[n]=a[n]}WGST.collection[e].assemblies[t].PAARSNP_RESULT.paarResult.ungroupedResistanceProfile=s}},window.WGST.exports.renderAssemblyAnalysisList=function(e,t,o){console.log("[WGST] Rendering assembly analysis list");for(var i,a,s,n,l,c,d,r=WGST.collection[e].assemblies,p=WGST.collection[e].sortedAssemblyIds,w=0,m=$('.wgst-panel[data-panel-id="'+t+'"]'),S=m.find(".collection-assembly-list"),T=m.find(".collection-assembly-list-full"),b=document.createDocumentFragment();w<p.length;)i=p[w],a=r[i].PAARSNP_RESULT.paarResult.resistanceProfile,s=window.WGST.exports.createAssemblyResistanceProfilePreviewHtml(a,o),n=window.WGST.exports.calculateAssemblyTopScore(r[i].FP_COMP.scores),WGST.collection[e].assemblies[i].FP_COMP.topScore=n,l=r[i].ASSEMBLY_METADATA.geography.position.latitude,c=r[i].ASSEMBLY_METADATA.geography.position.longitude,d=$((w%2===0?'<div class="row-stripe assembly-list-item" data-assembly-id="'+r[i].FP_COMP.assemblyId+'">':'<div class="assembly-list-item" data-assembly-id="'+r[i].FP_COMP.assemblyId+'">')+'<div class="show-on-map-checkbox assembly-list-header-map"><input type="checkbox" data-reference-id="'+n.referenceId+'" data-assembly-id="'+r[i].FP_COMP.assemblyId+'" data-latitude="'+l+'" data-longitude="'+c+'"></div><div class="assembly-list-header-id"><a href="#" class="open-assembly-button" data-assembly-id="'+r[i].FP_COMP.assemblyId+'" title="'+r[i].ASSEMBLY_METADATA.userAssemblyId+'" data-mixpanel-open-assembly-panel="'+r[i].ASSEMBLY_METADATA.userAssemblyId+'">'+r[i].ASSEMBLY_METADATA.userAssemblyId+'</a></div><div class="assembly-list-header-nearest-representative">'+n.referenceId+" ("+Math.round(100*n.score.toFixed(2))+'%)</div><div class="assembly-list-header-st">'+(0===r[i].MLST_RESULT.stType.length?"Not found":r[i].MLST_RESULT.stType)+'</div><div class="assembly-list-header-resistance-profile"><div class="assembly-resistance-profile-container">'+s+"</div></div></div>"),b.appendChild(d[0]),w+=1;S[0].appendChild(b.cloneNode(!0)),T[0].appendChild(b.cloneNode(!0)),$('.show-on-map-checkbox input[type="checkbox"]').prop("checked",!0).change()},window.WGST.exports.createAssemblyResistanceProfilePreviewHtml=function(e,t){var o,i,a,s,n,l,c,d="";for(i in t)if(t.hasOwnProperty(i)){o=t[i],a='<div class="antibiotic-group" data-antibiotic-group-name="'+i+'">{{antibioticsHtml}}</div>',l="";for(s in o)o.hasOwnProperty(s)&&(n="","undefined"!=typeof e[i]?"undefined"!=typeof e[i][s]?(c=e[i][s].resistanceState,n="RESISTANT"===c?n+'<span class="antibiotic resistance-fail" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>':"SENSITIVE"===c?n+'<span class="antibiotic resistance-success" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>':n+'<span class="antibiotic resistance-unknown" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>'):(n=n+'<span class="antibiotic resistance-unknown" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>',console.warn("[!] Assembly resistatance profile has no antibiotic: "+s)):(n=n+'<span class="antibiotic no-resistance-data" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>',console.warn("[!] Assembly resistatance profile has no antibiotic group: "+i)),l+=n);a=a.replace(/{{antibioticsHtml}}/g,l),d+=a}return d};var t=function(e){console.log("[WGST] Maximizing collection "+e),window.WGST.exports.maximizePanel("collection-data__"+e)}}()});