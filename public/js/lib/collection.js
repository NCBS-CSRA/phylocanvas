$(function(){!function(){window.WGST.exports.mapCollectionIdToCollectionName={"5324c298-4cd0-4329-848b-30d7fe28a560":"EMRSA15","c0ca8c57-11b9-4e27-93a5-6ffe841e7768":"ST239","b8d3aab1-625f-49aa-9857-a5e97f5d6be5":"Reference"},window.WGST.exports.initCollectionDataStructure=function(e,t){WGST.collection[e]={assemblies:{},tree:{}},$.isArray(t)&&t.forEach(function(t){window.WGST.collection[e].tree[t]={}})},window.WGST.exports.setCollectionData=function(e,t,o){window.WGST.exports.initCollectionDataStructure(e),window.WGST.collection[e].assemblies=t,$.each(o,function(t,o){window.WGST.collection[e].tree[t]={type:t,data:o.data,name:o.name}})};var e=function(e){var t=WGST.collection[e].assemblies,o=[],a=[];$.each(window.WGST.collection[e].tree.CORE_TREE_RESULT.leavesOrder,function(e,i){o.push(t[i.id]),a.push(i.id)}),WGST.collection[e].sortedAssemblyIds=a};window.WGST.exports.getCollection=function(o){if(console.log("[WGST] Getting collection "+o),WGST.speak){var a=new SpeechSynthesisUtterance("Loading collection");window.speechSynthesis.speak(a)}$.ajax({type:"POST",url:"/collection/",datatype:"json",data:{collectionId:o}}).done(function(a){if(console.log("[WGST] Got collection "+o+" data"),Object.keys(a).length>0){console.log("[WGST] Collection "+o+" has "+Object.keys(a.collection.assemblies).length+" assemblies"),window.WGST.antibiotics=a.antibiotics,window.WGST.exports.setCollectionData(o,a.collection.assemblies,a.collection.tree);{var i=window.WGST.exports.createCollectionDataPanel(o);$('.wgst-panel[data-panel-id="'+i+'"]')}window.WGST.exports.createFullscreen("collection-map__"+o,{fullscreenType:"collection_map"}),window.WGST.exports.bringPanelToFront(i),window.WGST.exports.renderCollectionTrees(o),window.WGST.exports.renderCollectionTreeButtons(o,i),window.WGST.exports.addResistanceProfileDataToCollection(o),e(o),window.WGST.exports.renderAssemblyAnalysisList(o,i,WGST.antibiotics),window.WGST.exports.showPanel(i),"undefined"!=typeof window.WGST.exports.mapCollectionIdToCollectionName[o]?$(".wgst-header-collection-name").text(window.WGST.exports.mapCollectionIdToCollectionName[o]):$(".wgst-header-collection-name").text(o),Object.keys(window.WGST.collection[o].assemblies).length>100&&(console.log("[WGST] Collection "+o+" will be displayed fullscreen"),t(o)),window.history.replaceState("Object","WGST Collection","/collection/"+o)}}).fail(function(e,t,o){console.log("[WGST][ERROR] Failed to get collection id"),console.error(t),console.error(o),console.error(e),showNotification(t)})};window.WGST.exports.addResistanceProfileDataToCollection=function(e){var t,o,a,i,s,n,l={};for(t in WGST.collection[e].assemblies){o=WGST.collection[e].assemblies[t],l=o.PAARSNP_RESULT.paarResult.resistanceProfile,s={};for(a in l){i=l[a];for(n in i)s[n]=i[n]}WGST.collection[e].assemblies[t].PAARSNP_RESULT.paarResult.ungroupedResistanceProfile=s}},window.WGST.exports.renderAssemblyAnalysisList=function(e,t,o){console.log("[WGST] Rendering assembly analysis list");for(var a,i,s,n,l,c,r,d=WGST.collection[e].assemblies,p=WGST.collection[e].sortedAssemblyIds,b=0,T=$('.wgst-panel[data-panel-id="'+t+'"]'),S=T.find(".collection-assembly-list"),m=T.find(".collection-assembly-list-full"),w=document.createDocumentFragment();b<p.length;)a=p[b],i=d[a].PAARSNP_RESULT.paarResult.resistanceProfile,s=window.WGST.exports.createAssemblyResistanceProfilePreviewHtml(i,o),n=window.WGST.exports.calculateAssemblyTopScore(d[a].FP_COMP.scores),WGST.collection[e].assemblies[a].FP_COMP.topScore=n,l=d[a].ASSEMBLY_METADATA.geography.position.latitude,c=d[a].ASSEMBLY_METADATA.geography.position.longitude,r=$((b%2===0?'<div class="row-stripe assembly-list-item" data-assembly-id="'+d[a].FP_COMP.assemblyId+'">':'<div class="assembly-list-item" data-assembly-id="'+d[a].FP_COMP.assemblyId+'">')+'<div class="show-on-map-checkbox assembly-list-header-map"><input type="checkbox" data-reference-id="'+n.referenceId+'" data-assembly-id="'+d[a].FP_COMP.assemblyId+'" data-latitude="'+l+'" data-longitude="'+c+'"></div><div class="assembly-list-header-id"><a href="#" class="open-assembly-button" data-assembly-id="'+d[a].FP_COMP.assemblyId+'" title="'+d[a].ASSEMBLY_METADATA.userAssemblyId+'" data-mixpanel-open-assembly-panel="'+d[a].ASSEMBLY_METADATA.userAssemblyId+'">'+d[a].ASSEMBLY_METADATA.userAssemblyId+'</a></div><div class="assembly-list-header-nearest-representative">'+n.referenceId+" ("+Math.round(100*n.score.toFixed(2))+'%)</div><div class="assembly-list-header-st">'+(0===d[a].MLST_RESULT.stType.length?"Not found":d[a].MLST_RESULT.stType)+'</div><div class="assembly-list-header-resistance-profile"><div class="assembly-resistance-profile-container">'+s+"</div></div></div>"),w.appendChild(r[0]),b+=1;S[0].appendChild(w.cloneNode(!0)),m[0].appendChild(w.cloneNode(!0)),$('.show-on-map-checkbox input[type="checkbox"]').prop("checked",!0).change()},window.WGST.exports.createAssemblyResistanceProfilePreviewHtml=function(e,t){var o,a,i,s,n,l,c,r="";for(a in t)if(t.hasOwnProperty(a)){o=t[a],i='<div class="antibiotic-group" data-antibiotic-group-name="'+a+'">{{antibioticsHtml}}</div>',l="";for(s in o)o.hasOwnProperty(s)&&(n="","undefined"!=typeof e[a]?"undefined"!=typeof e[a][s]?(c=e[a][s].resistanceState,n="RESISTANT"===c?n+'<span class="antibiotic resistance-fail" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>':"SENSITIVE"===c?n+'<span class="antibiotic resistance-success" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>':n+'<span class="antibiotic resistance-unknown" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>'):(n=n+'<span class="antibiotic resistance-unknown" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>',console.warn("[!] Assembly resistatance profile has no antibiotic: "+s)):(n=n+'<span class="antibiotic no-resistance-data" data-antibiotic-name="'+s+'" data-antibiotic-resistance-state="'+c+'" data-toggle="tooltip" data-placement="top" title="'+s+'"></span>',console.warn("[!] Assembly resistatance profile has no antibiotic group: "+a)),l+=n);i=i.replace(/{{antibioticsHtml}}/g,l),r+=i}return r};var t=function(e){console.log("[WGST] Maximizing collection "+e);var t=$(".wgst-fullscreen").attr("data-fullscreen-id"),o=t;console.debug("fullscreenId: "+t),console.debug("panelId: "+o),window.WGST.exports.bringFullscreenToPanel(t);var o="collection-data__"+e,t="collection-data";window.WGST.exports.bringPanelToFullscreen(o),google.maps.event.trigger(window.WGST.geo.map.canvas,"resize")}}()});