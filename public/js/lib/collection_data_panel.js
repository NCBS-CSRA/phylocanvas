$(function(){!function(){window.WGST.exports.createCollectionDataPanel=function(e){var t="collection-data__"+e,o="collection-data",a={collectionId:e,panelId:t,panelType:o};return window.WGST.exports.createPanel(o,a),t};$("body").on("change",".wgst-assembly-show-on-map",function(){var e,t=($(this).attr("data-assembly-id"),$(this).closest("[data-wgst-collection-data]").attr("data-collection-id")),o=$(this).closest(".wgst-collection-data-assemblies").find(".wgst-assembly-show-on-map:checked"),a=[];o.each(function(){e=$(this).attr("data-assembly-id"),a.push(e)}),console.debug(">>> }}} A"),console.dir(a),window.WGST.exports.triggerMapMarkers(t,a),"map"!==$(".wgst-fullscreen--active").attr("data-fullscreen-name")&&($(".wgst-panel__map").hasClass("wgst-panel--active")||window.WGST.exports.showPanel("map")),0===$(this).closest(".wgst-collection-data-assemblies").find('input[type="checkbox"]:not(:checked)').length?$(".wgst-assembly-show-all-on-map").prop("checked",!0):$(".wgst-assembly-show-all-on-map").prop("checked",!1)}),$("body").on("click",".open-assembly-button",function(e){var t=$(this).attr("data-assembly-id");window.WGST.exports.getAssembly(t),e.preventDefault()}),$("body").on("click",".wgst-collection-control__show-tree",function(){var e=$(this).attr("data-collection-id"),t=$(this).attr("data-tree-type"),o="collection-tree__"+e+"__"+t;window.WGST.exports.showPanel(o),window.WGST.exports.bringPanelToFront(o)}),$(".wgst-panel__collection").on("click",".wgst-collection-control__show-data-table",function(){var e=$(this).attr("data-collection-id"),t=WGST.collection[e].assemblies,o=Object.keys(t);$.ajax({type:"POST",url:"/api/assembly/table-data",datatype:"json",data:{assemblyIds:o}}).done(function(e){console.log("[WGST] Got assembly table data"),console.dir(e)})}),window.WGST.exports.renderCollectionTreeButtons=function(t,o){var a=WGST.collection[t].tree;$.each(a,function(a){"COLLECTION_TREE"===a&&e(t,o,a)})};var e=function(e,t,o){var a=WGST.collection[e].tree[o],l=(a.name,{collectionTreeType:o,collectionId:e,collectionTreeName:"Tree"}),n=$('.wgst-template[data-template-id="panel-body__collection-data__tree-button"]').html(),s=Handlebars.compile(n),c=s(l);$('.wgst-panel[data-panel-id="'+t+'"]').find(".wgst-collection-controls__show-tree .btn-group").prepend(c)};window.WGST.exports.renderCollectionTrees=function(e,o){var a=window.WGST.collection[e].tree;console.dir(window.WGST.collection[e]),$.each(a,function(a){t(e,a,o)})};var t=function(e,t,a){console.log("[WGST] Rendering "+e+" collection "+t+" tree");var l="collection-tree__"+e+"__"+t,n=window.WGST.collection[e].tree[t].name.capitalize(),s="phylocanvas__"+e+"__"+t,c="collection-tree",i={panelId:l,panelType:c,collectionId:e,collectionTreeType:t,collectionTreeTitle:n,phylocanvasId:s,invisibleThis:!0,dataAttributes:[{name:"data-collection-tree-type",value:t}]};"undefined"!=typeof a&&$.extend(i,a),e===window.WGST.config.referenceCollectionId&&(i.mergeWithButton=!0),window.WGST.exports.createPanel(c,i);var r,d=window.WGST.collection[e].tree[t],p=window.WGST.collection[e].assemblies;d.canvas=new PhyloCanvas.Tree($('[data-phylocanvas-id="'+s+'"]')[0],{history_collapsed:!0}),d.canvas.parseNwk(d.data),d.canvas.treeType="rectangular";var w=d.canvas;w.on("selected",function(t){var a=t.nodeIds;"string"==typeof a&&(a=[a]),o(e,a)});for(r in p)p.hasOwnProperty(r)&&w.branches[r].leaf&&(w.branches[r].label=p[r].ASSEMBLY_METADATA.userAssemblyId);w.resizeToContainer(),w.drawn=!1,w.draw();var m=w.leaves;m.sort(function(e,t){return e.centery-t.centery}),d.leavesOrder=m;var b=d.data;for(r in p)p.hasOwnProperty(r)&&(b=b.replace(r,p[r].ASSEMBLY_METADATA.userAssemblyId));console.debug("» [WGST][DEV] Parsed Newick String:"),console.log("» Uncomment to see."),window.WGST.collection[e].tree[t].newickStringWithLabels=b,$collectionTreePanel=$('.wgst-panel[data-panel-id="'+l+'"]'),window.WGST.exports.populateListOfAntibiotics($collectionTreePanel.find(".wgst-tree-control__change-node-colour")),w.resizeToContainer(),w.drawn=!1,w.draw()},o=function(e,t){var o=WGST.collection[e].assemblies;$('.collection-assembly-list .assembly-list-item [type="radio"]').prop("checked",!1),$.each(o,function(e){-1!==$.inArray(e,t)?($('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"]').addClass("row-selected"),$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"] [type="checkbox"]').prop("checked",!0)):($('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"]').removeClass("row-selected"),$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"] [type="checkbox"]').prop("checked",!1))}),window.WGST.exports.triggerMapMarkers(e,t),1===t.length&&$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+t+'"] [type="radio"]').prop("checked",!0)};$("body").on("change",".wgst-assembly-show-all-on-map",function(){var e=$(this).closest("[data-wgst-collection-data]").find(".wgst-collection-data-assemblies .wgst-assembly-show-on-map");$(this).prop("checked")?(console.log("X1"),e.prop("checked",!0).trigger("change")):(console.log("X2"),e.prop("checked",!1).trigger("change"))})}()});