$(function(){!function(){window.WGST.exports.createCollectionDataPanel=function(e){var t="collection-data__"+e,o="collection-data",l={collectionId:e,panelId:t,panelType:o};return window.WGST.exports.createPanel(o,l),t};$("body").on("change",".wgst-assembly-show-on-map",function(){var e,t=($(this).attr("data-assembly-id"),$(this).closest(".wgst-collection").attr("data-collection-id")),o=$(this).closest(".wgst-collection-assemblies-list").find(".wgst-assembly-show-on-map:checked"),l=[];o.each(function(){e=$(this).attr("data-assembly-id"),l.push(e)}),console.debug(">>> }}} A"),console.dir(l),window.WGST.exports.triggerMapMarkers(t,l),"map"!==$(".wgst-fullscreen--active").attr("data-fullscreen-name")&&($(".wgst-panel__map").hasClass("wgst-panel--active")||window.WGST.exports.showPanel("map")),0===$(this).closest(".wgst-collection-assemblies-list").find('input[type="checkbox"]:not(:checked)').length?$(".wgst-assembly-show-all-on-map").prop("checked",!0):$(".wgst-assembly-show-all-on-map").prop("checked",!1)}),$(".wgst-panel__collection, .wgst-fullscreen__collection").on("click",".show-on-representative-tree",function(e){return!1}),$("body").on("click",".open-assembly-button",function(e){var t=$(this).attr("data-assembly-id");window.WGST.exports.getAssembly(t),e.preventDefault()}),$("body").on("click",".wgst-collection-control__show-tree",function(){var e=$(this).attr("data-collection-id"),t=$(this).attr("data-tree-type"),o="collection-tree__"+e+"__"+t;window.WGST.exports.showPanel(o),window.WGST.exports.bringPanelToFront(o)}),$(".wgst-panel__collection").on("click",".wgst-collection-control__show-data-table",function(){var e=$(this).attr("data-collection-id"),t=WGST.collection[e].assemblies,o=Object.keys(t);$.ajax({type:"POST",url:"/api/assembly/table-data",datatype:"json",data:{assemblyIds:o}}).done(function(e){console.log("[WGST] Got assembly table data"),console.dir(e)})}),window.WGST.exports.renderCollectionTreeButtons=function(t,o){var l=WGST.collection[t].tree;$.each(l,function(l){"COLLECTION_TREE"===l&&e(t,o,l)})};var e=function(e,t,o){var l=WGST.collection[e].tree[o],n=(l.name,{collectionTreeType:o,collectionId:e,collectionTreeName:"Tree"}),a=$('.wgst-template[data-template-id="panel-body__collection-data__tree-button"]').html(),s=Handlebars.compile(a),c=s(n);$('.wgst-panel[data-panel-id="'+t+'"]').find(".wgst-collection-controls__show-tree .btn-group").prepend(c)};window.WGST.exports.renderCollectionTrees=function(e,o){var l=window.WGST.collection[e].tree;console.dir(window.WGST.collection[e]),$.each(l,function(l){t(e,l,o)})};var t=function(e,t,l){console.log("[WGST] Rendering "+e+" collection "+t+" tree");var n="collection-tree__"+e+"__"+t,a=window.WGST.collection[e].tree[t].name.capitalize(),s="phylocanvas__"+e+"__"+t,c="collection-tree",i={panelId:n,panelType:c,collectionId:e,collectionTreeType:t,collectionTreeTitle:a,phylocanvasId:s,invisibleThis:!0,dataAttributes:[{name:"data-collection-tree-type",value:t}]};"undefined"!=typeof l&&$.extend(i,l),e===window.WGST.config.referenceCollectionId&&(i.mergeWithButton=!0),window.WGST.exports.createPanel(c,i);var r,d=window.WGST.collection[e].tree[t],p=window.WGST.collection[e].assemblies;d.canvas=new PhyloCanvas.Tree($('[data-phylocanvas-id="'+s+'"]')[0],{history_collapsed:!0}),d.canvas.parseNwk(d.data),d.canvas.treeType="rectangular";var w=d.canvas;w.on("selected",function(t){var l=t.nodeIds;"string"==typeof l&&(l=[l]),o(e,l)});for(r in p)p.hasOwnProperty(r)&&w.branches[r].leaf&&(w.branches[r].label=p[r].ASSEMBLY_METADATA.userAssemblyId);w.resizeToContainer(),w.drawn=!1,w.draw();var m=w.leaves;m.sort(function(e,t){return e.centery-t.centery}),d.leavesOrder=m;var b=d.data;for(r in p)p.hasOwnProperty(r)&&(b=b.replace(r,p[r].ASSEMBLY_METADATA.userAssemblyId));console.debug("» [WGST][DEV] Parsed Newick String:"),console.log("» Uncomment to see."),window.WGST.collection[e].tree[t].newickStringWithLabels=b,$collectionTreePanel=$('.wgst-panel[data-panel-id="'+n+'"]'),window.WGST.exports.populateListOfAntibiotics($collectionTreePanel.find(".wgst-tree-control__change-node-colour")),w.resizeToContainer(),w.drawn=!1,w.draw()},o=function(e,t){var o=WGST.collection[e].assemblies;$('.collection-assembly-list .assembly-list-item [type="radio"]').prop("checked",!1),$.each(o,function(e){-1!==$.inArray(e,t)?($('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"]').addClass("row-selected"),$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"] [type="checkbox"]').prop("checked",!0)):($('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"]').removeClass("row-selected"),$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+e+'"] [type="checkbox"]').prop("checked",!1))}),window.WGST.exports.triggerMapMarkers(e,t),1===t.length&&$('.collection-assembly-list .assembly-list-item[data-assembly-id="'+t+'"] [type="radio"]').prop("checked",!0)};$("body").on("change",".wgst-assembly-show-all-on-map",function(){var e=$(this).closest(".wgst-collection-assemblies").find(".wgst-collection-assemblies-list .wgst-assembly-show-on-map");$(this).prop("checked")?(console.log("X1"),e.prop("checked",!0).trigger("change")):(console.log("X2"),e.prop("checked",!1).trigger("change"))})}()});