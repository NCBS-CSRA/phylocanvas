!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.PhyloCanvas=e():t.PhyloCanvas=e()}(this,function(){return function(t){function e(i){if(s[i])return s[i].exports;var a=s[i]={exports:{},id:i,loaded:!1};return t[i].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var s={};return e.m=t,e.c=s,e.p="/dist/",e(0)}([function(t,e,s){"use strict";function i(t){this.tree=t,this.injectCss(),this.div=this.createDiv(t.canvasEl),this.resizeTree(t),this.tree.addListener("subtree",function(t){this.addSnapshot(t.node)}.bind(this)),this.tree.addListener("loaded",this.reset.bind(this)),this.tree.addListener("typechanged",function(){this.addSnapshot(this.tree.root.id)}.bind(this)),t.historyCollapsed&&this.collapse()}var a=s(2).addClass,n=s(2).hasClass,r=s(2).removeClass,o=s(13).fireEvent,h=s(13).addEvent,l=s(13).killEvent,c=s(3);i.prototype.reset=function(){this.clear(),this.tree.drawn&&this.addSnapshot(this.tree.root.id)},i.prototype.collapse=function(){a(this.div,"collapsed"),this.toggleDiv.firstChild.data=">",this.resizeTree()},i.prototype.expand=function(){r(this.div,"collapsed"),this.toggleDiv.firstChild.data="<",this.resizeTree()},i.prototype.isCollapsed=function(){return n(this.div,"collapsed")},i.prototype.toggle=function(){this.isCollapsed()?this.expand():this.collapse(),o(this.tree.canvasEl,"historytoggle",{isOpen:!this.isCollapsed()})},i.prototype.createDiv=function(t){var e=document.createElement("div");e.className="pc-history",h(e,"click",l),h(e,"contextmenu",l);var s=document.createElement("div");s.innerHTML="History",s.className="pc-history-title",e.appendChild(s);var i=document.createElement("div");i.appendChild(document.createTextNode("<")),i.className="toggle",h(i,"click",this.toggle.bind(this)),e.appendChild(i),this.toggleDiv=i;var a=document.createElement("ul");return a.className="pc-history-snapshots",e.appendChild(a),this.snapshotList=a,t.appendChild(e),e},i.prototype.resizeTree=function(){var t=this.tree;this.width=this.div.offsetWidth,t.setSize(t.canvasEl.offsetWidth-this.width,t.canvasEl.offsetHeight),this.isCollapsed()?t.canvasEl.getElementsByTagName("canvas")[0].style.marginLeft=this.width+"px":t.canvasEl.getElementsByTagName("canvas")[0].style.marginLeft="20%"},i.prototype.addSnapshot=function(t){var e="phylocanvas-history-",s=this.tree.treeType,i=!1;if(this.tree.historySnapshots.forEach(function(a){a.getAttribute("data-tree-type");a.style.background="transparent",a.id==e+t&&a.getAttribute("data-tree-type")==s&&(i=!0,a.style.background="lightblue")}),!i){var a=this.tree.getPngUrl(),n=document.createElement("li"),r=document.createElement("img");r.width=this.width,r.src=a,r.id=e+t,r.setAttribute("data-tree-type",this.tree.treeType),r.style.background="lightblue",this.tree.historySnapshots.push(r),n.appendChild(r),this.snapshotList.appendChild(n),h(r,"click",this.goBackTo.bind(this))}},i.prototype.clear=function(){for(var t=this.snapshotList.getElementsByTagName("li"),e=t.length;e--;)this.snapshotList.removeChild(t[0])},i.prototype.goBackTo=function(t){var e=t.target;this.tree.treeType=e.getAttribute("data-tree-type"),this.tree.redrawFromBranch(this.tree.origBranches[e.id.replace("phylocanvas-history-","")])},i.prototype.injectCss=function(){var t=".pc-history { position: absolute; top: 0; bottom: 0; left: 0; box-sizing: border-box; width: 20%; overflow: hidden; background: #EEE }.pc-history .pc-history-title { box-sizing: border-box; height: 20px; text-align: center; font-size: 13px; color: #666; padding: 2px; border-bottom: 1px solid #bbb }.pc-history .toggle { position: absolute; top: 0; right: 0; padding: 2px 8px; cursor: pointer; border-top-left-radius: 50%; border-bottom-left-radius: 50%; background-color: #666; color: #FFF; box-sizing: border-box; height: 20px; }.pc-history.collapsed .toggle { border-radius: 0 50% 50% 0 }.pc-history .toggle:hover { background-color: #FFF; color: #CCC }.pc-history.collapsed { width: 25px }.pc-history.collapsed .pc-history-snapshots { display: none }.pc-history.collapsed .pc-history-title { writing-mode: tb-rl; -webkit-transform: rotate(270deg); -moz-transform: rotate(270deg); -o-transform: rotate(270deg); -ms-transform: rotate(270deg); transform: rotate(270deg); margin-top: 70px; background: 0 0; color: #666; letter-spacing: 1.2px; border-bottom: none }.pc-history-snapshots { position: absolute; top: 20px; bottom: 0; margin: 0; padding: 0; overflow-x: hidden; overflow-y: scroll; }.pc-history-snapshots li { list-style: outside none none }.pc-history img { border: 0px solid #CCC; border-top-width: 1px; cursor: pointer; width: 100%; box-sizing: border-box; transition: background-color .25s ease; display: block }.pc-history img:hover { background-color: #fff }",e=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",s.styleSheet?s.styleSheet.cssText=t:s.appendChild(document.createTextNode(t)),e.appendChild(s)},c.prototype.initialiseHistory=function(t){var e;(t.history||"undefined"==typeof t.history)&&(e=t.history&&"undefined"!=typeof t.history.collapsed,this.historyCollapsed=e?t.history.collapsed:!0,this.historySnapshots=[],this.history=new i(this))},t.exports={Tree:c,Branch:s(4),Loader:s(5),ContextMenu:s(6),History:i}},function(t,e,s){"use strict";var i=s(21);t.exports={rectangular:new i(s(22)),circular:new i(s(23)),radial:new i(s(20)),diagonal:new i(s(24)),hierarchical:new i(s(25))}},function(t,e,s){"use strict";function i(t,e){var s=new Blob([t],{type:"text/csv;charset=utf-8"}),i=window.URL||window.webkitURL,a=document.createElement("a"),n="undefined"!=typeof a.download;a.href=i.createObjectURL(s),a.target="_blank",n&&(a.download=e?e:"pc-download.txt"),l(a,"click")}function a(t){for(var e=0;null!=t;)e+=t.offsetLeft,t=t.offsetParent;return e}function n(t){for(var e=0;t;)e+=t.offsetTop,t=t.offsetParent;return e}function r(t,e){var s=t.className.split(" ");-1===s.indexOf(e)&&(s.push(e),t.className=s.join(" "))}function o(t,e){var s=t.className.split(" "),i=s.indexOf(e);-1!==i&&(s.splice(i,1),t.className=s.join(" "))}function h(t,e){var s=t.className.split(" "),i=s.indexOf(e);return-1!==i}var l=s(13).fireEvent;t.exports.setupDownloadLink=i,t.exports.getX=a,t.exports.getY=n,t.exports.addClass=r,t.exports.removeClass=o,t.exports.hasClass=h},function(t,e,s){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function a(t){var e=void 0===arguments[1]?{}:arguments[1];this.canvasEl="string"==typeof t?document.getElementById(t):t,v.addClass(this.canvasEl,"pc-container"),this.branches={},this.leaves=[],this.root=!1,this.lastId=0,this.backColour=!1,this.origBL={},this.origP={},"static"===window.getComputedStyle(this.canvasEl).position&&(this.canvasEl.style.position="relative"),this.canvasEl.style.boxSizing="border-box";var s=document.createElement("canvas");s.id=t.id+"pCanvas",s.className="phylocanvas",s.style.position="relative",s.style.backgroundColor="#FFFFFF",s.height=t.clientHeight||400,s.width=t.clientWidth||400,s.style.zIndex="1",this.canvasEl.appendChild(s),this.contextMenu=new h["default"](this,e.contextMenu),this.defaultCollapsedOptions={},this.defaultCollapsed=!1,void 0!==e.defaultCollapsed&&e.defaultCollapsed.min&&e.defaultCollapsed.max&&(this.defaultCollapsedOptions=e.defaultCollapsed,this.defaultCollapsed=!0),this.tooltip=new c["default"](this),this.drawn=!1,this.selectedNodes=[],this.zoom=1,this.pickedup=!1,this.dragging=!1,this.startx=null,this.starty=null,this.pickedup=!1,this.baseNodeSize=1,this.curx=null,this.cury=null,this.origx=null,this.origy=null,this.canvas=s.getContext("2d"),this.canvas.canvas.onselectstart=function(){return!1},this.canvas.fillStyle="#000000",this.canvas.strokeStyle="#000000",this.canvas.save(),this.offsetx=this.canvas.canvas.width/2,this.offsety=this.canvas.canvas.height/2,this.selectedColour="rgba(49,151,245,1)",this.highlightColour="rgba(49,151,245,1)",this.highlightWidth=5,this.selectedNodeSizeIncrease=0,this.branchColour="rgba(0,0,0,1)",this.branchScalar=1,this.hoverLabel=!1,this.internalNodesSelectable=!0,this.showLabels=!0,this.showBootstraps=!1,this.treeType="radial",this.maxBranchLength=0,this.lineWidth=1,this.textSize=7,this.font="sans-serif",this.unselectOnClickAway=!0,this.rightClickZoom=!0,this.useNavigator&&(this.navigator=new p["default"](this)),this.adjustForPixelRatio(),this.initialiseHistory(e),this.addListener("contextmenu",this.clicked.bind(this)),this.addListener("click",this.clicked.bind(this)),this.addListener("mousedown",this.pickup.bind(this)),this.addListener("mouseup",this.drop.bind(this)),this.addListener("mouseout",this.drop.bind(this)),g.addEvent(this.canvas.canvas,"mousemove",this.drag.bind(this)),g.addEvent(this.canvas.canvas,"mousewheel",this.scroll.bind(this)),g.addEvent(this.canvas.canvas,"DOMMouseScroll",this.scroll.bind(this)),g.addEvent(window,"resize",function(){this.resizeToContainer()}.bind(this)),this.addListener("loaded",function(){this.origBranches=this.branches,this.origLeaves=this.leaves,this.origRoot=this.root}.bind(this)),this.nodeAlign=!1,this.farthestNodeFromRootX=0,this.farthestNodeFromRootY=0,this.showMetadata=!1,this.selectedMetadataColumns=[],this.colour1="rgba(206,16,16,1)",this.colour0="#ccc",this.maxLabelLength={},this.metadataXStep=15,this.metadataHeadingDrawn=!1}var n=s(4),r=i(n),o=s(6),h=i(o),l=s(7),c=i(l),d=s(8),p=i(d),u=s(9),v=s(2),g=s(13),f=s(10);a.prototype.branchRenderers=s(11),a.prototype.nodeRenderers=s(12),a.prototype.AJAX=function(t,e,s,i,a,n,r){var o;o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?i(o,a,n):r&&r(o,a,n))},o.open(e,t,!0),"GET"===e?o.send():o.send(s)},a.prototype.setInitialCollapsedBranches=function(){var t,e,s=void 0===arguments[0]?this.root:arguments[0];if(t=s.getChildIds(),t&&t.length>this.defaultCollapsedOptions.min&&t.length<this.defaultCollapsedOptions.max)return void(s.collapsed=!0);for(e=0;e<s.children.length;e++)this.setInitialCollapsedBranches(s.children[e])},a.prototype.clicked=function(t){var e,s;if(0===t.button){if(s=[],this.dragging)return void(this.dragging=!1);if(!this.root)return!1;e=this.root.clicked(this.translateClickX(t.clientX),this.translateClickY(t.clientY)),e?(this.root.setSelected(!1,!0),(this.internalNodesSelectable||e.leaf)&&(e.setSelected(!0,!0),s=e.getChildIds()),this.draw()):this.unselectOnClickAway&&this.contextMenu.closed&&!this.dragging&&(this.root.setSelected(!1,!0),this.draw()),this.pickedup||(this.dragging=!1),this.nodesSelected(s)}else 2===t.button&&(t.preventDefault(),e=this.root.clicked(this.translateClickX(t.clientX),this.translateClickY(t.clientY)),this.contextMenu.open(t.clientX,t.clientY,e),this.contextMenu.closed=!1,this.tooltip.close())},a.prototype.dblclicked=function(t){if(!this.root)return!1;var e=this.root.clicked(this.translateClickX(1*t.clientX),this.translateClickY(1*t.clientY));e&&(e.setSelected(!1,!0),e.toggleCollapsed()),this.pickedup||(this.dragging=!1),this.draw()},a.prototype.displayLabels=function(){this.showLabels=!0,this.draw()},a.prototype.drag=function(t){var e=(window.devicePixelRatio||1)/f.getBackingStorePixelRatio(this.canvas);if(!this.drawn)return!1;if(this.pickedup){var s=(t.clientX-this.startx)*e,i=(t.clientY-this.starty)*e;Math.abs(s)+Math.abs(i)>5&&(this.dragging=!0,this.offsetx=this.origx+s,this.offsety=this.origy+i,this.draw())}else if(this.zoomPickedUp)this.d=(this.starty-t.clientY)/100,this.setZoom(this.origZoom+this.d),this.draw();else{var a=t,n=this.root.clicked(this.translateClickX(1*a.clientX),this.translateClickY(1*a.clientY));n&&(this.internalNodesSelectable||n.leaf)?(this.root.setHighlighted(!1),n.setHighlighted(!0),n.leaf||n.isCollapsed()||!this.contextMenu.closed||this.tooltip.open(a.clientX,a.clientY,n)):(this.tooltip.close(),this.contextMenu.close(),this.root.setHighlighted(!1)),this.draw()}},a.prototype.draw=function(t){return this.selectedNodes=[],0===this.maxBranchLength?void this.loadError("All branches in the tree are identical."):(this.canvas.restore(),this.canvas.clearRect(0,0,this.canvas.canvas.width,this.canvas.canvas.height),this.canvas.lineCap="round",this.canvas.lineJoin="round",this.canvas.strokeStyle=this.branchColour,this.canvas.save(),this.canvas.translate(this.canvas.canvas.width/2/f.getBackingStorePixelRatio(this.canvas),this.canvas.canvas.height/2/f.getBackingStorePixelRatio(this.canvas)),(!this.drawn||t)&&(this.prerenderers[this.treeType].run(this),t||this.fitInPanel()),this.canvas.lineWidth=this.lineWidth/this.zoom,this.canvas.translate(this.offsetx,this.offsety),this.canvas.scale(this.zoom,this.zoom),this.branchRenderers[this.treeType].render(this,this.root),this.defaultCollapsed=!1,this.metadataHeadingDrawn=!1,void(this.drawn=!0))},a.prototype.drop=function(){return this.drawn?(this.pickedup=!1,void(this.zoomPickedUp=!1)):!1},a.prototype.findBranch=function(t){this.root.setSelected(!1,!0);for(var e=0;e<this.leaves.length;e++)this.leaves[e].id.match(new RegExp(t,"i"))&&this.leaves[e].setSelected(!0,!0);this.draw()},a.prototype.clearSelect=function(){this.root.setSelected(!1,!0),this.draw()},a.prototype.genId=function(){return"pcn"+this.lastId++},a.prototype.getPngUrl=function(){return this.canvas.canvas.toDataURL()},a.prototype.hideLabels=function(){this.showLabels=!1,this.draw()},a.prototype.dangerouslySetData=function(t){this.parseNwk(t,null),this.draw(),this.loadCompleted()},a.prototype.load=function(t,e,s){s?s.match(/nexus/i)?t.match(/\.\w+$/)?this.AJAX(t,"GET","",this.loadFileCallback,{format:"nexus",name:e},this):this.parseNexus(t,e):s.match(/newick/i)&&(t.match(/\.\w+$/)?this.AJAX(t,"GET","",this.loadFileCallback,{format:"newick"},this):this.parseNwk(t,e)):t.match(/\.n(ex|xs)$/)?this.AJAX(t,"GET","",this.loadFileCallback,{format:"nexus",name:e},this):t.match(/\.nwk$/)?this.AJAX(t,"GET","",this.loadFileCallback,{format:"newick"},this):t.match(/^#NEXUS[\s\n;\w\W\.\*\:(\),-=\[\]\/&]+$/i)?(this.parseNexus(t,e),this.draw(),this.loadCompleted()):t.match(/^[\w\W\.\*\:(\),-\/]+;\s?$/gi)?(this.parseNwk(t,e),this.draw(),this.loadCompleted()):this.loadError("PhyloCanvas did not recognise the string as a file or a newick or Nexus format string")},a.prototype.loadFileCallback=function(t,e,s){if(e.format.match(/nexus/i))s.parseNexus(t.responseText,e.name);else{if(!e.format.match(/newick/i))throw new Error("file type not recognised by PhyloCanvas");s.parseNwk(t.responseText)}s.draw(),s.loadCompleted()},a.prototype.parseNexus=function(t,e){if(!t.match(/BEGIN TREES/gi))throw"The nexus file does not contain a tree block";var s=t.match(/BEGIN TREES;[\S\s]+END;/i)[0].replace(/BEGIN TREES;\n/i,"").replace(/END;/i,""),i={},a=s.match(/TRANSLATE[^;]+;/i);if(a&&a.length){a=a[0],s=s.replace(a,""),a=a.replace(/translate|;/gi,"");for(var n,r=a.split(","),o=0;o<r.length;o++)n=r[o].trim().replace("\n","").split(" "),n[0]&&n[1]&&(i[n[0].trim()]=n[1].trim())}for(var h=s.split("\n"),l={},o=0;o<h.length;o++)if(""!==h[o].trim()){var c=h[o].replace(/tree\s/i,"");e||(e=c.trim().match(/^\w+/)[0]),l[e]=c.trim().match(/[\S]*$/)[0]}if(!l[e])throw"tree "+e+" does not exist in this NEXUS file";if(this.parseNwk(l[e].trim()),i)for(var d in i){var p=this.branches[d];delete this.branches[d],p.id=i[d],this.branches[p.id]=p}},a.prototype.parseNwk=function(t){this.origBranches=!1,this.origLeaves=!1,this.origRoot=!1,this.origBL={},this.origP={},this.root=!1,this.leaves=[],this.branches={},this.drawn=!1;var e=new r["default"];e.id="root",this.branches.root=e,this.setRoot(e);for(var s=0;s<t.length;s++){var i;switch(t[s]){case"(":i=new r["default"],e.addChild(i),e=i;break;case")":e=e.parent;break;case",":i=new r["default"],e.parent.addChild(i),e=i;break;case";":for(var a=0;a<this.leaves.length;a++)this.leaves[a].totalBranchLength>this.maxBranchLength&&(this.maxBranchLength=this.leaves[a].totalBranchLength);break;default:try{s=e.parseNwk(t,s),s--}catch(n){return void this.loadError("Error parsing nwk file"+n)}}}return this.saveNode(this.root),this.root.saveChildren(),this.root.branchLength=0,this.maxBranchLength=0,this.root.setTotalLength(),0===this.maxBranchLength?void this.loadError("All branches in the tree are identical."):(this.buildLeaves(),this.setInitialCollapsedBranches(),void this.loadCompleted())},a.prototype.pickup=function(t){return this.drawn?(this.origx=this.offsetx,this.origy=this.offsety,0===t.button&&(this.pickedup=!0),2===t.button&&this.rightClickZoom&&(this.zoomPickedUp=!0,this.origZoom=Math.log(this.zoom)/Math.log(10),this.oz=this.zoom),this.startx=t.clientX,void(this.starty=t.clientY)):!1},a.prototype.prerenderers=s(1),a.prototype.redrawGetNodes=function(t,e){for(var s=0;s<t.children.length;s++)this.branches[t.children[s].id]=t.children[s],t.children[s].leaf?(e.push(t.children[s].id),this.leaves.push(t.children[s])):this.redrawGetNodes(t.children[s],e)},a.prototype.redrawFromBranch=function(t){this.drawn=!1,this.totalBranchLength=0,this.resetTree(),this.origBL[t.id]=t.branchLength,this.origP[t.id]=t.parent,this.root=t,this.root.branchLength=0,this.root.parent=!1,this.branches={},this.leaves=[];for(var e=[],s=0;s<this.root.children.length;s++)this.branches[this.root.children[s].id]=this.root.children[s],this.root.children[s].leaf?(this.leaves.push(this.root.children[s]),e.push(this.root.children[s].id)):this.redrawGetNodes(this.root.children[s],e);this.root.setTotalLength(),this.prerenderers[this.treeType].run(this),this.draw(),this.subtreeDrawn(t.id)},a.prototype.redrawOriginalTree=function(){this.drawn=!1,this.resetTree(),this.root.setTotalLength(),this.prerenderers[this.treeType].run(this),this.draw(),this.subtreeDrawn(this.root.id)},a.prototype.saveNode=function(t){if(t.id&&""!==t.id||(t.id=t.tree.genId()),this.branches[t.id]&&t!==this.branches[t.id]){if(this.leaf)throw new Error("Two nodes on this tree share the id "+t.id);t.id=this.genId()}this.branches[t.id]=t},a.prototype.scroll=function(t){var e=Math.log(this.zoom)/Math.log(10);this.setZoom(e+(t.detail<0||t.wheelDelta>0?.12:-.12)),t.preventDefault()},a.prototype.selectNodes=function(t){var e,s,i,a=t;if(this.root){this.root.setSelected(!1,!0),"string"==typeof t&&(a=a.split(","));for(s in this.branches)if(this.branches.hasOwnProperty(s))for(e=this.branches[s],i=0;i<a.length;i++)a[i]===e.id&&e.setSelected(!0,!0);this.draw()}},a.prototype.setFont=function(t){isNaN(t)&&(this.font=t,this.draw())},a.prototype.setNodeColourAndShape=function(t,e,s,i,a){if(t)if(this.drawn){var n=[];if(n="string"==typeof t?t.split(","):t,""!==t){for(var r=0;r<n.length;r++)this.branches[n[r]]&&(e&&(this.branches[n[r]].colour=e),s&&(this.branches[n[r]].nodeShape=u.Shapes[s]?u.Shapes[s]:s),i&&(this.branches[n[r]].radius=i));this.draw()}}else if(!a)var o=this,h=setInterval(function(){this.drawn&&(o.setNodeColourAndShape(t,e,s,i,!0),clearInterval(h))})},a.prototype.setNodeSize=function(t){this.baseNodeSize=Number(t),this.draw()},a.prototype.setRoot=function(t){t.canvas=this.canvas,t.tree=this,this.root=t},a.prototype.setTextSize=function(t){this.textSize=Number(t),this.draw()},a.prototype.setFontSize=function(t){"circular"===this.treeType?this.textSize=Math.min(100*t+5,40):"radial"===this.treeType?this.textSize=Math.min(50*t+5,20):"diagonal"===this.treeType?this.textSize=Math.min(t/2,10):this.textSize=Math.min(t/2,15),this.canvas.font=this.textSize+"pt "+this.font},a.prototype.setTreeType=function(t){var e=this.treeType;this.treeType=t,this.drawn&&(this.drawn=!1,this.draw()),this.treeTypeChanged(e,t)},a.prototype.setSize=function(t,e){this.canvas.canvas.width=t,this.canvas.canvas.height=e,this.navigator&&this.navigator.resize(),this.adjustForPixelRatio(),this.drawn&&this.draw()},a.prototype.setZoom=function(t){if(t>-2&&2>t){var e=this.zoom;this.zoom=Math.pow(10,t),this.offsetx=this.offsetx/e*this.zoom,this.offsety=this.offsety/e*this.zoom,this.draw()}},a.prototype.toggleLabels=function(){this.showLabels=!this.showLabels,this.draw()},a.prototype.translateClickX=function(t){var e=(window.devicePixelRatio||1)/f.getBackingStorePixelRatio(this.canvas);return t=t-v.getX(this.canvas.canvas)+window.pageXOffset,t*=e,t-=this.canvas.canvas.width/2,t-=this.offsetx,t/=this.zoom},a.prototype.translateClickY=function(t){var e=(window.devicePixelRatio||1)/f.getBackingStorePixelRatio(this.canvas);return t=t-v.getY(this.canvas.canvas)+window.pageYOffset,t*=e,t-=this.canvas.canvas.height/2,t-=this.offsety,t/=this.zoom},a.prototype.viewMetadataColumns=function(t){this.showMetadata=!0,void 0===t&&(t=this.getMetadataColumnHeadings()),void 0!==t&&(this.selectedMetadataColumns=t),this.fitInPanel(),this.draw()},a.prototype.getMetadataColumnHeadings=function(){for(var t=[],e=0;e<this.leaves.length;e++)if(Object.keys(this.leaves[e].data).length>0){t=Object.keys(this.leaves[e].data);break}return t},a.prototype.clearMetadata=function(){for(var t=0;t<this.leaves.length;t++)Object.keys(this.leaves[t].data).length>0&&(this.leaves[t].data={})},a.prototype.setMaxLabelLength=function(){var t;void 0===this.maxLabelLength[this.treeType]&&(this.maxLabelLength[this.treeType]=0);for(var e=0;e<this.leaves.length;e++)t=this.canvas.measureText(this.leaves[e].id),t.width>this.maxLabelLength[this.treeType]&&(this.maxLabelLength[this.treeType]=t.width)},a.prototype.loadCompleted=function(){g.fireEvent(this.canvasEl,"loaded")},a.prototype.loadStarted=function(){g.fireEvent(this.canvasEl,"loading")},a.prototype.loadError=function(t){g.fireEvent(this.canvasEl,"error",{message:t})},a.prototype.subtreeDrawn=function(t){g.fireEvent(this.canvasEl,"subtree",{node:t})},a.prototype.nodesSelected=function(t){g.fireEvent(this.canvasEl,"selected",{nodeIds:t})},a.prototype.addListener=function(t,e){g.addEvent(this.canvasEl,t,e)},a.prototype.getBounds=function(){for(var t=this.root.startx,e=this.root.startx,s=this.root.starty,i=this.root.starty,a=this.leaves.length;a--;){var n=this.leaves[a].centerx,r=this.leaves[a].centery,o=this.leaves[a].angle,h=this.leaves[a].getNodeSize()+(this.showLabels?this.maxLabelLength[this.treeType]+this.leaves[a].getLabelSize():0)+(this.showMetadata?this.getMetadataColumnHeadings().length*this.metadataXStep:0);n+=h*Math.cos(o),r+=h*Math.sin(o),t=Math.min(t,n),e=Math.max(e,n),s=Math.min(s,r),i=Math.max(i,r)}return[[t,s],[e,i]]},a.prototype.fitInPanel=function(){var t=this.getBounds(),e=t[0][0],s=t[1][0],i=t[0][1],a=t[1][1],n=50,r=[this.canvas.canvas.width-n,this.canvas.canvas.height-n];this.zoom=Math.min(r[0]/(s-e),r[1]/(a-i)),this.offsety=(a+i)*this.zoom/-2,this.offsetx=(s+e)*this.zoom/-2},a.prototype.on=a.prototype.addListener,a.prototype.adjustForPixelRatio=function(){var t=(window.devicePixelRatio||1)/f.getBackingStorePixelRatio(this.canvas);this.canvas.canvas.style.height=this.canvas.canvas.height+"px",this.canvas.canvas.style.width=this.canvas.canvas.width+"px",t>1&&(this.canvas.canvas.width*=t,this.canvas.canvas.height*=t)},a.prototype.treeTypeChanged=function(t,e){g.fireEvent(this.canvasEl,"typechanged",{oldType:t,newType:e})},a.prototype.resetTree=function(){if(this.origBranches){this.branches=this.origBranches;for(var t in this.origBL)this.branches[t].branchLength=this.origBL[t],this.branches[t].parent=this.origP[t];this.leaves=this.origLeaves,this.root=this.origRoot}},a.prototype.rotateBranch=function(t){this.branches[t.id].rotate()},a.prototype.buildLeaves=function(){this.leaves=[];for(var t=this.root.getChildIds(),e=0;e<t.length;e++)this.leaves.push(this.branches[t[e]])},a.prototype.exportNwk=function(){var t=this.root.getNwk();return t.substr(0,t.lastIndexOf(")")+1)+";"},a.prototype.resizeToContainer=function(){this.setSize(this.canvasEl.offsetWidth,this.canvasEl.offsetHeight),this.draw(),this.history.resizeTree()},a.prototype.downloadAllLeafIds=function(){this.root.downloadLeafIdsFromBranch()},a.prototype.exportCurrentTreeView=function(){var t=this.getPngUrl(),e=document.createElement("a"),s="undefined"!=typeof e.download,i=document.createEvent("Event");e.href=t,e.target="_blank",s&&(e.download="phylocanvas.png"),i.initEvent("click",!0,!0),e.dispatchEvent(i),s&&(window.URL||window.webkitURL).revokeObjectURL(e.href)},t.exports=a},function(t,e,s){"use strict";function i(){this.angle=0,this.branchLength=!1,this.canvas=null,this.centerx=0,this.centery=0,this.children=[],this.collapsed=!1,this.colour="rgba(0,0,0,1)",this.data={},this.id="",this.interx=0,this.intery=0,this.label=null,this.leaf=!0,this.maxChildAngle=0,this.minChildAngle=a.FULL,this.nodeShape="circle",this.parent=null,this.radius=1,this.selected=!1,this.startx=0,this.starty=0,this.totalBranchLength=0,this.tree={}}var a=s(9).Angles,n=s(9).Shapes,r=s(2).setupDownloadLink;i.prototype.clicked=function(t,e){var s,i;if(!this.dragging){if(t<this.maxx&&t>this.minx&&e<this.maxy&&e>this.miny)return this;for(s=this.children.length-1;s>=0;s--)if(i=this.children[s].clicked(t,e))return i}},i.prototype.drawMetadata=function(){var t,e,s=this.getLabelStartX()+this.tree.maxLabelLength[this.tree.treeType],i=0,n=[],r=this.tree.textSize,o=this.tree.metadataXStep/2;if(this.tree.nodeAlign&&("rectangular"===this.tree.treeType?s+=this.tree.farthestNodeFromRootX-this.centerx:"hierarchy"===this.tree.treeType&&(s+=this.tree.farthestNodeFromRootY-this.centery)),!this.tree.metadataHeadingDrawn&&this.tree.nodeAlign&&"circular"!==this.tree.treeType&&"radial"!==this.tree.treeType&&(this.drawMetadataHeading(s,i),this.tree.metadataHeadingDrawn=!0),Object.keys(this.data).length>0){for(this.canvas.beginPath(),this.angle>a.QUARTER&&this.angle<a.HALF+a.QUARTER&&this.canvas.rotate(a.HALF),n=this.tree.selectedMetadataColumns.length>0?this.tree.selectedMetadataColumns:Object.keys(this.data),i-=r/2,t=0;t<n.length;t++)e=n[t],s+=this.tree.metadataXStep,window.parseInt(this.data[e])?(this.canvas.fillStyle=this.tree.colour1,this.canvas.fillRect(s,i,o,r)):0===window.parseInt(this.data[e])&&(this.canvas.fillStyle=this.tree.colour0,this.canvas.fillRect(s,i,o,r));this.canvas.stroke(),this.canvas.closePath()}},i.prototype.drawMetadataHeading=function(t,e){var s,i,a;for(s=this.tree.selectedMetadataColumns.length>0?this.tree.selectedMetadataColumns:Object.keys(this.data),this.canvas.font="12px Sans-serif",this.canvas.fillStyle="black",a=0;a<s.length;a++)i=s[a],t+=this.tree.metadataXStep,this.canvas.rotate(-Math.PI/2),"rectangular"===this.tree.treeType?(this.canvas.textAlign="left",this.canvas.fillText(i,20,t+6)):"hierarchy"===this.tree.treeType?(this.canvas.textAlign="right",this.canvas.fillText(i,-20,t+8)):"diagonal"===this.tree.treeType&&(this.canvas.textAlign="left",this.canvas.fillText(i,20,t+6)),this.canvas.rotate(Math.PI/2)},i.prototype.drawLabel=function(){var t,e,s,i=this.tree.textSize,n=this.getLabel();this.canvas.font=i+"pt "+this.tree.font,t=this.canvas.measureText(n),void 0===this.tree.maxLabelLength[this.tree.treeType]&&(this.tree.maxLabelLength[this.tree.treeType]=0),t.width>this.tree.maxLabelLength[this.tree.treeType]&&(this.tree.maxLabelLength[this.tree.treeType]=t.width),e=this.getLabelStartX(),s=i/2,this.tree.nodeAlign&&("rectangular"===this.tree.treeType?e+=this.tree.farthestNodeFromRootX-this.centerx:"hierarchy"===this.tree.treeType&&(e+=this.tree.farthestNodeFromRootY-this.centery)),this.angle>a.QUARTER&&this.angle<a.HALF+a.QUARTER&&(this.canvas.rotate(a.HALF),e=-e-1*t.width),this.canvas.beginPath(),this.canvas.fillStyle=this.getTextColour(),this.canvas.fillText(n,e,s),this.canvas.closePath()},i.prototype.setNodeDimensions=function(t,e,s){this.minx=t-s,this.maxx=t+s,this.miny=e-s,this.maxy=e+s},i.prototype.drawNode=function(){var t=this.getNodeSize(),e=t,s=this.leaf?e*Math.cos(this.angle)+this.centerx:this.centerx,i=this.leaf?e*Math.sin(this.angle)+this.centery:this.centery;if(this.canvas.beginPath(),this.canvas.fillStyle=this.selected?this.tree.selectedColour:this.colour,t*this.tree.zoom<5||!this.leaf?this.setNodeDimensions(s,i,5/this.tree.zoom):this.setNodeDimensions(s,i,t),this.collapsed){var n=this.getChildIds(),r=n.length;"radial"===this.tree.treeType&&(r/=7),"circular"===this.tree.treeType&&(r/=3),this.canvas.globalAlpha=.3,this.canvas.beginPath(),this.canvas.arc(s,i,r,0,2*Math.PI,!1),this.canvas.fillStyle=this.tree.defaultCollapsedOptions.color?this.tree.defaultCollapsedOptions.color:"purple",this.canvas.fill(),this.canvas.globalAlpha=1}else if(this.leaf){var o=this.canvas.lineWidth;this.tree.nodeAlign&&(this.canvas.lineWidth=this.canvas.lineWidth/10,this.canvas.beginPath(),"rectangular"===this.tree.treeType&&this.canvas.moveTo(this.tree.farthestNodeFromRootX,this.centery),"hierarchy"===this.tree.treeType&&this.canvas.moveTo(this.centerx,this.tree.farthestNodeFromRootY),this.canvas.closePath(),this.canvas.fill()),this.canvas.save(),this.canvas.translate(this.centerx,this.centery),this.canvas.rotate(this.angle),this.tree.nodeRenderers[this.nodeShape](this),(this.tree.showLabels||this.tree.hoverLabel&&this.highlighted)&&this.drawLabel(),this.tree.showMetadata&&this.drawMetadata(),this.canvas.restore(),this.canvas.lineWidth=o}if(this.canvas.closePath(),this.highlighted){this.canvas.beginPath();var h=this.canvas.lineWidth;this.canvas.strokeStyle=this.tree.highlightColour,this.canvas.lineWidth=this.tree.highlightWidth/this.tree.zoom,this.canvas.arc(s,i,(this.leaf?this.getNodeSize():0)+(5+this.tree.highlightWidth/2)/this.tree.zoom,0,a.FULL,!1),this.canvas.stroke(),this.canvas.lineWidth=h,this.canvas.strokeStyle=this.tree.branchColour,this.canvas.closePath()}},i.prototype.getChildIds=function(){var t,e=[];if(this.leaf)return[this.id];for(e=[],t=0;t<this.children.length;t++)e=e.concat(this.children[t].getChildIds());return e},i.prototype.getChildCount=function(){var t,e=0;if(this.leaf)return 1;for(t=0;t<this.children.length;t++)e+=this.children[t].getChildCount();return e},i.prototype.getChildYTotal=function(){var t,e=0;if(this.leaf)return this.centery;for(t=0;t<this.children.length;t++)e+=this.children[t].getChildYTotal();return e},i.prototype.setSelected=function(t,e){var s=this.id,i=0;if(this.selected=t,e)for(i=0;i<this.children.length;i++)s=s+","+this.children[i].setSelected(t,e);return s},i.prototype.setHighlighted=function(t){var e;if(this.highlighted=t,!t)for(e=0;e<this.children.length;e++)this.children[e].setHighlighted(t)},i.prototype.reset=function(){var t,e;for(this.startx=0,this.starty=0,this.centerx=0,this.centery=0,this.angle=null,this.minChildAngle=a.FULL,this.maxChildAngle=0,e=0;e<this.children.length;e++)try{this.children[t].pcReset()}catch(s){return s}},i.prototype.parseNwk=function(t,e){var e=this.parseLabel(t,e);return":"===t[e]?e=this.parseNodeLength(t,e+1):this.branchLength=0,this.id&&""!==this.id||(this.id=this.tree.genId()),e},i.prototype.parseLabel=function(t,e){var s,i,a="";for(e;":"!==t[e]&&","!==t[e]&&")"!==t[e]&&e<t.length;e++)a+=t[e];if(!a)return e;if(a.match(/\*/)){if(s=a.split("**"),this.id=s[0],1===s.length)return e;for(s=s[1].split("*"),i=0;i<s.length;i+=2)switch(s[i]){case"nsz":this.radius=window.parseInt(s[i+1]);break;case"nsh":n[s[i+1]]?this.nodeShape=n[s[i+1]]:this.nodeRenderers[s[i+1]]?this.nodeShape=s[i+1]:this.nodeShape="circle";break;case"ncol":this.colour=s[i+1];var r="0x"+this.colour.substring(0,2),o="0x"+this.colour.substring(2,4),h="0x"+this.colour.substring(4,6);this.colour="rgba("+parseInt(r,16).toString()+","+parseInt(o,16).toString()+","+parseInt(h,16).toString()+",1)"}}else this.id=a;return e},i.prototype.parseNodeLength=function(t,e){var s="";for(e;")"!==t[e]&&","!==t[e];e++)s+=t[e];return this.branchLength=parseFloat(s),this.branchLength<0&&(this.branchLength=0),e},i.prototype.redrawTreeFromBranch=function(){this.tree.redrawFromBranch(this)},i.prototype.saveChildren=function(){var t;for(t=0;t<this.children.length;t++)this.tree.saveNode(this.children[t]),this.children[t].saveChildren()},i.prototype.isCollapsed=function(){return this.collapsed||this.parent&&this.parent.isCollapsed()},i.prototype.collapse=function(){this.collapsed=this.leaf===!1},i.prototype.expand=function(){this.collapsed=!1},i.prototype.toggleCollapsed=function(){this.collapsed?this.expand():this.collapse()},i.prototype.setTotalLength=function(){
var t;for(this.parent?(this.totalBranchLength=this.parent.totalBranchLength+this.branchLength,this.totalBranchLength>this.tree.maxBranchLength&&(this.tree.maxBranchLength=this.totalBranchLength)):(this.totalBranchLength=this.branchLength,this.tree.maxBranchLength=this.totalBranchLength),t=0;t<this.children.length;t++)this.children[t].setTotalLength()},i.prototype.addChild=function(t){t.parent=this,t.canvas=this.canvas,t.tree=this.tree,this.leaf=!1,this.children.push(t)},i.prototype.getChildColours=function(){var t=[];return this.children.forEach(function(e){var s=0===e.children.length?e.colour:e.getColour();-1===t.indexOf(s)&&t.push(s)}),t},i.prototype.getColour=function(){var t;return this.selected?this.tree.selectedColour:this.tree.backColour===!0?this.children.length?(t=this.getChildColours(),1===t.length?t[0]:this.tree.branchColour):this.colour:"function"==typeof this.tree.backColour?this.tree.backColour(this):this.tree.branchColour},i.prototype.getNwk=function(){var t,e,s;if(this.leaf)return this.id+":"+this.branchLength;for(t=[],e=0;e<this.children.length;e++)t.push(this.children[e].getNwk());return s="("+t.join(",")+"):"+this.branchLength},i.prototype.getTextColour=function(){var t,e;return this.selected?this.tree.selectedColour:(this.highlighted?t=this.tree.highlightColour:this.tree.backColour?this.children.length?(e=this.getChildColours(),t=1===e.length?e[0]:this.tree.branchColour):t=this.colour:t=this.tree.branchColour,t)},i.prototype.getLabel=function(){return void 0!==this.label&&null!==this.label?this.label:this.id},i.prototype.getLabelSize=function(){return this.tree.canvas.measureText(this.getLabel()).width},i.prototype.getNodeSize=function(){return Math.max(0,this.tree.baseNodeSize*this.radius)},i.prototype.getLabelStartX=function(){return this.getNodeSize()+this.tree.baseNodeSize+2*this.radius},i.prototype.rotate=function(t){var e,s=[];for(e=this.children.length;e--;)s.push(this.children[e]);this.children=s,t.preventredraw||(this.tree.buildLeaves(),this.tree.draw(!0))},i.prototype.getChildNo=function(){return this.parent.children.indexOf(this)},i.prototype.downloadLeafIdsFromBranch=function(){var t,e=this.getChildIds();t=e.join("\n"),r(t,"pc_leaves.txt")},t.exports=i},function(t,e,s){"use strict";function i(t){this.div=t,this.cl=document.createElement("canvas"),this.cl.id=t.id+"Loader",this.cl.style.position="absolute",this.cl.style.backgroundColor="#FFFFFF",this.cl.style.top=t.offsetHeight/4+"px",this.cl.style.left=t.offsetWidth/4+"px",this.cl.height=t.offsetHeight/2,this.cl.width=t.offsetWidth/2,this.cl.style.zIndex="1000",t.appendChild(this.cl),this.ctx=document.getElementById(t.id+"Loader").getContext("2d"),this.drawer=null,this.loaderRadius=null,this.loaderStep=2*Math.PI/360,this.message="Loading ..."}i.prototype.run=function(){var t=0,e=this;this.cl.style.diangle="block",this.initLoader(),this.drawer=setInterval(function(){e.drawLoader(t),t++},10)},i.prototype.resize=function(){this.cl.style.top="2px",this.cl.style.left="2px",this.cl.height=.75*this.div.offsetHeight,this.cl.width=.75*this.div.offsetWidth,this.ctx.strokeStyle="rgba(180,180,255,1)",this.ctx.fillStyle="rgba(180,180,255,1)",this.ctx.lineWidth=10,this.ctx.font="24px sans-serif",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2},i.prototype.initLoader=function(){this.ctx.strokeStyle="rgba(180,180,255,1)",this.ctx.fillStyle="rgba(180,180,255,1)",this.ctx.lineWidth=10,this.ctx.font="24px sans-serif",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2},i.prototype.drawLoader=function(t){this.ctx.restore(),this.ctx.translate(0,0),this.loaderRadius=Math.min(this.ctx.canvas.width/4,this.ctx.canvas.height/4),this.ctx.save(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.translate(this.ctx.canvas.width/2,this.ctx.canvas.height/2),this.ctx.beginPath(),this.ctx.arc(0,0,this.loaderRadius,this.loaderStep*t,this.loaderStep*t+2),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(0,0,this.loaderRadius,this.loaderStep*t+3,this.loaderStep*t+5),this.ctx.stroke(),this.ctx.fillText(this.message,-(this.ctx.measureText(this.message).width/2),this.loaderRadius+50,this.cl.width)},i.prototype.stop=function(){clearInterval(this.drawer),this.cl.style.display="none"},i.prototype.fail=function(t){clearInterval(this.drawer),this.loaderRadius=Math.min(this.ctx.canvas.width/4,this.ctx.canvas.height/4),this.ctx.restore(),this.ctx.translate(0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.beginPath(),this.ctx.strokeStyle="rgba(255,180,180,1)",this.ctx.fillStyle="rgba(255,180,180,1)",this.ctx.translate(this.ctx.canvas.width/2,this.ctx.canvas.height/2),this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.loaderRadius,this.loaderRadius),this.ctx.moveTo(0,0),this.ctx.lineTo(-this.loaderRadius,this.loaderRadius),this.ctx.moveTo(0,0),this.ctx.lineTo(-this.loaderRadius,-this.loaderRadius),this.ctx.moveTo(0,0),this.ctx.lineTo(this.loaderRadius,-this.loaderRadius),this.ctx.stroke(),this.ctx.fillText(t,-(this.ctx.measureText(t).width/2),this.loaderRadius+50,2*this.loaderRadius)},t.exports=i},function(t,e,s){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}function r(t,e){return e?e.leaf&&"internal"!==t.nodeType?!0:e.leaf||"internal"!==t.nodeType?!1:!0:!t.nodeType}function o(t){t.style.backgroundColor="#E2E3DF"}function h(t){t.style.backgroundColor="transparent"}function l(t){var e=t.handler,s=t.text,i=void 0===s?"New menu Item":s,a=t.nodeType;return{handler:e,text:i,nodeType:a}}Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),d=function(t,e,s){for(var i=!0;i;){var a=t,n=e,r=s;o=l=h=void 0,i=!1;var o=Object.getOwnPropertyDescriptor(a,n);if(void 0!==o){if("value"in o)return o.value;var h=o.get;return void 0===h?void 0:h.call(r)}var l=Object.getPrototypeOf(a);if(null===l)return void 0;t=l,e=n,s=r,i=!0}},p=s(7),u=i(p),v=s(13),g=[{text:"Collapse/Expand Branch",handler:"toggleCollapsed",nodeType:"internal"},{text:"Rotate Branch",handler:"rotate",nodeType:"internal"},{text:"Redraw Subtree",handler:"redrawTreeFromBranch",nodeType:"internal"},{text:"Show/Hide Labels",handler:"toggleLabels"},{text:"Export As Image",handler:"exportCurrentTreeView"},{text:"Export Leaf IDs",handler:"downloadAllLeafIds"},{text:"Export Leaf IDs on Branch",handler:"downloadLeafIdsFromBranch",nodeType:"internal"}],f=function(t){function e(t){var s=void 0===arguments[1]?g:arguments[1];a(this,e),d(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t,"pc-context-menu"),this.menuItems=s.map(l),this.fontSize="8pt"}return n(e,t),c(e,[{key:"click",value:function(){v.createHandler(this,"close")}},{key:"createContent",value:function(t){var e=document.createElement("ul");e.style.margin="0",e.style.padding="0";var s=!0,i=!1,a=void 0;try{for(var n,l=this.menuItems[Symbol.iterator]();!(s=(n=l.next()).done);s=!0){var c=n.value;if(r(c,t)){var d=this.createElement("li",c.text);d.style.listStyle="none outside none",c.nodeType?d.addEventListener("click",v.createHandler(t,c.handler)):d.addEventListener("click",v.createHandler(this.tree,c.handler)),d.addEventListener("click",this.click),d.addEventListener("contextmenu",v.preventDefault),d.addEventListener("mouseover",v.createHandler(d,o)),d.addEventListener("mouseout",v.createHandler(d,h)),e.appendChild(d)}}}catch(p){i=!0,a=p}finally{try{!s&&l["return"]&&l["return"]()}finally{if(i)throw a}}document.body.addEventListener("click",v.createHandler(this,"close")),this.element.appendChild(e)}}]),e}(u["default"]);e["default"]=f,t.exports=e["default"]},function(t,e,s){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),n=function(){function t(e){var s=void 0===arguments[1]?"pc-tooltip":arguments[1],a=void 0===arguments[2]?document.createElement("div"):arguments[2];i(this,t),this.tree=e,this.element=a,this.element.className=s,this.element.style.display="none",this.element.style.position="fixed",this.element.style.border="1px solid #CCCCCC",this.element.style.background="#FFFFFF",this.element.style.letterSpacing="0.5px",this.closed=!0,this.tree.canvasEl.appendChild(this.element)}return a(t,[{key:"close",value:function(){this.element.style.display="none",this.closed=!0}},{key:"createElement",value:function(t,e){var s=document.createElement(t);return s.style.cursor="pointer",s.style.padding="0.3em 0.5em 0.3em 0.5em",s.style.fontFamily=this.tree.font,s.style.fontSize=this.fontSize||"12pt",s.appendChild(document.createTextNode(e)),s}},{key:"createContent",value:function(t){this.element.appendChild(this.createElement("div",t.getChildIds().length))}},{key:"open",value:function(t,e,s){for(var i=void 0===arguments[0]?100:arguments[0],a=void 0===arguments[1]?100:arguments[1];this.element.hasChildNodes();)this.element.removeChild(this.element.firstChild);this.createContent(s),this.element.style.top=a+"px",this.element.style.left=i+"px",this.element.style.zIndex=2e3,this.element.style.display="block",this.element.style.backgroundColor="#FFFFFF",this.closed=!1}}]),t}();e["default"]=n,t.exports=e["default"]},function(t,e,s){"use strict";function i(t){this.tree=t,this.cel=document.createElement("canvas"),this.cel.id=this.tree.canvasEl.id+"Navi",this.cel.style.zIndex="100",this.cel.style.backgroundColor="#FFFFFF",this.cel.width=this.tree.canvas.canvas.width/3,this.cel.height=this.tree.canvas.canvas.height/3,this.cel.style.position="absolute",this.cel.style.bottom="0px",this.cel.style.right="0px",this.cel.style.border="1px solid #CCCCCC",this.tree.canvasEl.appendChild(this.cel),this.ctx=this.cel.getContext("2d"),this.ctx.translate(this.cel.width/2,this.cel.height/2),this.ctx.save()}i.prototype.drawFrame=function(){var t,e,s,i=this.cel.width,a=this.cel.height,n=i/2,r=a/2;this.ctx.restore(),this.ctx.save(),this.ctx.clearRect(-n,-r,i,a),this.ctx.strokeStyle="rgba(180,180,255,1)",this.tree.drawn?this.ctx.drawImage(this.img,-n,-r,this.cel.width,this.cel.height):(t=this.tree.canvas.canvas.toDataURL(),this.img=document.createElement("img"),this.img.src=t,e=this,this.img.onload=function(){e.ctx.drawImage(e.img,-n,-r,e.cel.width,e.cel.height)},this.baseOffsetx=this.tree.offsetx,this.baseOffsety=this.tree.offsety,this.baseZoom=this.tree.zoom),s=1/(this.tree.zoom/this.baseZoom),this.ctx.lineWidth=this.ctx.lineWidth/s,this.ctx.translate((this.baseOffsetx-this.tree.offsetx*s)*s,(this.baseOffsety-this.tree.offsety*s)*s),this.ctx.scale(s,s),this.ctx.strokeRect(-n,-r,i,a)},i.prototype.resize=function(){this.cel.width=this.tree.canvas.canvas.width/3,this.cel.height=this.tree.canvas.canvas.height/3,this.ctx.translate(this.cel.width/2,this.cel.height/2),this.drawFrame()},t.exports=i},function(t,e,s){"use strict";t.exports.Angles={FORTYFIVE:Math.PI/4,QUARTER:Math.PI/2,HALF:Math.PI,FULL:2*Math.PI},t.exports.Shapes={x:"star",s:"square",o:"circle",t:"triangle"}},function(t,e,s){"use strict";function i(t){return t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||1}t.exports.getBackingStorePixelRatio=i},function(t,e,s){"use strict";var i=s(15);t.exports={rectangular:new i(s(16)),circular:new i(s(17)),radial:new i(s(14)),diagonal:new i(s(18)),hierarchical:new i(s(19))}},function(t,e,s){"use strict";var i=s(9).Angles;t.exports={circle:function(t){var e=t.getNodeSize();t.canvas.arc(e,0,e,0,i.FULL,!1),t.canvas.stroke(),t.canvas.fill()},square:function(t){var e=t.getNodeSize(),s=0,i=2*e,a=-e,n=e;t.canvas.moveTo(s,a),t.canvas.lineTo(s,n),t.canvas.lineTo(i,n),t.canvas.lineTo(i,a),t.canvas.lineTo(s,a),t.canvas.stroke(),t.canvas.fill()},star:function(t){var e=t.getNodeSize(),s=e,i=0,a=6,n=6,r=2,o=Math.PI/2*3,h=s,l=i,c=Math.PI/a,d=0;for(t.canvas.beginPath(),t.canvas.moveTo(s,i-n),d=0;a>d;d++)h=s+Math.cos(o)*n,l=i+Math.sin(o)*n,t.canvas.lineTo(h,l),o+=c,h=s+Math.cos(o)*r,l=i+Math.sin(o)*r,t.canvas.lineTo(h,l),o+=c;t.canvas.lineTo(s,i-n),t.canvas.stroke(),t.canvas.fill(),t.canvas.moveTo(s,i),t.canvas.lineTo(s-(n-1),i),t.canvas.stroke(),t.canvas.closePath()},triangle:function(t){var e=t.getNodeSize(),s=e,i=0,a=s-e,n=s+e,r=i-e,o=i+e;t.canvas.moveTo(s,r),t.canvas.lineTo(n,o),t.canvas.lineTo(a,o),t.canvas.lineTo(s,r),t.canvas.stroke(),t.canvas.fill(),t.canvas.moveTo(a,(r+o)/2),t.canvas.lineTo((a+n)/2,(r+o)/2),t.canvas.stroke()}}},function(t,e,s){"use strict";function i(t){return t.preventDefault(),!1}function a(t,e,s){var i,a;if(document.createEvent?(i=document.createEvent("HTMLEvents"),i.initEvent(e,!0,!0)):(i=document.createEventObject(),i.eventType=e),i.eventName=e,s)for(a in s)s.hasOwnProperty(a)&&(i[a]=s[a]);document.createEvent?t.dispatchEvent(i):t.fireEvent("on"+i.eventType,i)}function n(t,e,s){t.addEventListener?t.addEventListener(e,s,!1):t.attachEvent("on"+e,function(){return s.call(t,window.event)})}function r(t){t.stopPropagation(),t.preventDefault()}function o(t,e){var s;return s="string"==typeof e?function(s){return t[e]?t[e](s):void 0}:function(){return e(t)}}t.exports.preventDefault=i,t.exports.fireEvent=a,t.exports.addEvent=n,t.exports.killEvent=r,t.exports.createHandler=o},function(t,e,s){"use strict";t.exports={draw:function(t,e){e.canvas.beginPath(),e.canvas.moveTo(e.startx,e.starty),e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke(),e.canvas.closePath()}}},function(t,e,s){"use strict";function i(t){if(!t||!t.draw)throw new Error("`draw` function is required for branch renderers");this.draw=t.draw,this.prepareChild=t.prepareChild}i.prototype.render=function(t,e,s){var i;if(!s&&e)for(e.selected?e.canvas.fillStyle=t.selectedColour:e.canvas.fillStyle=e.colour,e.canvas.strokeStyle=e.getColour(),this.draw(t,e),e.drawNode(),i=0;i<e.children.length;i++)this.prepareChild&&this.prepareChild(e,e.children[i]),this.render(t,e.children[i],e.collapsed||s)},t.exports=i},function(t,e,s){"use strict";t.exports={draw:function(t,e){var s=e.branchLength*t.branchScalar;e.angle=0,e.parent&&(e.centerx=e.startx+s),e.canvas.beginPath(),e.canvas.moveTo(e.startx,e.starty),e.canvas.lineTo(e.startx,e.centery),e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke(),e.canvas.closePath()},prepareChild:function(t,e){e.startx=t.centerx,e.starty=t.centery}}},function(t,e,s){"use strict";t.exports={draw:function(t,e){var s=e.getColour(),i=e.totalBranchLength*t.branchScalar;e.canvas.beginPath(),e.canvas.moveTo(e.startx,e.starty),e.leaf?(e.canvas.lineTo(e.interx,e.intery),e.canvas.stroke(),e.canvas.strokeStyle=e.selected?e.tree.selectedColour:"rgba(0,0,0,0.5)",e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke(),e.canvas.strokeStyle=s):(e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke()),e.canvas.closePath(),e.canvas.strokeStyle=e.getColour(),e.children.length>1&&!e.collapsed&&(e.canvas.beginPath(),e.canvas.arc(0,0,i,e.minChildAngle,e.maxChildAngle,e.maxChildAngle<e.minChildAngle),e.canvas.stroke(),e.canvas.closePath())}}},function(t,e,s){"use strict";t.exports={draw:function(t,e){e.angle=0,e.canvas.beginPath(),e.canvas.moveTo(e.startx,e.starty),e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke(),e.canvas.closePath()},prepareChild:function(t,e){e.startx=t.centerx,e.starty=t.centery}}},function(t,e,s){"use strict";t.exports={draw:function(t,e){e.canvas.beginPath(),e!==e.tree.root&&(e.canvas.moveTo(e.startx,e.starty),e.canvas.lineTo(e.centerx,e.starty)),e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke(),e.canvas.closePath()}}},function(t,e,s){"use strict";function i(t,e){e.parent?(e.startx=e.parent.centerx,e.starty=e.parent.centery):(e.startx=0,e.starty=0),e.centerx=e.startx+e.branchLength*t.branchScalar*Math.cos(e.angle),e.centery=e.starty+e.branchLength*t.branchScalar*Math.sin(e.angle);for(var s=0;s<e.children.length;s++)i(t,e.children[s])}var a=s(9).Angles;t.exports={step:function(t){return a.FULL/t.leaves.length},calculate:function(t,e){t.branchScalar=Math.min(t.canvas.canvas.width,t.canvas.canvas.height)/t.maxBranchLength;for(var s=0;s<t.leaves.length;s+=1){t.leaves[s].angle=e*s,t.leaves[s].centerx=t.leaves[s].totalBranchLength*t.branchScalar*Math.cos(t.leaves[s].angle),t.leaves[s].centery=t.leaves[s].totalBranchLength*t.branchScalar*Math.sin(t.leaves[s].angle);for(var a=t.leaves[s];a.parent&&(0===a.getChildNo()&&(a.parent.angle=0),a.parent.angle+=a.angle*a.getChildCount(),a.getChildNo()===a.parent.children.length-1);a=a.parent)a.parent.angle=a.parent.angle/a.parent.getChildCount()}i(t,t.root)}}},function(t,e,s){"use strict";function i(t){this.step=t.step,this.calculate=t.calculate}i.prototype.run=function(t){var e=this.step(t);t.root.startx=0,t.root.starty=0,t.root.centerx=0,t.root.centery=0,t.farthestNodeFromRootX=0,t.farthestNodeFromRootY=0,this.calculate(t,e),t.root.startx=t.root.centerx,t.root.starty=t.root.centery,t.setFontSize(e),t.setMaxLabelLength()},t.exports=i},function(t,e,s){"use strict";t.exports={step:function(t){return Math.max(t.canvas.canvas.height/(t.leaves.length+2),2*(t.leaves[0].getNodeSize()+2))},calculate:function(t,e){t.branchScalar=t.canvas.canvas.width/t.maxBranchLength;for(var s=0;s<t.leaves.length;s++){t.leaves[s].angle=0,t.leaves[s].centery=s>0?t.leaves[s-1].centery+e:0,t.leaves[s].centerx=t.leaves[s].totalBranchLength*t.branchScalar,t.leaves[s].centerx>t.farthestNodeFromRootX&&(t.farthestNodeFromRootX=t.leaves[s].centerx),t.leaves[s].centery>t.farthestNodeFromRootY&&(t.farthestNodeFromRootY=t.leaves[s].centery);for(var i=t.leaves[s];i.parent;i=i.parent){var a=i.parent.children;i.parent.centery=(a[0].centery+a[a.length-1].centery)/2}}}}},function(t,e,s){"use strict";var i=s(9).Angles;t.exports={step:function(t){return i.FULL/t.leaves.length},calculate:function(t,e){t.branchScalar=Math.min(t.canvas.canvas.width,t.canvas.canvas.height)/t.maxBranchLength;var s=t.leaves.length*t.leaves[0].getNodeSize()*2/i.FULL;t.branchScalar*t.maxBranchLength>s?s=t.branchScalar*t.maxBranchLength:t.branchScalar=s/t.maxBranchLength;for(var a=0;a<t.leaves.length;a++){t.leaves[a].angle=e*a,t.leaves[a].centery=s*Math.sin(t.leaves[a].angle),t.leaves[a].centerx=s*Math.cos(t.leaves[a].angle),t.leaves[a].starty=t.leaves[a].parent.totalBranchLength*t.branchScalar*Math.sin(t.leaves[a].angle),t.leaves[a].startx=t.leaves[a].parent.totalBranchLength*t.branchScalar*Math.cos(t.leaves[a].angle),t.leaves[a].intery=t.leaves[a].totalBranchLength*t.branchScalar*Math.sin(t.leaves[a].angle),t.leaves[a].interx=t.leaves[a].totalBranchLength*t.branchScalar*Math.cos(t.leaves[a].angle);for(var n=t.leaves[a];n.parent&&(0===n.getChildNo()&&(n.parent.angle=n.angle,n.parent.minChildAngle=n.angle),n.getChildNo()===n.parent.children.length-1);n=n.parent)n.parent.maxChildAngle=n.angle,n.parent.angle=(n.parent.minChildAngle+n.parent.maxChildAngle)/2,n.parent.centery=n.parent.totalBranchLength*t.branchScalar*Math.sin(n.parent.angle),n.parent.centerx=n.parent.totalBranchLength*t.branchScalar*Math.cos(n.parent.angle),n.parent.starty=(n.parent.totalBranchLength-n.parent.branchLength)*t.branchScalar*Math.sin(n.parent.angle),n.parent.startx=(n.parent.totalBranchLength-n.parent.branchLength)*t.branchScalar*Math.cos(n.parent.angle)}}}},function(t,e,s){"use strict";var i=s(9).Angles;t.exports={step:function(t){return Math.max(t.canvas.canvas.height/(t.leaves.length+2),2*(t.leaves[0].getNodeSize()+2))},calculate:function(t,e){for(var s=0;s<t.leaves.length;s++){t.leaves[s].centerx=0,t.leaves[s].centery=s>0?t.leaves[s-1].centery+e:0,t.leaves[s].angle=0;for(var a=t.leaves[s];a.parent&&a.getChildNo()===a.parent.children.length-1;a=a.parent){a.parent.centery=a.parent.getChildYTotal()/a.parent.getChildCount(),a.parent.centerx=a.parent.children[0].centerx+(a.parent.children[0].centery-a.parent.centery)*Math.tan(i.FORTYFIVE);for(var n=0;n<a.parent.children.length;n++)a.parent.children[n].startx=a.parent.centerx,a.parent.children[n].starty=a.parent.centery}}}}},function(t,e,s){"use strict";var i=s(9).Angles;t.exports={step:function(t){return Math.max(t.canvas.canvas.width/(t.leaves.length+2),2*(t.leaves[0].getNodeSize()+2))},calculate:function(t,e){t.branchScalar=t.canvas.canvas.height/t.maxBranchLength;for(var s=0;s<t.leaves.length;s++){t.leaves[s].angle=i.QUARTER,t.leaves[s].centerx=s>0?t.leaves[s-1].centerx+e:0,t.leaves[s].centery=t.leaves[s].totalBranchLength*t.branchScalar;for(var a=t.leaves[s];a.parent&&(0===a.getChildNo()&&(a.parent.centerx=a.centerx),a.getChildNo()===a.parent.children.length-1);a=a.parent){a.parent.angle=i.QUARTER,a.parent.centerx=(a.parent.centerx+a.centerx)/2,a.parent.centery=a.parent.totalBranchLength*t.branchScalar;for(var n=0;n<a.parent.children.length;n++)a.parent.children[n].startx=a.parent.centerx,a.parent.children[n].starty=a.parent.centery}t.leaves[s].centerx>t.farthestNodeFromRootX&&(t.farthestNodeFromRootX=t.leaves[s].centerx),t.leaves[s].centery>t.farthestNodeFromRootY&&(t.farthestNodeFromRootY=t.leaves[s].centery)}}}}])});