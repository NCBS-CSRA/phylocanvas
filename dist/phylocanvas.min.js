!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.PhyloCanvas=e():t.PhyloCanvas=e()}(this,function(){return function(t){function e(i){if(a[i])return a[i].exports;var n=a[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var a={};return e.m=t,e.c=a,e.p="/dist/",e(0)}([function(t,e,a){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t){this.tree=t,this.injectCss(),this.div=this.createDiv(t.canvasEl),this.resizeTree(t),this.tree.addListener("subtree",function(t){this.addSnapshot(t.node)}.bind(this)),this.tree.addListener("loaded",this.reset.bind(this)),this.tree.addListener("typechanged",function(){this.addSnapshot(this.tree.root.id)}.bind(this)),t.historyCollapsed&&this.collapse()}Object.defineProperty(e,"__esModule",{value:!0}),e.History=n;var s=a(4),r=a(3),o=a(5),h=i(o),l=a(6),c=i(l),d=a(1),u=i(d),p=a(10),v=i(p),f=a(8),g=i(f),y=a(17),m=i(y);e.Tree=h["default"],e.Branch=c["default"],e.ContextMenu=u["default"],e.branchRenderers=v["default"],e.nodeRenderers=g["default"],e.prerenderers=m["default"],n.prototype.reset=function(){this.clear(),this.tree.drawn&&this.addSnapshot(this.tree.root.id)},n.prototype.collapse=function(){s.addClass(this.div,"collapsed"),this.toggleDiv.firstChild.data=">",this.resizeTree()},n.prototype.expand=function(){s.removeClass(this.div,"collapsed"),this.toggleDiv.firstChild.data="<",this.resizeTree()},n.prototype.isCollapsed=function(){return s.hasClass(this.div,"collapsed")},n.prototype.toggle=function(){this.isCollapsed()?this.expand():this.collapse(),r.fireEvent(this.tree.canvasEl,"historytoggle",{isOpen:!this.isCollapsed()})},n.prototype.createDiv=function(t){var e=document.createElement("div");e.className="pc-history",r.addEvent(e,"click",r.killEvent),r.addEvent(e,"contextmenu",r.killEvent);var a=document.createElement("div");a.innerHTML="History",a.className="pc-history-title",e.appendChild(a);var i=document.createElement("div");i.appendChild(document.createTextNode("<")),i.className="toggle",r.addEvent(i,"click",this.toggle.bind(this)),e.appendChild(i),this.toggleDiv=i;var n=document.createElement("ul");return n.className="pc-history-snapshots",e.appendChild(n),this.snapshotList=n,t.appendChild(e),e},n.prototype.resizeTree=function(){var t=this.tree;this.width=this.div.offsetWidth,t.setSize(t.canvasEl.offsetWidth-this.width,t.canvasEl.offsetHeight),this.isCollapsed()?t.canvasEl.getElementsByTagName("canvas")[0].style.marginLeft=this.width+"px":t.canvasEl.getElementsByTagName("canvas")[0].style.marginLeft="20%"},n.prototype.addSnapshot=function(t){var e="phylocanvas-history-",a=this.tree.treeType,i=!1;if(this.tree.historySnapshots.forEach(function(n){n.getAttribute("data-tree-type");n.style.background="transparent",n.id==e+t&&n.getAttribute("data-tree-type")==a&&(i=!0,n.style.background="lightblue")}),!i){var n=this.tree.getPngUrl(),s=document.createElement("li"),o=document.createElement("img");o.width=this.width,o.src=n,o.id=e+t,o.setAttribute("data-tree-type",this.tree.treeType),o.style.background="lightblue",this.tree.historySnapshots.push(o),s.appendChild(o),this.snapshotList.appendChild(s),r.addEvent(o,"click",this.goBackTo.bind(this))}},n.prototype.clear=function(){for(var t=this.snapshotList.getElementsByTagName("li"),e=t.length;e--;)this.snapshotList.removeChild(t[0])},n.prototype.goBackTo=function(t){var e=t.target;this.tree.treeType=e.getAttribute("data-tree-type"),this.tree.redrawFromBranch(this.tree.origBranches[e.id.replace("phylocanvas-history-","")])},n.prototype.injectCss=function(){var t=".pc-history { position: absolute; top: 0; bottom: 0; left: 0; box-sizing: border-box; width: 20%; overflow: hidden; background: #EEE }.pc-history .pc-history-title { box-sizing: border-box; height: 20px; text-align: center; font-size: 13px; color: #666; padding: 2px; border-bottom: 1px solid #bbb }.pc-history .toggle { position: absolute; top: 0; right: 0; padding: 2px 8px; cursor: pointer; border-top-left-radius: 50%; border-bottom-left-radius: 50%; background-color: #666; color: #FFF; box-sizing: border-box; height: 20px; }.pc-history.collapsed .toggle { border-radius: 0 50% 50% 0 }.pc-history .toggle:hover { background-color: #FFF; color: #CCC }.pc-history.collapsed { width: 25px }.pc-history.collapsed .pc-history-snapshots { display: none }.pc-history.collapsed .pc-history-title { writing-mode: tb-rl; -webkit-transform: rotate(270deg); -moz-transform: rotate(270deg); -o-transform: rotate(270deg); -ms-transform: rotate(270deg); transform: rotate(270deg); margin-top: 70px; background: 0 0; color: #666; letter-spacing: 1.2px; border-bottom: none }.pc-history-snapshots { position: absolute; top: 20px; bottom: 0; margin: 0; padding: 0; overflow-x: hidden; overflow-y: scroll; }.pc-history-snapshots li { list-style: outside none none }.pc-history img { border: 0px solid #CCC; border-top-width: 1px; cursor: pointer; width: 100%; box-sizing: border-box; transition: background-color .25s ease; display: block }.pc-history img:hover { background-color: #fff }",e=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),e.appendChild(a)},h["default"].prototype.initialiseHistory=function(t){var e;(t.history||"undefined"==typeof t.history)&&(e=t.history&&"undefined"!=typeof t.history.collapsed,this.historyCollapsed=e?t.history.collapsed:!0,this.historySnapshots=[],this.history=new n(this))}},function(t,e,a){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}function r(t,e){return e?e.leaf&&"internal"!==t.nodeType?!0:e.leaf||"internal"!==t.nodeType?!1:!0:!t.nodeType}function o(t){t.style.backgroundColor="#E2E3DF"}function h(t){t.style.backgroundColor="transparent"}function l(t){var e=t.handler,a=t.text,i=void 0===a?"New menu Item":a,n=t.nodeType;return{handler:e,text:i,nodeType:n}}Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),d=function(t,e,a){for(var i=!0;i;){var n=t,s=e,r=a;o=l=h=void 0,i=!1;var o=Object.getOwnPropertyDescriptor(n,s);if(void 0!==o){if("value"in o)return o.value;var h=o.get;return void 0===h?void 0:h.call(r)}var l=Object.getPrototypeOf(n);if(null===l)return void 0;t=l,e=s,a=r,i=!0}},u=a(2),p=i(u),v=a(3),f=[{text:"Collapse/Expand Branch",handler:function(t){t.toggleCollapsed(),t.tree.draw()},nodeType:"internal"},{text:"Rotate Branch",handler:"rotate",nodeType:"internal"},{text:"Redraw Subtree",handler:"redrawTreeFromBranch",nodeType:"internal"},{text:"Show/Hide Labels",handler:"toggleLabels"},{text:"Export As Image",handler:"exportCurrentTreeView"},{text:"Export Leaf IDs",handler:"downloadAllLeafIds"},{text:"Export Leaf IDs on Branch",handler:"downloadLeafIdsFromBranch",nodeType:"internal"}],g=function(t){function e(t){var a=void 0===arguments[1]?f:arguments[1];n(this,e),d(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t,"pc-context-menu"),this.menuItems=a.map(l),this.fontSize="8pt"}return s(e,t),c(e,[{key:"click",value:function(){v.createHandler(this,"close")}},{key:"createContent",value:function(t){var e=document.createElement("ul");e.style.margin="0",e.style.padding="0";var a=!0,i=!1,n=void 0;try{for(var s,l=this.menuItems[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;if(r(c,t)){var d=this.createElement("li",c.text);d.style.listStyle="none outside none",c.nodeType?d.addEventListener("click",v.createHandler(t,c.handler)):d.addEventListener("click",v.createHandler(this.tree,c.handler)),d.addEventListener("click",this.click),d.addEventListener("contextmenu",v.preventDefault),d.addEventListener("mouseover",v.createHandler(d,o)),d.addEventListener("mouseout",v.createHandler(d,h)),e.appendChild(d)}}}catch(u){i=!0,n=u}finally{try{!a&&l["return"]&&l["return"]()}finally{if(i)throw n}}document.body.addEventListener("click",v.createHandler(this,"close")),this.element.appendChild(e)}}]),e}(p["default"]);e["default"]=g,t.exports=e["default"]},function(t,e,a){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),s=function(){function t(e){var a=void 0===arguments[1]?"pc-tooltip":arguments[1],n=void 0===arguments[2]?document.createElement("div"):arguments[2];i(this,t),this.tree=e,this.element=n,this.element.className=a,this.element.style.display="none",this.element.style.position="fixed",this.element.style.border="1px solid #CCCCCC",this.element.style.background="#FFFFFF",this.element.style.letterSpacing="0.5px",this.closed=!0,this.tree.canvasEl.appendChild(this.element)}return n(t,[{key:"close",value:function(){this.element.style.display="none",this.closed=!0}},{key:"createElement",value:function(t,e){var a=document.createElement(t);return a.style.cursor="pointer",a.style.padding="0.3em 0.5em 0.3em 0.5em",a.style.fontFamily=this.tree.font,a.style.fontSize=this.fontSize||"12pt",a.appendChild(document.createTextNode(e)),a}},{key:"createContent",value:function(t){this.element.appendChild(this.createElement("div",t.getChildIds().length))}},{key:"open",value:function(t,e,a){for(var i=void 0===arguments[0]?100:arguments[0],n=void 0===arguments[1]?100:arguments[1];this.element.hasChildNodes();)this.element.removeChild(this.element.firstChild);this.createContent(a),this.element.style.top=n+"px",this.element.style.left=i+"px",this.element.style.zIndex=2e3,this.element.style.display="block",this.element.style.backgroundColor="#FFFFFF",this.closed=!1}}]),t}();e["default"]=s,t.exports=e["default"]},function(t,e,a){"use strict";function i(t){return t.preventDefault(),!1}function n(t,e){var a,i,n=void 0===arguments[2]?{}:arguments[2];document.createEvent?(a=document.createEvent("HTMLEvents"),a.initEvent(e,!0,!0)):(a=document.createEventObject(),a.eventType=e),a.eventName=e;for(i in n)n.hasOwnProperty(i)&&(a[i]=n[i]);document.createEvent?t.dispatchEvent(a):t.fireEvent("on"+a.eventType,a)}function s(t,e,a){t.addEventListener?t.addEventListener(e,a,!1):t.attachEvent("on"+e,function(){return a.call(t,window.event)})}function r(t){t.stopPropagation(),t.preventDefault()}function o(t,e){var a;return a="string"==typeof e?function(a){return t[e]?t[e](a):void 0}:function(){return e(t)}}t.exports.preventDefault=i,t.exports.fireEvent=n,t.exports.addEvent=s,t.exports.killEvent=r,t.exports.createHandler=o},function(t,e,a){"use strict";function i(t){var e=new Blob([t],{type:"text/csv;charset=utf-8"});return d.createObjectURL(e)}function n(t,e){var a=document.createElement("a"),i="undefined"!=typeof a.download;a.href=t,a.target="_blank",i&&(a.download=e),c.fireEvent(a,"click"),i&&d.revokeObjectURL(a.href)}function s(t){for(var e=0;t;)e+=t.offsetLeft,t=t.offsetParent;return e}function r(t){for(var e=0;t;)e+=t.offsetTop,t=t.offsetParent;return e}function o(t,e){var a=t.className.split(" ");-1===a.indexOf(e)&&(a.push(e),t.className=a.join(" "))}function h(t,e){var a=t.className.split(" "),i=a.indexOf(e);-1!==i&&(a.splice(i,1),t.className=a.join(" "))}function l(t,e){var a=t.className.split(" "),i=a.indexOf(e);return-1!==i}Object.defineProperty(e,"__esModule",{value:!0}),e.createBlobUrl=i,e.setupDownloadLink=n,e.getX=s,e.getY=r,e.addClass=o,e.removeClass=h,e.hasClass=l;var c=a(3),d=window.URL||window.webkitURL},function(t,e,a){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}function s(t){var e=void 0===arguments[1]?{}:arguments[1];this.canvasEl="string"==typeof t?document.getElementById(t):t,x.addClass(this.canvasEl,"pc-container"),this.branches={},this.leaves=[],this.root=!1,this.lastId=0,this.backColour=!1,this.origBL={},this.origP={},"static"===window.getComputedStyle(this.canvasEl).position&&(this.canvasEl.style.position="relative"),this.canvasEl.style.boxSizing="border-box";var a=document.createElement("canvas");a.id=t.id+"pCanvas",a.className="phylocanvas",a.style.position="relative",a.style.backgroundColor="#FFFFFF",a.height=t.clientHeight||400,a.width=t.clientWidth||400,a.style.zIndex="1",this.canvasEl.appendChild(a),this.contextMenu=new l["default"](this,e.contextMenu),this.defaultCollapsedOptions={},this.defaultCollapsed=!1,void 0!==e.defaultCollapsed&&e.defaultCollapsed.min&&e.defaultCollapsed.max&&(this.defaultCollapsedOptions=e.defaultCollapsed,this.defaultCollapsed=!0),this.tooltip=new d["default"](this),this.drawn=!1,this.selectedNodes=[],this.zoom=1,this.pickedup=!1,this.dragging=!1,this.startx=null,this.starty=null,this.pickedup=!1,this.baseNodeSize=1,this.curx=null,this.cury=null,this.origx=null,this.origy=null,this.canvas=a.getContext("2d"),this.canvas.canvas.onselectstart=function(){return!1},this.canvas.fillStyle="#000000",this.canvas.strokeStyle="#000000",this.canvas.save(),this.offsetx=this.canvas.canvas.width/2,this.offsety=this.canvas.canvas.height/2,this.selectedColour="rgba(49,151,245,1)",this.highlightColour="rgba(49,151,245,1)",this.highlightWidth=5,this.selectedNodeSizeIncrease=0,this.branchColour="rgba(0,0,0,1)",this.branchScalar=1,this.hoverLabel=!1,this.internalNodesSelectable=!0,this.showLabels=!0,this.showBootstraps=!1,this.treeType="radial",this.maxBranchLength=0,this.lineWidth=1,this.textSize=7,this.font="sans-serif",this.unselectOnClickAway=!0,this.rightClickZoom=!0,this.useNavigator&&(this.navigator=new p["default"](this)),this.adjustForPixelRatio(),this.initialiseHistory(e),this.addListener("contextmenu",this.clicked.bind(this)),this.addListener("click",this.clicked.bind(this)),this.addListener("mousedown",this.pickup.bind(this)),this.addListener("mouseup",this.drop.bind(this)),this.addListener("mouseout",this.drop.bind(this)),b.addEvent(this.canvas.canvas,"mousemove",this.drag.bind(this)),b.addEvent(this.canvas.canvas,"mousewheel",this.scroll.bind(this)),b.addEvent(this.canvas.canvas,"DOMMouseScroll",this.scroll.bind(this)),b.addEvent(window,"resize",function(){this.resizeToContainer()}.bind(this)),this.addListener("loaded",function(){this.origBranches=this.branches,this.origLeaves=this.leaves,this.origRoot=this.root}.bind(this)),this.nodeAlign=!1,this.farthestNodeFromRootX=0,this.farthestNodeFromRootY=0,this.showMetadata=!1,this.selectedMetadataColumns=[],this.colour1="rgba(206,16,16,1)",this.colour0="#ccc",this.maxLabelLength={},this.metadataXStep=15,this.metadataHeadingDrawn=!1}var r=a(6),o=i(r),h=a(1),l=i(h),c=a(2),d=i(c),u=a(9),p=i(u),v=a(10),f=i(v),g=a(17),y=i(g),m=a(7),x=a(4),b=a(3),w=a(24),C=a(25),L=i(C);s.prototype.setInitialCollapsedBranches=function(){var t,e,a=void 0===arguments[0]?this.root:arguments[0];if(t=a.getChildIds(),t&&t.length>this.defaultCollapsedOptions.min&&t.length<this.defaultCollapsedOptions.max)return void(a.collapsed=!0);for(e=0;e<a.children.length;e++)this.setInitialCollapsedBranches(a.children[e])},s.prototype.clicked=function(t){var e,a;if(0===t.button){var i;if(a=[],this.dragging)return void(this.dragging=!1);if(!this.root)return!1;e=(i=this.root).clicked.apply(i,n(w.translateClick(t.clientX,t.clientY,this))),e?(this.root.setSelected(!1,!0),(this.internalNodesSelectable||e.leaf)&&(e.setSelected(!0,!0),a=e.getChildIds()),this.draw()):this.unselectOnClickAway&&this.contextMenu.closed&&!this.dragging&&(this.root.setSelected(!1,!0),this.draw()),this.pickedup||(this.dragging=!1),this.nodesSelected(a)}else if(2===t.button){var s;t.preventDefault(),e=(s=this.root).clicked.apply(s,n(w.translateClick(t.clientX,t.clientY,this))),this.contextMenu.open(t.clientX,t.clientY,e),this.contextMenu.closed=!1,this.tooltip.close()}},s.prototype.dblclicked=function(t){var e;if(!this.root)return!1;var a=(e=this.root).clicked.apply(e,n(w.translateClick(1*t.clientX,1*t.clientY,this)));a&&(a.setSelected(!1,!0),a.toggleCollapsed()),this.pickedup||(this.dragging=!1),this.draw()},s.prototype.displayLabels=function(){this.showLabels=!0,this.draw()},s.prototype.drag=function(t){var e=w.getPixelRatio(this.canvas);if(!this.drawn)return!1;if(this.pickedup){var a=(t.clientX-this.startx)*e,i=(t.clientY-this.starty)*e;Math.abs(a)+Math.abs(i)>5&&(this.dragging=!0,this.offsetx=this.origx+a,this.offsety=this.origy+i,this.draw())}else if(this.zoomPickedUp)this.d=(this.starty-t.clientY)/100,this.setZoom(this.origZoom+this.d),this.draw();else{var s,r=t,o=(s=this.root).clicked.apply(s,n(w.translateClick(1*r.clientX,1*r.clientY,this)));o&&(this.internalNodesSelectable||o.leaf)?(this.root.setHighlighted(!1),o.setHighlighted(!0),o.leaf||o.hasCollapsedAncestor()||!this.contextMenu.closed||this.tooltip.open(r.clientX,r.clientY,o)):(this.tooltip.close(),this.contextMenu.close(),this.root.setHighlighted(!1)),this.draw()}},s.prototype.draw=function(t){return this.selectedNodes=[],0===this.maxBranchLength?void this.loadError("All branches in the tree are identical."):(this.canvas.restore(),this.canvas.clearRect(0,0,this.canvas.canvas.width,this.canvas.canvas.height),this.canvas.lineCap="round",this.canvas.lineJoin="round",this.canvas.strokeStyle=this.branchColour,this.canvas.save(),this.canvas.translate(this.canvas.canvas.width/2/w.getBackingStorePixelRatio(this.canvas),this.canvas.canvas.height/2/w.getBackingStorePixelRatio(this.canvas)),(!this.drawn||t)&&(y["default"][this.treeType].run(this),t||this.fitInPanel()),this.canvas.lineWidth=this.lineWidth/this.zoom,this.canvas.translate(this.offsetx,this.offsety),this.canvas.scale(this.zoom,this.zoom),f["default"][this.treeType].render(this,this.root),this.defaultCollapsed=!1,this.metadataHeadingDrawn=!1,void(this.drawn=!0))},s.prototype.drop=function(){return this.drawn?(this.pickedup=!1,void(this.zoomPickedUp=!1)):!1},s.prototype.findBranch=function(t){this.root.setSelected(!1,!0);for(var e=0;e<this.leaves.length;e++)this.leaves[e].id.match(new RegExp(t,"i"))&&this.leaves[e].setSelected(!0,!0);this.draw()},s.prototype.clearSelect=function(){this.root.setSelected(!1,!0),this.draw()},s.prototype.generateBranchId=function(){return"pcn"+this.lastId++},s.prototype.getPngUrl=function(){return this.canvas.canvas.toDataURL()},s.prototype.hideLabels=function(){this.showLabels=!1,this.draw()},s.prototype.load=function(t){var e=void 0===arguments[1]?{}:arguments[1];if(e.format)return void this.build(t,L["default"][e.format],e);var a=!0,i=!1,n=void 0;try{for(var s,r=Object.keys(L["default"])[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var o=s.value,h=L["default"][o];if(t.match(h.fileExtension)||t.match(h.validator))return void this.build(t,h,e)}}catch(l){i=!0,n=l}finally{try{!a&&r["return"]&&r["return"]()}finally{if(i)throw n}}this.loadError("PhyloCanvas did not recognise the string as a file or a parseable format string")},s.prototype.build=function(t,e,a){var i=this;this.origBranches=!1,this.origLeaves=!1,this.origRoot=!1,this.origBL={},this.origP={},this.root=!1,this.leaves=[],this.branches={},this.drawn=!1;var n=new o["default"];n.id="root",this.branches.root=n,this.setRoot(n),e.parse({inputString:t,root:n,options:a},function(t){return t?void i.loadError(t):(i.saveNode(i.root),i.root.saveChildren(),i.root.branchLength=0,i.maxBranchLength=0,i.root.setTotalLength(),0===i.maxBranchLength?void i.loadError("All branches in the tree are identical."):(i.buildLeaves(),i.setInitialCollapsedBranches(),i.draw(),void i.loadCompleted()))})},s.prototype.pickup=function(t){return this.drawn?(this.origx=this.offsetx,this.origy=this.offsety,0===t.button&&(this.pickedup=!0),2===t.button&&this.rightClickZoom&&(this.zoomPickedUp=!0,this.origZoom=Math.log(this.zoom)/Math.log(10),this.oz=this.zoom),this.startx=t.clientX,void(this.starty=t.clientY)):!1},s.prototype.redrawGetNodes=function(t,e){for(var a=0;a<t.children.length;a++)this.branches[t.children[a].id]=t.children[a],t.children[a].leaf?(e.push(t.children[a].id),this.leaves.push(t.children[a])):this.redrawGetNodes(t.children[a],e)},s.prototype.redrawFromBranch=function(t){this.drawn=!1,this.totalBranchLength=0,this.resetTree(),this.origBL[t.id]=t.branchLength,this.origP[t.id]=t.parent,this.root=t,this.root.branchLength=0,this.root.parent=!1,this.branches={},this.leaves=[];for(var e=[],a=0;a<this.root.children.length;a++)this.branches[this.root.children[a].id]=this.root.children[a],this.root.children[a].leaf?(this.leaves.push(this.root.children[a]),e.push(this.root.children[a].id)):this.redrawGetNodes(this.root.children[a],e);this.root.setTotalLength(),y["default"][this.treeType].run(this),this.draw(),this.subtreeDrawn(t.id)},s.prototype.redrawOriginalTree=function(){this.drawn=!1,this.resetTree(),this.root.setTotalLength(),y["default"][this.treeType].run(this),this.draw(),this.subtreeDrawn(this.root.id)},s.prototype.saveNode=function(t){if(t.id&&""!==t.id||(t.id=t.tree.genId()),this.branches[t.id]&&t!==this.branches[t.id]){if(this.leaf)throw new Error("Two nodes on this tree share the id "+t.id);t.id=this.genId()}this.branches[t.id]=t},s.prototype.scroll=function(t){var e=Math.log(this.zoom)/Math.log(10);this.setZoom(e+(t.detail<0||t.wheelDelta>0?.12:-.12)),t.preventDefault()},s.prototype.selectNodes=function(t){var e,a,i,n=t;if(this.root){this.root.setSelected(!1,!0),"string"==typeof t&&(n=n.split(","));for(a in this.branches)if(this.branches.hasOwnProperty(a))for(e=this.branches[a],i=0;i<n.length;i++)n[i]===e.id&&e.setSelected(!0,!0);this.draw()}},s.prototype.setFont=function(t){isNaN(t)&&(this.font=t,this.draw())},s.prototype.setNodeColourAndShape=function(t,e,a,i,n){if(t)if(this.drawn){var s=[];if(s="string"==typeof t?t.split(","):t,""!==t){for(var r=0;r<s.length;r++)this.branches[s[r]]&&(e&&(this.branches[s[r]].colour=e),a&&(this.branches[s[r]].nodeShape=m.Shapes[a]?m.Shapes[a]:a),i&&(this.branches[s[r]].radius=i));this.draw()}}else if(!n)var o=this,h=setInterval(function(){this.drawn&&(o.setNodeColourAndShape(t,e,a,i,!0),clearInterval(h))})},s.prototype.setNodeSize=function(t){this.baseNodeSize=Number(t),this.draw()},s.prototype.setRoot=function(t){t.canvas=this.canvas,t.tree=this,this.root=t},s.prototype.setTextSize=function(t){this.textSize=Number(t),this.draw()},s.prototype.setFontSize=function(t){"circular"===this.treeType?this.textSize=Math.min(100*t+5,40):"radial"===this.treeType?this.textSize=Math.min(50*t+5,20):"diagonal"===this.treeType?this.textSize=Math.min(t/2,10):this.textSize=Math.min(t/2,15),this.canvas.font=this.textSize+"pt "+this.font},s.prototype.setTreeType=function(t){var e=this.treeType;this.treeType=t,this.drawn&&(this.drawn=!1,this.draw()),this.treeTypeChanged(e,t)},s.prototype.setSize=function(t,e){this.canvas.canvas.width=t,this.canvas.canvas.height=e,this.navigator&&this.navigator.resize(),this.adjustForPixelRatio(),this.drawn&&this.draw()},s.prototype.setZoom=function(t){if(t>-2&&2>t){var e=this.zoom;this.zoom=Math.pow(10,t),this.offsetx=this.offsetx/e*this.zoom,this.offsety=this.offsety/e*this.zoom,this.draw()}},s.prototype.toggleLabels=function(){this.showLabels=!this.showLabels,this.draw()},s.prototype.viewMetadataColumns=function(t){this.showMetadata=!0,void 0===t&&(t=this.getMetadataColumnHeadings()),void 0!==t&&(this.selectedMetadataColumns=t),this.fitInPanel(),this.draw()},s.prototype.getMetadataColumnHeadings=function(){for(var t=[],e=0;e<this.leaves.length;e++)if(Object.keys(this.leaves[e].data).length>0){t=Object.keys(this.leaves[e].data);break}return t},s.prototype.clearMetadata=function(){for(var t=0;t<this.leaves.length;t++)Object.keys(this.leaves[t].data).length>0&&(this.leaves[t].data={})},s.prototype.setMaxLabelLength=function(){var t;void 0===this.maxLabelLength[this.treeType]&&(this.maxLabelLength[this.treeType]=0);for(var e=0;e<this.leaves.length;e++)t=this.canvas.measureText(this.leaves[e].id),t.width>this.maxLabelLength[this.treeType]&&(this.maxLabelLength[this.treeType]=t.width)},s.prototype.loadCompleted=function(){b.fireEvent(this.canvasEl,"loaded")},s.prototype.loadStarted=function(){b.fireEvent(this.canvasEl,"loading")},s.prototype.loadError=function(t){b.fireEvent(this.canvasEl,"error",{message:t})},s.prototype.subtreeDrawn=function(t){b.fireEvent(this.canvasEl,"subtree",{node:t})},s.prototype.nodesSelected=function(t){b.fireEvent(this.canvasEl,"selected",{nodeIds:t})},s.prototype.addListener=function(t,e){b.addEvent(this.canvasEl,t,e)},s.prototype.getBounds=function(){for(var t=this.root.startx,e=this.root.startx,a=this.root.starty,i=this.root.starty,n=this.leaves.length;n--;){var s=this.leaves[n].centerx,r=this.leaves[n].centery,o=this.leaves[n].angle,h=this.leaves[n].getNodeSize()+(this.showLabels?this.maxLabelLength[this.treeType]+this.leaves[n].getLabelSize():0)+(this.showMetadata?this.getMetadataColumnHeadings().length*this.metadataXStep:0);s+=h*Math.cos(o),r+=h*Math.sin(o),t=Math.min(t,s),e=Math.max(e,s),a=Math.min(a,r),i=Math.max(i,r)}return[[t,a],[e,i]]},s.prototype.fitInPanel=function(){var t=this.getBounds(),e=t[0][0],a=t[1][0],i=t[0][1],n=t[1][1],s=50,r=[this.canvas.canvas.width-s,this.canvas.canvas.height-s];this.zoom=Math.min(r[0]/(a-e),r[1]/(n-i)),this.offsety=(n+i)*this.zoom/-2,this.offsetx=(a+e)*this.zoom/-2},s.prototype.on=s.prototype.addListener,s.prototype.adjustForPixelRatio=function(){var t=w.getPixelRatio(this.canvas);this.canvas.canvas.style.height=this.canvas.canvas.height+"px",this.canvas.canvas.style.width=this.canvas.canvas.width+"px",t>1&&(this.canvas.canvas.width*=t,this.canvas.canvas.height*=t)},s.prototype.treeTypeChanged=function(t,e){b.fireEvent(this.canvasEl,"typechanged",{oldType:t,newType:e})},s.prototype.resetTree=function(){if(this.origBranches){this.branches=this.origBranches;var t=!0,e=!1,a=void 0;try{for(var i,n=Object.keys(this.origBL)[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;this.branches[s].branchLength=this.origBL[s],this.branches[s].parent=this.origP[s]}}catch(r){e=!0,a=r}finally{try{!t&&n["return"]&&n["return"]()}finally{if(e)throw a}}this.leaves=this.origLeaves,this.root=this.origRoot}},s.prototype.rotateBranch=function(t){this.branches[t.id].rotate()},s.prototype.buildLeaves=function(){this.leaves=[];var t=!0,e=!1,a=void 0;try{for(var i,n=this.root.getChildIds()[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;this.leaves.push(this.branches[s])}}catch(r){e=!0,a=r}finally{try{!t&&n["return"]&&n["return"]()}finally{if(e)throw a}}},s.prototype.exportNwk=function(){var t=this.root.getNwk();return t.substr(0,t.lastIndexOf(")")+1)+";"},s.prototype.resizeToContainer=function(){this.setSize(this.canvasEl.offsetWidth,this.canvasEl.offsetHeight),this.draw(),this.history.resizeTree()},s.prototype.downloadAllLeafIds=function(){this.root.downloadLeafIdsFromBranch()},s.prototype.exportCurrentTreeView=function(){x.setupDownloadLink(this.getPngUrl(),"phylocanvas.png")},t.exports=s},function(t,e,a){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(){this.angle=0,this.branchLength=!1,this.canvas=null,this.centerx=0,this.centery=0,this.children=[],this.collapsed=!1,this.colour="rgba(0,0,0,1)",this.data={},this.id="",this.interx=0,this.intery=0,this.label=null,this.leaf=!0,this.maxChildAngle=0,this.minChildAngle=s.Angles.FULL,this.nodeShape="circle",this.parent=null,this.radius=1,this.selected=!1,this.startx=0,this.starty=0,this.totalBranchLength=0,this.tree={}}var s=a(7),r=a(4),o=a(8),h=i(o);n.prototype.clicked=function(t,e){var a,i;if(!this.dragging){if(t<this.maxx&&t>this.minx&&e<this.maxy&&e>this.miny)return this;for(a=this.children.length-1;a>=0;a--)if(i=this.children[a].clicked(t,e))return i}},n.prototype.drawMetadata=function(){var t=0;(this.tree.showLabels||this.tree.hoverLabel&&this.highlighted)&&(t=this.tree.maxLabelLength[this.tree.treeType]);var e,a,i=this.getLabelStartX()+t,n=0,r=[],o=this.tree.textSize,h=this.tree.metadataXStep/2;this.tree.nodeAlign&&("rectangular"===this.tree.treeType?i+=this.tree.farthestNodeFromRootX-this.centerx:"hierarchy"===this.tree.treeType&&(i+=this.tree.farthestNodeFromRootY-this.centery)),!this.tree.metadataHeadingDrawn&&this.tree.nodeAlign&&"circular"!==this.tree.treeType&&"radial"!==this.tree.treeType&&(this.drawMetadataHeading(i,n),this.tree.metadataHeadingDrawn=!0);var l=this.tree.metadataXStep;if(Object.keys(this.data).length>0){for(this.canvas.beginPath(),this.angle>s.Angles.QUARTER&&this.angle<s.Angles.HALF+s.Angles.QUARTER&&(this.canvas.rotate(s.Angles.HALF),i=-i-t,l=-l),r=this.tree.selectedMetadataColumns.length>0?this.tree.selectedMetadataColumns:Object.keys(this.data),n-=o/2,e=0;e<r.length;e++)a=r[e],i+=l,window.parseInt(this.data[a])?(this.canvas.fillStyle=this.tree.colour1,this.canvas.fillRect(i,n,h,o)):0===window.parseInt(this.data[a])&&(this.canvas.fillStyle=this.tree.colour0,this.canvas.fillRect(i,n,h,o));this.canvas.stroke(),this.canvas.closePath()}},n.prototype.drawMetadataHeading=function(t,e){var a,i,n;for(a=this.tree.selectedMetadataColumns.length>0?this.tree.selectedMetadataColumns:Object.keys(this.data),this.canvas.font="12px Sans-serif",this.canvas.fillStyle="black",n=0;n<a.length;n++)i=a[n],t+=this.tree.metadataXStep,this.canvas.rotate(-Math.PI/2),"rectangular"===this.tree.treeType?(this.canvas.textAlign="left",this.canvas.fillText(i,20,t+6)):"hierarchy"===this.tree.treeType?(this.canvas.textAlign="right",this.canvas.fillText(i,-20,t+8)):"diagonal"===this.tree.treeType&&(this.canvas.textAlign="left",this.canvas.fillText(i,20,t+6)),this.canvas.rotate(Math.PI/2)},n.prototype.drawLabel=function(){var t,e,a,i=this.tree.textSize,n=this.getLabel();this.canvas.font=i+"pt "+this.tree.font,t=this.canvas.measureText(n),void 0===this.tree.maxLabelLength[this.tree.treeType]&&(this.tree.maxLabelLength[this.tree.treeType]=0),t.width>this.tree.maxLabelLength[this.tree.treeType]&&(this.tree.maxLabelLength[this.tree.treeType]=t.width),e=this.getLabelStartX(),a=i/2,this.tree.nodeAlign&&("rectangular"===this.tree.treeType?e+=this.tree.farthestNodeFromRootX-this.centerx:"hierarchy"===this.tree.treeType&&(e+=this.tree.farthestNodeFromRootY-this.centery)),this.angle>s.Angles.QUARTER&&this.angle<s.Angles.HALF+s.Angles.QUARTER&&(this.canvas.rotate(s.Angles.HALF),e=-e-1*t.width),this.canvas.beginPath(),this.canvas.fillStyle=this.getTextColour(),this.canvas.fillText(n,e,a),this.canvas.closePath()},n.prototype.setNodeDimensions=function(t,e,a){this.minx=t-a,this.maxx=t+a,this.miny=e-a,this.maxy=e+a},n.prototype.drawNode=function(){var t=this.getNodeSize(),e=t,a=this.leaf?e*Math.cos(this.angle)+this.centerx:this.centerx,i=this.leaf?e*Math.sin(this.angle)+this.centery:this.centery;if(this.canvas.beginPath(),this.canvas.fillStyle=this.selected?this.tree.selectedColour:this.colour,t*this.tree.zoom<5||!this.leaf?this.setNodeDimensions(a,i,5/this.tree.zoom):this.setNodeDimensions(a,i,t),this.collapsed){var n=this.getChildIds(),r=n.length;"radial"===this.tree.treeType&&(r/=7),"circular"===this.tree.treeType&&(r/=3),this.canvas.globalAlpha=.3,this.canvas.beginPath(),this.canvas.arc(a,i,r,0,2*Math.PI,!1),this.canvas.fillStyle=this.tree.defaultCollapsedOptions.color?this.tree.defaultCollapsedOptions.color:"purple",this.canvas.fill(),this.canvas.globalAlpha=1}else if(this.leaf){var o=this.canvas.lineWidth;this.tree.nodeAlign&&(this.canvas.lineWidth=this.canvas.lineWidth/10,this.canvas.beginPath(),
"rectangular"===this.tree.treeType&&this.canvas.moveTo(this.tree.farthestNodeFromRootX,this.centery),"hierarchy"===this.tree.treeType&&this.canvas.moveTo(this.centerx,this.tree.farthestNodeFromRootY),this.canvas.closePath(),this.canvas.fill()),this.canvas.save(),this.canvas.translate(this.centerx,this.centery),this.canvas.rotate(this.angle),h["default"][this.nodeShape](this),(this.tree.showLabels||this.tree.hoverLabel&&this.highlighted)&&this.drawLabel(),this.tree.showMetadata&&this.drawMetadata(),this.canvas.restore(),this.canvas.lineWidth=o}if(this.canvas.closePath(),this.highlighted){this.canvas.beginPath();var l=this.canvas.lineWidth;this.canvas.strokeStyle=this.tree.highlightColour,this.canvas.lineWidth=this.tree.highlightWidth/this.tree.zoom,this.canvas.arc(a,i,(this.leaf?this.getNodeSize():0)+(5+this.tree.highlightWidth/2)/this.tree.zoom,0,s.Angles.FULL,!1),this.canvas.stroke(),this.canvas.lineWidth=l,this.canvas.strokeStyle=this.tree.branchColour,this.canvas.closePath()}},n.prototype.getChildIds=function(){var t,e=[];if(this.leaf)return[this.id];for(e=[],t=0;t<this.children.length;t++)e=e.concat(this.children[t].getChildIds());return e},n.prototype.getChildCount=function(){var t,e=0;if(this.leaf)return 1;for(t=0;t<this.children.length;t++)e+=this.children[t].getChildCount();return e},n.prototype.getChildYTotal=function(){var t,e=0;if(this.leaf)return this.centery;for(t=0;t<this.children.length;t++)e+=this.children[t].getChildYTotal();return e},n.prototype.setSelected=function(t,e){var a=this.id,i=0;if(this.selected=t,e)for(i=0;i<this.children.length;i++)a=a+","+this.children[i].setSelected(t,e);return a},n.prototype.setHighlighted=function(t){var e;if(this.highlighted=t,!t)for(e=0;e<this.children.length;e++)this.children[e].setHighlighted(t)},n.prototype.reset=function(){var t,e;for(this.startx=0,this.starty=0,this.centerx=0,this.centery=0,this.angle=null,this.minChildAngle=s.Angles.FULL,this.maxChildAngle=0,e=0;e<this.children.length;e++)try{this.children[t].pcReset()}catch(a){return a}},n.prototype.redrawTreeFromBranch=function(){this.tree.redrawFromBranch(this)},n.prototype.saveChildren=function(){var t;for(t=0;t<this.children.length;t++)this.tree.saveNode(this.children[t]),this.children[t].saveChildren()},n.prototype.hasCollapsedAncestor=function(){return this.parent?this.parent.collapsed||this.parent.hasCollapsedAncestor():!1},n.prototype.collapse=function(){this.collapsed=this.leaf===!1},n.prototype.expand=function(){this.collapsed=!1},n.prototype.toggleCollapsed=function(){this.collapsed?this.expand():this.collapse()},n.prototype.setTotalLength=function(){var t;for(this.parent?(this.totalBranchLength=this.parent.totalBranchLength+this.branchLength,this.totalBranchLength>this.tree.maxBranchLength&&(this.tree.maxBranchLength=this.totalBranchLength)):(this.totalBranchLength=this.branchLength,this.tree.maxBranchLength=this.totalBranchLength),t=0;t<this.children.length;t++)this.children[t].setTotalLength()},n.prototype.addChild=function(t){t.parent=this,t.canvas=this.canvas,t.tree=this.tree,this.leaf=!1,this.children.push(t)},n.prototype.getChildColours=function(){var t=[];return this.children.forEach(function(e){var a=0===e.children.length?e.colour:e.getColour();-1===t.indexOf(a)&&t.push(a)}),t},n.prototype.getColour=function(){var t;return this.selected?this.tree.selectedColour:this.tree.backColour===!0?this.children.length?(t=this.getChildColours(),1===t.length?t[0]:this.tree.branchColour):this.colour:"function"==typeof this.tree.backColour?this.tree.backColour(this):this.tree.branchColour},n.prototype.getNwk=function(){var t,e,a;if(this.leaf)return this.id+":"+this.branchLength;for(t=[],e=0;e<this.children.length;e++)t.push(this.children[e].getNwk());return a="("+t.join(",")+"):"+this.branchLength},n.prototype.getTextColour=function(){var t,e;return this.selected?this.tree.selectedColour:(this.highlighted?t=this.tree.highlightColour:this.tree.backColour?this.children.length?(e=this.getChildColours(),t=1===e.length?e[0]:this.tree.branchColour):t=this.colour:t=this.tree.branchColour,t)},n.prototype.getLabel=function(){return void 0!==this.label&&null!==this.label?this.label:this.id},n.prototype.getLabelSize=function(){return this.tree.canvas.measureText(this.getLabel()).width},n.prototype.getNodeSize=function(){return Math.max(0,this.tree.baseNodeSize*this.radius)},n.prototype.getLabelStartX=function(){return this.getNodeSize()+this.tree.baseNodeSize+2*this.radius},n.prototype.rotate=function(t){var e,a=[];for(e=this.children.length;e--;)a.push(this.children[e]);this.children=a,t.preventredraw||(this.tree.buildLeaves(),this.tree.draw(!0))},n.prototype.getChildNo=function(){return this.parent.children.indexOf(this)},n.prototype.downloadLeafIdsFromBranch=function(){var t=this.getChildIds().join("\n");r.setupDownloadLink(r.createBlobUrl(t),"pc_leaves.txt")},t.exports=n},function(t,e,a){"use strict";t.exports.Angles={FORTYFIVE:Math.PI/4,QUARTER:Math.PI/2,HALF:Math.PI,FULL:2*Math.PI},t.exports.Shapes={x:"star",s:"square",o:"circle",t:"triangle"}},function(t,e,a){"use strict";var i=a(7).Angles;t.exports={circle:function(t){var e=t.getNodeSize();t.canvas.arc(e,0,e,0,i.FULL,!1),t.canvas.stroke(),t.canvas.fill()},square:function(t){var e=t.getNodeSize(),a=0,i=2*e,n=-e,s=e;t.canvas.moveTo(a,n),t.canvas.lineTo(a,s),t.canvas.lineTo(i,s),t.canvas.lineTo(i,n),t.canvas.lineTo(a,n),t.canvas.stroke(),t.canvas.fill()},star:function(t){var e=t.getNodeSize(),a=e,i=0,n=8,s=e,r=.5*e,o=Math.PI/2*3,h=a,l=i,c=Math.PI/n,d=0;for(t.canvas.beginPath(),t.canvas.moveTo(a,i-s),d=0;n>d;d++)h=a+Math.cos(o)*s,l=i+Math.sin(o)*s,t.canvas.lineTo(h,l),o+=c,h=a+Math.cos(o)*r,l=i+Math.sin(o)*r,t.canvas.lineTo(h,l),o+=c;t.canvas.lineTo(a,i-s),t.canvas.stroke(),t.canvas.fill(),t.canvas.closePath()},triangle:function(t){var e=t.getNodeSize(),a=e,i=0,n=a-e,s=a+e,r=i-e,o=i+e;t.canvas.moveTo(s,r),t.canvas.lineTo(s,o),t.canvas.lineTo(n,(r+o)/2),t.canvas.lineTo(s,r),t.canvas.stroke(),t.canvas.fill()}}},function(t,e,a){"use strict";function i(t){this.tree=t,this.cel=document.createElement("canvas"),this.cel.id=this.tree.canvasEl.id+"Navi",this.cel.style.zIndex="100",this.cel.style.backgroundColor="#FFFFFF",this.cel.width=this.tree.canvas.canvas.width/3,this.cel.height=this.tree.canvas.canvas.height/3,this.cel.style.position="absolute",this.cel.style.bottom="0px",this.cel.style.right="0px",this.cel.style.border="1px solid #CCCCCC",this.tree.canvasEl.appendChild(this.cel),this.ctx=this.cel.getContext("2d"),this.ctx.translate(this.cel.width/2,this.cel.height/2),this.ctx.save()}i.prototype.drawFrame=function(){var t,e,a,i=this.cel.width,n=this.cel.height,s=i/2,r=n/2;this.ctx.restore(),this.ctx.save(),this.ctx.clearRect(-s,-r,i,n),this.ctx.strokeStyle="rgba(180,180,255,1)",this.tree.drawn?this.ctx.drawImage(this.img,-s,-r,this.cel.width,this.cel.height):(t=this.tree.canvas.canvas.toDataURL(),this.img=document.createElement("img"),this.img.src=t,e=this,this.img.onload=function(){e.ctx.drawImage(e.img,-s,-r,e.cel.width,e.cel.height)},this.baseOffsetx=this.tree.offsetx,this.baseOffsety=this.tree.offsety,this.baseZoom=this.tree.zoom),a=1/(this.tree.zoom/this.baseZoom),this.ctx.lineWidth=this.ctx.lineWidth/a,this.ctx.translate((this.baseOffsetx-this.tree.offsetx*a)*a,(this.baseOffsety-this.tree.offsety*a)*a),this.ctx.scale(a,a),this.ctx.strokeRect(-s,-r,i,n)},i.prototype.resize=function(){this.cel.width=this.tree.canvas.canvas.width/3,this.cel.height=this.tree.canvas.canvas.height/3,this.ctx.translate(this.cel.width/2,this.cel.height/2),this.drawFrame()},t.exports=i},function(t,e,a){"use strict";var i=a(12);t.exports={rectangular:new i(a(13)),circular:new i(a(14)),radial:new i(a(11)),diagonal:new i(a(15)),hierarchical:new i(a(16))}},function(t,e,a){"use strict";t.exports={draw:function(t,e){e.canvas.beginPath(),e.canvas.moveTo(e.startx,e.starty),e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke(),e.canvas.closePath()}}},function(t,e,a){"use strict";function i(t){if(!t||!t.draw)throw new Error("`draw` function is required for branch renderers");this.draw=t.draw,this.prepareChild=t.prepareChild}i.prototype.render=function(t,e,a){var i;if(!a&&e)for(e.selected?e.canvas.fillStyle=t.selectedColour:e.canvas.fillStyle=e.colour,e.canvas.strokeStyle=e.getColour(),this.draw(t,e),e.drawNode(),i=0;i<e.children.length;i++)this.prepareChild&&this.prepareChild(e,e.children[i]),this.render(t,e.children[i],e.collapsed||a)},t.exports=i},function(t,e,a){"use strict";t.exports={draw:function(t,e){var a=e.branchLength*t.branchScalar;e.angle=0,e.parent&&(e.centerx=e.startx+a),e.canvas.beginPath(),e.canvas.moveTo(e.startx,e.starty),e.canvas.lineTo(e.startx,e.centery),e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke(),e.canvas.closePath()},prepareChild:function(t,e){e.startx=t.centerx,e.starty=t.centery}}},function(t,e,a){"use strict";t.exports={draw:function(t,e){var a=e.getColour(),i=e.totalBranchLength*t.branchScalar;e.canvas.beginPath(),e.canvas.moveTo(e.startx,e.starty),e.leaf?(e.canvas.lineTo(e.interx,e.intery),e.canvas.stroke(),e.canvas.strokeStyle=e.selected?e.tree.selectedColour:"rgba(0,0,0,0.5)",e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke(),e.canvas.strokeStyle=a):(e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke()),e.canvas.closePath(),e.canvas.strokeStyle=e.getColour(),e.children.length>1&&!e.collapsed&&(e.canvas.beginPath(),e.canvas.arc(0,0,i,e.minChildAngle,e.maxChildAngle,e.maxChildAngle<e.minChildAngle),e.canvas.stroke(),e.canvas.closePath())}}},function(t,e,a){"use strict";t.exports={draw:function(t,e){e.angle=0,e.canvas.beginPath(),e.canvas.moveTo(e.startx,e.starty),e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke(),e.canvas.closePath()},prepareChild:function(t,e){e.startx=t.centerx,e.starty=t.centery}}},function(t,e,a){"use strict";t.exports={draw:function(t,e){e.canvas.beginPath(),e!==e.tree.root&&(e.canvas.moveTo(e.startx,e.starty),e.canvas.lineTo(e.centerx,e.starty)),e.canvas.lineTo(e.centerx,e.centery),e.canvas.stroke(),e.canvas.closePath()}}},function(t,e,a){"use strict";var i=a(19);t.exports={rectangular:new i(a(20)),circular:new i(a(21)),radial:new i(a(18)),diagonal:new i(a(22)),hierarchical:new i(a(23))}},function(t,e,a){"use strict";function i(t,e){e.parent?(e.startx=e.parent.centerx,e.starty=e.parent.centery):(e.startx=0,e.starty=0),e.centerx=e.startx+e.branchLength*t.branchScalar*Math.cos(e.angle),e.centery=e.starty+e.branchLength*t.branchScalar*Math.sin(e.angle);for(var a=0;a<e.children.length;a++)i(t,e.children[a])}var n=a(7).Angles;t.exports={step:function(t){return n.FULL/t.leaves.length},calculate:function(t,e){t.branchScalar=Math.min(t.canvas.canvas.width,t.canvas.canvas.height)/t.maxBranchLength;for(var a=0;a<t.leaves.length;a+=1){t.leaves[a].angle=e*a,t.leaves[a].centerx=t.leaves[a].totalBranchLength*t.branchScalar*Math.cos(t.leaves[a].angle),t.leaves[a].centery=t.leaves[a].totalBranchLength*t.branchScalar*Math.sin(t.leaves[a].angle);for(var n=t.leaves[a];n.parent&&(0===n.getChildNo()&&(n.parent.angle=0),n.parent.angle+=n.angle*n.getChildCount(),n.getChildNo()===n.parent.children.length-1);n=n.parent)n.parent.angle=n.parent.angle/n.parent.getChildCount()}i(t,t.root)}}},function(t,e,a){"use strict";function i(t){this.step=t.step,this.calculate=t.calculate}i.prototype.run=function(t){var e=this.step(t);t.root.startx=0,t.root.starty=0,t.root.centerx=0,t.root.centery=0,t.farthestNodeFromRootX=0,t.farthestNodeFromRootY=0,this.calculate(t,e),t.root.startx=t.root.centerx,t.root.starty=t.root.centery,t.setFontSize(e),t.setMaxLabelLength()},t.exports=i},function(t,e,a){"use strict";t.exports={step:function(t){return Math.max(t.canvas.canvas.height/(t.leaves.length+2),2*(t.leaves[0].getNodeSize()+2))},calculate:function(t,e){t.branchScalar=t.canvas.canvas.width/t.maxBranchLength;for(var a=0;a<t.leaves.length;a++){t.leaves[a].angle=0,t.leaves[a].centery=a>0?t.leaves[a-1].centery+e:0,t.leaves[a].centerx=t.leaves[a].totalBranchLength*t.branchScalar,t.leaves[a].centerx>t.farthestNodeFromRootX&&(t.farthestNodeFromRootX=t.leaves[a].centerx),t.leaves[a].centery>t.farthestNodeFromRootY&&(t.farthestNodeFromRootY=t.leaves[a].centery);for(var i=t.leaves[a];i.parent;i=i.parent){var n=i.parent.children;i.parent.centery=(n[0].centery+n[n.length-1].centery)/2}}}}},function(t,e,a){"use strict";var i=a(7).Angles;t.exports={step:function(t){return i.FULL/t.leaves.length},calculate:function(t,e){t.branchScalar=Math.min(t.canvas.canvas.width,t.canvas.canvas.height)/t.maxBranchLength;var a=t.leaves.length*t.leaves[0].getNodeSize()*2/i.FULL;t.branchScalar*t.maxBranchLength>a?a=t.branchScalar*t.maxBranchLength:t.branchScalar=a/t.maxBranchLength;for(var n=0;n<t.leaves.length;n++){t.leaves[n].angle=e*n,t.leaves[n].centery=a*Math.sin(t.leaves[n].angle),t.leaves[n].centerx=a*Math.cos(t.leaves[n].angle),t.leaves[n].starty=t.leaves[n].parent.totalBranchLength*t.branchScalar*Math.sin(t.leaves[n].angle),t.leaves[n].startx=t.leaves[n].parent.totalBranchLength*t.branchScalar*Math.cos(t.leaves[n].angle),t.leaves[n].intery=t.leaves[n].totalBranchLength*t.branchScalar*Math.sin(t.leaves[n].angle),t.leaves[n].interx=t.leaves[n].totalBranchLength*t.branchScalar*Math.cos(t.leaves[n].angle);for(var s=t.leaves[n];s.parent&&(0===s.getChildNo()&&(s.parent.angle=s.angle,s.parent.minChildAngle=s.angle),s.getChildNo()===s.parent.children.length-1);s=s.parent)s.parent.maxChildAngle=s.angle,s.parent.angle=(s.parent.minChildAngle+s.parent.maxChildAngle)/2,s.parent.centery=s.parent.totalBranchLength*t.branchScalar*Math.sin(s.parent.angle),s.parent.centerx=s.parent.totalBranchLength*t.branchScalar*Math.cos(s.parent.angle),s.parent.starty=(s.parent.totalBranchLength-s.parent.branchLength)*t.branchScalar*Math.sin(s.parent.angle),s.parent.startx=(s.parent.totalBranchLength-s.parent.branchLength)*t.branchScalar*Math.cos(s.parent.angle)}}}},function(t,e,a){"use strict";var i=a(7).Angles;t.exports={step:function(t){return Math.max(t.canvas.canvas.height/(t.leaves.length+2),2*(t.leaves[0].getNodeSize()+2))},calculate:function(t,e){for(var a=0;a<t.leaves.length;a++){t.leaves[a].centerx=0,t.leaves[a].centery=a>0?t.leaves[a-1].centery+e:0,t.leaves[a].angle=0;for(var n=t.leaves[a];n.parent&&n.getChildNo()===n.parent.children.length-1;n=n.parent){n.parent.centery=n.parent.getChildYTotal()/n.parent.getChildCount(),n.parent.centerx=n.parent.children[0].centerx+(n.parent.children[0].centery-n.parent.centery)*Math.tan(i.FORTYFIVE);for(var s=0;s<n.parent.children.length;s++)n.parent.children[s].startx=n.parent.centerx,n.parent.children[s].starty=n.parent.centery}}}}},function(t,e,a){"use strict";var i=a(7).Angles;t.exports={step:function(t){return Math.max(t.canvas.canvas.width/(t.leaves.length+2),2*(t.leaves[0].getNodeSize()+2))},calculate:function(t,e){t.branchScalar=t.canvas.canvas.height/t.maxBranchLength;for(var a=0;a<t.leaves.length;a++){t.leaves[a].angle=i.QUARTER,t.leaves[a].centerx=a>0?t.leaves[a-1].centerx+e:0,t.leaves[a].centery=t.leaves[a].totalBranchLength*t.branchScalar;for(var n=t.leaves[a];n.parent&&(0===n.getChildNo()&&(n.parent.centerx=n.centerx),n.getChildNo()===n.parent.children.length-1);n=n.parent){n.parent.angle=i.QUARTER,n.parent.centerx=(n.parent.centerx+n.centerx)/2,n.parent.centery=n.parent.totalBranchLength*t.branchScalar;for(var s=0;s<n.parent.children.length;s++)n.parent.children[s].startx=n.parent.centerx,n.parent.children[s].starty=n.parent.centery}t.leaves[a].centerx>t.farthestNodeFromRootX&&(t.farthestNodeFromRootX=t.leaves[a].centerx),t.leaves[a].centery>t.farthestNodeFromRootY&&(t.farthestNodeFromRootY=t.leaves[a].centery)}}}},function(t,e,a){"use strict";function i(t){return t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||1}function n(t){return(window.devicePixelRatio||1)/i(t)}function s(t){return t=t-h.getX(this.canvas.canvas)+window.pageXOffset,t*=n(this.canvas),t-=this.canvas.canvas.width/2,t-=this.offsetx,t/=this.zoom}function r(t){return t=t-h.getY(this.canvas.canvas)+window.pageYOffset,t*=n(this.canvas),t-=this.canvas.canvas.height/2,t-=this.offsety,t/=this.zoom}function o(t,e,a){return[s.call(a,t),r.call(a,e)]}Object.defineProperty(e,"__esModule",{value:!0}),e.getBackingStorePixelRatio=i,e.getPixelRatio=n,e.translateClick=o;var h=a(4)},function(t,e,a){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var n=a(26),s=i(n),r=a(28),o=i(r),h=a(29),l=i(h);e["default"]={nexus:new s["default"](l["default"]),newick:new s["default"](o["default"])},t.exports=e["default"]},function(t,e,a){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),r=a(27),o=i(r),h=function(){function t(e){var a=e.format,i=e.parseFn,s=e.fileExtension,r=e.validator;n(this,t),this.format=a,this.parseFn=i,this.fileExtension=s,this.validator=r}return s(t,[{key:"parse",value:function(t,e){var a=this,i=t.inputString,n=t.root,s=t.options,r=void 0===s?{}:s,h=function(t){return t.match(a.validator)?a.parseFn({string:t,root:n,options:r},e):e(new Error('Format string does not validate as "'+a.format+'"'))};i.match(this.fileExtension)?o["default"]({url:i,method:"GET"},function(t){return t.status>=400?e(new Error(t.responseText)):void h(t.responseText)}):h(i)}}]),t}();e["default"]=h,t.exports=e["default"]},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=function(t,e){var a=t.url,i=t.method,n=t.data,s=new XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState&&e(s)},s.open(i,a,!0),"GET"===i?s.send():s.send(n)},t.exports=e["default"]},function(t,e,a){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function n(t){return this===t}function s(t){var e="",a=!0,i=!1,s=void 0;try{for(var r,o=t[Symbol.iterator]();!(a=(r=o.next()).done);a=!0){var h=r.value;if(m.some(n.bind(h)))return e;e+=h}}catch(l){i=!0,s=l}finally{try{!a&&o["return"]&&o["return"]()}finally{if(i)throw s}}}function r(t,e){var a=t.split("**");if(e.id=a[0],1!==a.length){a=a[1].split("*");for(var i=0;i<a.length;i+=2){var n=a[i+1];switch(a[i]){case"nsz":e.radius=window.parseInt(n);break;case"nsh":u.Shapes[n]?e.nodeShape=u.Shapes[n]:v["default"][n]?e.nodeShape=n:e.nodeShape="circle";break;case"ncol":e.colour=n;var s="0x"+e.colour.substring(0,2),r="0x"+e.colour.substring(2,4),o="0x"+e.colour.substring(4,6);e.colour="rgba("+parseInt(s,16).toString()+","+parseInt(r,16).toString()+","+parseInt(o,16).toString()+",1)"}}}}function o(t){var e="",a=!0,i=!1,s=void 0;try{for(var r,o=t[Symbol.iterator]();!(a=(r=o.next()).done);a=!0){var h=r.value;if(x.some(n.bind(h)))break;e+=h}}catch(l){i=!0,s=l}finally{try{!a&&o["return"]&&o["return"]()}finally{if(i)throw s}}return e}function h(t,e,a){var i=s(e.slice(a)),n=a+i.length,h=0;return i.match(/\*/)&&r(i,t),":"===e[n]?(h=o(e.slice(n+1)),t.branchLength=Math.max(parseFloat(h),0)):t.branchLength=0,t.id=i||t.tree.generateBranchId(),n+h.length}function l(t,e){for(var a=t.string,i=t.root,n=i,s=0;s<a.length;s++){var r=void 0;switch(a[s]){case"(":r=new d["default"],n.addChild(r),n=r;break;case")":n=n.parent;break;case",":r=new d["default"],n.parent.addChild(r),n=r;break;case";":return e();default:try{s=h(n,a,s)}catch(o){return e(o)}}}}Object.defineProperty(e,"__esModule",{value:!0});var c=a(6),d=i(c),u=a(7),p=a(8),v=i(p),f="newick",g=/\.nwk$/,y=/^[\w\W\.\*\:(\),-\/]+;\s?$/gi,m=[":",",",")"],x=[")",","];e["default"]={format:f,fileExtension:g,validator:y,parseFn:l},t.exports=e["default"]},function(t,e,a){"use strict";function i(t,e){var a=t.string,i=t.root,s=t.options;if(!a.match(/BEGIN TREES/gi))return e(new Error("The nexus file does not contain a tree block"));var r=s.name,o=a.match(/BEGIN TREES;[\S\s]+END;/i)[0].replace(/BEGIN TREES;\n/i,"").replace(/END;/i,""),h={},l=o.match(/TRANSLATE[^;]+;/i);if(l&&l.length){l=l[0],o=o.replace(l,""),l=l.replace(/translate|;/gi,"");for(var c=l.split(","),d=0;d<c.length;d++){var u=c[d].trim().replace("\n","").split(" ");u[0]&&u[1]&&(h[u[0].trim()]=u[1].trim())}}for(var p=o.split("\n"),v={},d=0;d<p.length;d++)if(""!==p[d].trim()){var f=p[d].replace(/tree\s/i,"");r||(r=f.trim().match(/^\w+/)[0]),v[r]=f.trim().match(/[\S]*$/)[0]}return v[r]?void n.parseFn({string:v[r].trim(),root:i},function(t){if(t)return e(t);if(e(),h){var a=!0,n=!1,s=void 0;try{for(var r,o=Object.keys(h)[Symbol.iterator]();!(a=(r=o.next()).done);a=!0){var l=r.value,c=i.tree.branches,d=c[l];delete c[l],d.id=h[l],c[d.id]=d}}catch(u){n=!0,s=u}finally{try{!a&&o["return"]&&o["return"]()}finally{if(n)throw s}}i.tree.draw()}}):new Error("tree "+r+" does not exist in this NEXUS file")}Object.defineProperty(e,"__esModule",{value:!0});var n=a(28),s="nexus",r=/\.n(ex|xs)$/,o=/^#NEXUS[\s\n;\w\W\.\*\:(\),-=\[\]\/&]+$/i;e["default"]={parseFn:i,format:s,fileExtension:r,validator:o},t.exports=e["default"]}])});